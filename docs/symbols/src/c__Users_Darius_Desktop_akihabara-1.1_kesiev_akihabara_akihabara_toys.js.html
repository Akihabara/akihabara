<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ---</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Copyright (c) 2010 Francesco Cottone, http://www.kesiev.com/</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>  4</span> 
<span class='line'>  5</span> </span><span class="COMM">/**
<span class='line'>  6</span>  * @namespace
<span class='line'>  7</span>  * Toys module provides lots of common routines during the game developing: 
<span class='line'>  8</span>  * from effects for screen titles to HUD handling to platform/SHMUP/RPG oriented routines, 
<span class='line'>  9</span>  * like jumping characters, Z-Indexed objects, bullets, sparks, staff rolls, bonus screens, dialogues etc.
<span class='line'> 10</span>  */</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toys</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 12</span> 
<span class='line'> 13</span> </span><span class="WHIT">	</span><span class="COMM">// CONSTANTS</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="WHIT">	</span><span class="NAME">NOOP</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="WHIT">	</span><span class="NAME">PUSH_NONE</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 16</span> </span><span class="WHIT">	</span><span class="NAME">PUSH_LEFT</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="WHIT">	</span><span class="NAME">PUSH_RIGHT</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">	</span><span class="NAME">PUSH_UP</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">	</span><span class="NAME">PUSH_DOWN</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">	
<span class='line'> 21</span> 	</span><span class="NAME">FACES</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"up"</span><span class="PUNC">,</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="STRN">"down"</span><span class="PUNC">,</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">	</span><span class="NAME">FACES_ANGLE</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">trigo.ANGLE_UP</span><span class="PUNC">,</span><span class="NAME">trigo.ANGLE_RIGHT</span><span class="PUNC">,</span><span class="NAME">trigo.ANGLE_DOWN</span><span class="PUNC">,</span><span class="NAME">trigo.ANGLE_LEFT</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">	</span><span class="NAME">FACE_UP</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">	</span><span class="NAME">FACE_RIGHT</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">	</span><span class="NAME">FACE_DOWN</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">	</span><span class="NAME">FACE_LEFT</span><span class="PUNC">:</span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">	
<span class='line'> 28</span> 	</span><span class="COMM">/** 
<span class='line'> 29</span> 	* @namespace
<span class='line'> 30</span>   * Top-view RPG specific libraries.
<span class='line'> 31</span> 	*/</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">	</span><span class="NAME">topview</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">	
<span class='line'> 34</span> 		</span><span class="COMM">/**
<span class='line'> 35</span> 		* Checks if an object checks that both objects are on the same Z plane and if so it calls gbox.collides.
<span class='line'> 36</span> 		* @param {Object} fr The object which collision is being checked for. 
<span class='line'> 37</span> 		* &lt;ul>
<span class='line'> 38</span> 		* &lt;li>x{Integer}: (required)Objects x position&lt;/li>
<span class='line'> 39</span> 		* &lt;li>y{Integer}: (required)Objects y position&lt;/li>
<span class='line'> 40</span> 		* &lt;li>z{Integer}: (required)Objects z position&lt;/li>
<span class='line'> 41</span> 		* &lt;li>colx{Integer}: (required)The dimension of the collision box along the x axis&lt;/li>
<span class='line'> 42</span> 		* &lt;li>coly{Integer}: (required)The dimension of the collision box along the y axis&lt;/li>
<span class='line'> 43</span> 		* &lt;li>colh{Integer}: (required)Collision box height&lt;/li>
<span class='line'> 44</span> 		* &lt;li>colw{Integer}: (required)Collision box width&lt;/li>
<span class='line'> 45</span> 		* &lt;/ul>
<span class='line'> 46</span> 		* @param {Object} to The object that collision is being checked against.
<span class='line'> 47</span> 		* &lt;ul>
<span class='line'> 48</span> 		* &lt;li>x{Integer}: (required)Objects x position&lt;/li>
<span class='line'> 49</span> 		* &lt;li>y{Integer}: (required)Objects y position&lt;/li>
<span class='line'> 50</span> 		* &lt;li>z{Integer}: (required)Objects z position&lt;/li>
<span class='line'> 51</span> 		* &lt;li>colx{Integer}: (required)Collision x&lt;/li>
<span class='line'> 52</span> 		* &lt;li>coly{Integer}: (required)Collision y&lt;/li>
<span class='line'> 53</span> 		* &lt;li>colh{Integer}: (required)Collision box height&lt;/li>
<span class='line'> 54</span> 		* &lt;li>colw{Integer}: (required)Collision box width&lt;/li>
<span class='line'> 55</span> 		* &lt;/ul>
<span class='line'> 56</span> 		* @param {int} t This is the tollerance (or margin for error) on the collide function.
<span class='line'> 57</span> 		*/</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">		</span><span class="NAME">collides</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fr</span><span class="PUNC">,</span><span class="NAME">to</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Special collision. Counts also the Z</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">fr.z</span><span class="PUNC">,</span><span class="NAME">to.z</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gbox.collides</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">fr.x</span><span class="PUNC">+</span><span class="NAME">fr.colx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">fr.y</span><span class="PUNC">+</span><span class="NAME">fr.coly</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">fr.colh</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">fr.colw</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">to.x</span><span class="PUNC">+</span><span class="NAME">to.colx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">to.y</span><span class="PUNC">+</span><span class="NAME">to.coly</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">to.colh</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">to.colw</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">		
<span class='line'> 62</span> 		</span><span class="COMM">/**
<span class='line'> 63</span> 		* Checks for pixel collisions with an offset to the X and Y of the colidable using colx and coly.
<span class='line'> 64</span> 		* @param {Object} fr The object which collision is being tested for.
<span class='line'> 65</span> 		* @param {Object} to The object (or point) which collision is being tested against.
<span class='line'> 66</span> 		* @param {int} t The tollerance of the collision algorithm.
<span class='line'> 67</span> 		*/</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">		</span><span class="NAME">pixelcollides</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fr</span><span class="PUNC">,</span><span class="NAME">to</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Special collision. Counts also the Z</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gbox.pixelcollides</span><span class="PUNC">(</span><span class="NAME">fr</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">to.x</span><span class="PUNC">+</span><span class="NAME">to.colx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">to.y</span><span class="PUNC">+</span><span class="NAME">to.coly</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">to.colh</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">to.colw</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">		
<span class='line'> 72</span> 		</span><span class="COMM">/**
<span class='line'> 73</span> 		* Initializes the game with the variables needed for topview and whatever else you feed in through data.
<span class='line'> 74</span> 		* @param {Object} th Passes in the object being initialized.
<span class='line'> 75</span> 		* @param {Object} data This is used to pass in everything that's being initiliized. If a value is not in Data then a default value is used instead. This can pass in values which do not have a default.
<span class='line'> 76</span> 		* &lt;ul>
<span class='line'> 77</span> 		* &lt;li>x{Integer}: x position of the object. (defaults to 0)&lt;/li>
<span class='line'> 78</span> 		* &lt;li>y{Integer}: y position of the object. (defaults to 0)&lt;/li>
<span class='line'> 79</span> 		* &lt;li>z{Integer}: z index of the object. (defaults to 0)&lt;/li>
<span class='line'> 80</span> 		* &lt;li>accx{Integer}: The starting x velociyt of the object. (defaults to 0)&lt;/li>
<span class='line'> 81</span> 		* &lt;li>accy{Integer}: The starting y velocity of the object. (defaults to 0)&lt;/li>
<span class='line'> 82</span> 		* &lt;li>accz{Integer}: The starting z velocity of the object. (defaults to 0)&lt;/li>
<span class='line'> 83</span> 		* &lt;li>frames{Object}: This is stores the animation frames for the objects in a map style structure. An empty map means the default image will display with no animation frames. (defaults to an empty map)&lt;/li>
<span class='line'> 84</span> 		* &lt;li>shadow: (defaults to null)&lt;/li> //incomplete
<span class='line'> 85</span> 		* &lt;li>maxacc{Integer}: (defaults to )4&lt;/li>
<span class='line'> 86</span> 		* &lt;li>controlmaxacc{Integer}: (defaults to 4)&lt;/li>
<span class='line'> 87</span> 		* &lt;li>responsive: (defaults to 0)&lt;/li>
<span class='line'> 88</span> 		* &lt;li>weapon: (defaults to 0)&lt;/li>
<span class='line'> 89</span> 		* &lt;li>camera{Boolean}: (defaults to true)&lt;/li>
<span class='line'> 90</span> 		* &lt;li>flipv{Boolean}: Notes if the object is flipped vertically(defaults to false)&lt;/li>
<span class='line'> 91</span> 		* &lt;li>fliph{Boolean}: Notes if the object is flipped horrizontally(defaults to false)&lt;/li>
<span class='line'> 92</span> 		* &lt;li>facing{Integer}: Stores the facing of the object. This is set with pre-defined Integer values from within Toys.(defaults to toys.FACE_DOWN)&lt;/li>
<span class='line'> 93</span> 		* &lt;ul>
<span class='line'> 94</span> 		* &lt;li>FACE_UP:0,&lt;/li>
<span class='line'> 95</span> 		* &lt;li>FACE_RIGHT:1,&lt;/li>
<span class='line'> 96</span> 		* &lt;li>FACE_DOWN:2,&lt;/li>
<span class='line'> 97</span> 		* &lt;li>FACE_LEFT:3,&lt;/li>
<span class='line'> 98</span> 		* &lt;/ul>
<span class='line'> 99</span> 		* &lt;li>flipside{Boolean}: (defaults to true)&lt;/li>
<span class='line'>100</span> 		* &lt;li>haspushing{Boolean}: (defaults to false)&lt;/li>
<span class='line'>101</span> 		* &lt;li>frame: (default to 0)&lt;/li>
<span class='line'>102</span> 		* &lt;li>colh{Integer}: (defaults to gbox.getTiles(th.tileset).tilehh)&lt;/li>
<span class='line'>103</span> 		* &lt;li>colw{Integer}: (defaults to gbox.getTiles(th.tileset).tilew)&lt;/li>
<span class='line'>104</span> 		* &lt;li>colx{Integer}: (defaults to 0)&lt;/li>
<span class='line'>105</span> 		* &lt;li>staticspeed{Integer}: (defaults to 0)&lt;/li>
<span class='line'>106</span> 		* &lt;li>nodiagonals{Boolean}: (defaults to false)&lt;/li>
<span class='line'>107</span> 		* &lt;li>noreset: (defaults to false)&lt;/li>
<span class='line'>108</span> 		* &lt;/ul>
<span class='line'>109</span> 		*/</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">		</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">			</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">				</span><span class="NAME">th</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">						</span><span class="NAME">z</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">						</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accz</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">						</span><span class="NAME">shadow</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">						</span><span class="NAME">maxacc</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">controlmaxacc</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">						</span><span class="NAME">responsive</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Responsiveness</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">						</span><span class="NAME">weapon</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Weapon</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">						</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">						</span><span class="NAME">facing</span><span class="PUNC">:</span><span class="NAME">toys.FACE_DOWN</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">						</span><span class="NAME">flipside</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">						</span><span class="NAME">haspushing</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">						</span><span class="NAME">frame</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">						</span><span class="NAME">colh</span><span class="PUNC">:</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">th.tileset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tilehh</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">						</span><span class="NAME">colw</span><span class="PUNC">:</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">th.tileset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tilew</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">						</span><span class="NAME">colx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">						</span><span class="NAME">staticspeed</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">						</span><span class="NAME">nodiagonals</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">						</span><span class="NAME">noreset</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.coly</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.coly</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">th.tileset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tileh</span><span class="PUNC">-</span><span class="NAME">th.colh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">			</span><span class="NAME">th.colhh</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.colh</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">			</span><span class="NAME">th.colhw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.colw</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">			
<span class='line'>143</span> 			</span><span class="NAME">toys.topview.spawn</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">		
<span class='line'>146</span> 		</span><span class="COMM">/**
<span class='line'>147</span> 		* Spawns a new object in the topview namespace. This also merges parameters in data into paramaters in th using help.copyModel.
<span class='line'>148</span>     * This initializes some basic basic variables for the object and sets the Z index.
<span class='line'>149</span> 		* @param {Object} th References 'this' which is the object that called the method (generally).
<span class='line'>150</span> 		* &lt;ul>
<span class='line'>151</span> 		* &lt;li>y {Integer}: (required) The object's y position.&lt;/li>
<span class='line'>152</span> 		* &lt;li>h {Integer}: (required) The object's height.&lt;/li>
<span class='line'>153</span> 		* &lt;/ul>
<span class='line'>154</span> 		* @param {Object} data This holds variables to be merged into th's stored info.
<span class='line'>155</span> 		*/</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">		</span><span class="NAME">spawn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">			</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// user is moving side</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">			</span><span class="NAME">th.vpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// user is moving side</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">			</span><span class="NAME">th.zpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// user is moving side</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">			</span><span class="NAME">th.counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// self counter</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">			</span><span class="NAME">th.hittimer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">			</span><span class="NAME">th.killed</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>163</span> 			</span><span class="NAME">help.copyModel</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">			</span><span class="NAME">gbox.setZindex</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// these object follows the z-index and uses ZINDEX_LAYER</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">		
<span class='line'>167</span> 		</span><span class="COMM">/**
<span class='line'>168</span> 		* This sets and runs the control keys for the game. 
<span class='line'>169</span> 		* @param {Object} th This is the object that is being controlled by the keys (assumed to be the player)
<span class='line'>170</span> 		* &lt;ul>
<span class='line'>171</span> 		* &lt;li>accx: the object's currect acceleration in the x direction&lt;/li>
<span class='line'>172</span> 		* &lt;li>accy: the object's currect acceleration in the y direction&lt;/li>
<span class='line'>173</span> 		* &lt;li>responsive: minimum movement speed&lt;/li>
<span class='line'>174</span> 		* &lt;li>staticspeed: turns off acceleration&lt;/li>
<span class='line'>175</span> 		* &lt;li>nodiagonals: boolean determining if the object can move along both axis at once.&lt;/li>
<span class='line'>176</span> 		* &lt;li>xpushing: a boolean that notes whether the object is pushing against something in the x direction.&lt;/li>
<span class='line'>177</span> 		* &lt;li>ypushing: a boolean that notes whether the object is pushing against something in the y direction.&lt;/li>
<span class='line'>178</span> 		* &lt;li>controlmaxacc: max acceleration for the object along an axis&lt;/li>
<span class='line'>179</span> 		* &lt;li>noreset: checks for the object being allowed to reset its pushing status (?)&lt;/li>
<span class='line'>180</span> 		* &lt;/ul>
<span class='line'>181</span> 		* @param {Object} keys These are the control keys being passed in for left, right, up, and down.
<span class='line'>182</span> 		* //incomplete
<span class='line'>183</span> 		*/</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">		</span><span class="NAME">controlKeys</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">keys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>185</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cancelx</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cancely</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idlex</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>188</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idley</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">			
<span class='line'>190</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.left</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">keys.pressleft</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">				</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">				</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">></span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.staticspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.staticspeed</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.nodiagonals</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">cancely</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idley</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.right</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">keys.pressright</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">				</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">				</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.staticspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">th.staticspeed</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.nodiagonals</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">cancely</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idley</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">idlex</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">			
<span class='line'>204</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cancely</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.up</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">keys.pressup</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">				</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_UP</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">				</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_UP</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">></span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.staticspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.staticspeed</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.nodiagonals</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">cancelx</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idlex</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cancely</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.down</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">keys.pressdown</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">				</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_DOWN</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">				</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_DOWN</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.staticspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">th.staticspeed</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.nodiagonals</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">cancelx</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">idlex</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">idley</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">			
<span class='line'>218</span> 			
<span class='line'>219</span> 			
<span class='line'>220</span> 			 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idlex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cancelx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cancelx</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">th.noreset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idley</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cancely</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>226</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cancely</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">th.noreset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">		
<span class='line'>230</span> 		</span><span class="COMM">/**
<span class='line'>231</span> 		* Gets the next X position the object is going to move to.
<span class='line'>232</span> 		* @param {Object} th The object being checked.
<span class='line'>233</span> 		* &lt;ul>
<span class='line'>234</span> 		* &lt;li>x: the current x position of the object&lt;/li>
<span class='line'>235</span> 		* &lt;li>accx: the object's currect acceleration in the x direction&lt;/li>
<span class='line'>236</span> 		* &lt;li>maxacc: the max accleration the object can have (if accx is greater than this then this value is used instead)&lt;/li>
<span class='line'>237</span> 		* &lt;/ul>
<span class='line'>238</span> 		*/</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">		</span><span class="NAME">getNextX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxacc</span><span class="PUNC">,</span><span class="NAME">th.maxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">		
<span class='line'>241</span> 		</span><span class="COMM">/**
<span class='line'>242</span> 		* Gets the next Y position the object is going to move to.
<span class='line'>243</span> 		* @param {Object} th The object being checked.
<span class='line'>244</span> 		* &lt;ul>
<span class='line'>245</span> 		* &lt;li>y: the current y position of the object&lt;/li>
<span class='line'>246</span> 		* &lt;li>accy: the object's currect acceleration in the y direction&lt;/li>
<span class='line'>247</span> 		* &lt;li>maxacc: the max accleration the object can have (if accy is greater than this then this value is used instead)&lt;/li>
<span class='line'>248</span> 		* &lt;/ul>
<span class='line'>249</span> 		*/</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">		</span><span class="NAME">getNextY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxacc</span><span class="PUNC">,</span><span class="NAME">th.maxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">		
<span class='line'>252</span> 		</span><span class="COMM">/**
<span class='line'>253</span> 		* Gets the next Z position the object is going to move to.
<span class='line'>254</span> 		* @param {Object} th The object being checked.
<span class='line'>255</span> 		* &lt;ul>
<span class='line'>256</span> 		* &lt;li>z: the current z position of the object&lt;/li>
<span class='line'>257</span> 		* &lt;li>accz: the object's currect acceleration in the z direction&lt;/li>
<span class='line'>258</span> 		* &lt;li>maxacc: the max accleration the object can have (if accz is greater than this then this value is used instead)&lt;/li>
<span class='line'>259</span> 		* &lt;/ul>
<span class='line'>260</span> 		*/</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">		</span><span class="NAME">getNextZ</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.z</span><span class="PUNC">+</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accz</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxacc</span><span class="PUNC">,</span><span class="NAME">th.maxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">		
<span class='line'>263</span> 		</span><span class="COMM">/**
<span class='line'>264</span> 		* Sets the objects current location to its next location using the getNextX and getNextY methods.
<span class='line'>265</span> 		* @param {Object} th The object being modified.
<span class='line'>266</span> 		* &lt;ul>
<span class='line'>267</span> 		* &lt;li>x: the current x position of the object&lt;/li>
<span class='line'>268</span> 		* &lt;li>y: the current y position of the object&lt;/li>
<span class='line'>269</span> 		* &lt;li>accx: the object's currect acceleration in the x direction&lt;/li>
<span class='line'>270</span> 		* &lt;li>accy: the object's currect acceleration in the y direction&lt;/li>
<span class='line'>271</span> 		* &lt;li>maxacc: the max accleration the object can have (if either acceleration is greater than this then this value is used instead for that acceleration)&lt;/li>
<span class='line'>272</span> 		* &lt;/ul>
<span class='line'>273</span> 		*/</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">		</span><span class="NAME">applyForces</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">			</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">toys.topview.getNextX</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">			</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">toys.topview.getNextY</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">		
<span class='line'>279</span> 		</span><span class="COMM">/**
<span class='line'>280</span> 		* This applies acceleration in the Z direction (not nessesarily gravity but whatever the next accerlation on the Z axis is)
<span class='line'>281</span> 		* @param {Object} th The object being modified.
<span class='line'>282</span> 		* &lt;ul>
<span class='line'>283</span> 		* &lt;li>z: the current z position of the object&lt;/li>
<span class='line'>284</span> 		* &lt;li>accz: the object's currect acceleration in the z direction&lt;/li>
<span class='line'>285</span> 		* &lt;li>maxacc: the max accleration the object can have (if accz is greater than this then this value is used instead)&lt;/li>
<span class='line'>286</span> 		* &lt;/ul>
<span class='line'>287</span> 		*/</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">		</span><span class="NAME">applyGravity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">			</span><span class="NAME">th.z</span><span class="PUNC">=</span><span class="NAME">toys.topview.getNextZ</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">		
<span class='line'>292</span> 		</span><span class="COMM">/**
<span class='line'>293</span> 		* Degrades all accelerations on an object by one toward zero.
<span class='line'>294</span> 		* @param {Object} th The object being modified.
<span class='line'>295</span> 		* &lt;ul>
<span class='line'>296</span> 		* &lt;li>xpushing: a boolean that notes whether the object is pushing against something in the x direction.&lt;/li>
<span class='line'>297</span> 		* &lt;li>ypushing: a boolean that notes whether the object is pushing against something in the y direction.&lt;/li>
<span class='line'>298</span> 		* &lt;li>accx: the object's currect acceleration in the x direction&lt;/li>
<span class='line'>299</span> 		* &lt;li>accy: the object's currect acceleration in the y direction&lt;/li>
<span class='line'>300</span> 		* &lt;/ul>
<span class='line'>301</span> 		*/</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">		</span><span class="NAME">handleAccellerations</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.xpushing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.goToZero</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.ypushing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">help.goToZero</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">			
<span class='line'>306</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">		
<span class='line'>308</span> 		</span><span class="COMM">/**
<span class='line'>309</span> 		* Increases the Z acceleration on the object by one.
<span class='line'>310</span> 		* @param {Object} th The object being modified.
<span class='line'>311</span> 		* &lt;ul>
<span class='line'>312</span> 		* &lt;li>accz: the acceleration on the Z axis&lt;/li>
<span class='line'>313</span> 		* &lt;/ul>
<span class='line'>314</span> 		*/</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">		</span><span class="NAME">handleGravity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">			</span><span class="NAME">th.accz</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">		
<span class='line'>319</span> 		</span><span class="COMM">/**
<span class='line'>320</span> 		* This sets which frame the object is going to display based on an agregate word that describes predefined states.
<span class='line'>321</span> 		* @param {Object} th The object whose frame is being set.
<span class='line'>322</span> 		* &lt;ul>
<span class='line'>323</span> 		* &lt;li>xpushing: a boolean that notes whether the object is pushing against something in the x direction.&lt;/li>
<span class='line'>324</span> 		* &lt;li>ypushing: a boolean that notes whether the object is pushing against something in the y direction.&lt;/li>
<span class='line'>325</span> 		* &lt;li>haspushing: a boolean that notes if the object changes when pushing against something.&lt;/li>
<span class='line'>326</span> 		* &lt;li>toucheddown: a boolean that notes if the object is touching something below it on the screen.&lt;/li>
<span class='line'>327</span> 		* &lt;li>touchedup: a boolean that notes if the object is touching something above it on the screen.&lt;&lt;/li>
<span class='line'>328</span> 		* &lt;li>touchedright: a boolean that notes if the object is touching something right of it on the screen.&lt;&lt;/li>
<span class='line'>329</span> 		* &lt;li>touchedleft: a boolean that notes if the object is touching something left of it on the screen.&lt;&lt;/li>
<span class='line'>330</span> 		* &lt;li>flipside: &lt;/li>
<span class='line'>331</span> 		* &lt;li>fliph: &lt;/li>
<span class='line'>332</span> 		* &lt;li>facing: &lt;/li>
<span class='line'>333</span> 		* &lt;li>frames: &lt;/li>
<span class='line'>334</span> 		* &lt;li>frame: &lt;/li>
<span class='line'>335</span> 		* &lt;li>counter: &lt;/li>
<span class='line'>336</span> 		* &lt;/ul>
<span class='line'>337</span> 		* // incomplete
<span class='line'>338</span> 		*/</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">		</span><span class="NAME">setFrame</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pref</span><span class="PUNC">=</span><span class="STRN">"stand"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.xpushing</span><span class="PUNC">||</span><span class="NAME">th.ypushing</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>342</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.haspushing</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">th.toucheddown</span><span class="PUNC">||</span><span class="NAME">th.touchedup</span><span class="PUNC">||</span><span class="NAME">th.touchedleft</span><span class="PUNC">||</span><span class="NAME">th.touchedright</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">pref</span><span class="PUNC">=</span><span class="STRN">"pushing"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">pref</span><span class="PUNC">=</span><span class="STRN">"moving"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.flipside</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">				</span><span class="NAME">th.fliph</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.facing</span><span class="PUNC">==</span><span class="NAME">toys.FACE_RIGHT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">			</span><span class="NAME">th.frame</span><span class="PUNC">=</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.counter</span><span class="PUNC">,</span><span class="NAME">th.frames</span><span class="PUNC">[</span><span class="NAME">pref</span><span class="PUNC">+</span><span class="NAME">toys.FACES</span><span class="PUNC">[</span><span class="NAME">th.facing</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>347</span> </span><span class="WHIT">		
<span class='line'>348</span> 		</span><span class="COMM">/**
<span class='line'>349</span> 		* Checks if the specified object is colliding with tiles in the map in an area defined by the object's colw and colh variables as well as the tolerance and approximation variables that are passed in through data. Only tiles in the map marked as solid are checked against. The alogrithm checks the 
<span class='line'>350</span> 		* @param {Object} th The object that is being checked against the tilemap.
<span class='line'>351</span> 		* @param {Object} map This is the asci map that the tile map is generated from.
<span class='line'>352</span> 		* @param {Object} tilemap This is the array of tile objects that it itterated over checking for collisions.
<span class='line'>353</span> 		* @param {Object} defaulttile The default tile to be returned if nothing can be found. Null can be used here.
<span class='line'>354</span> 		* @param {Object} data Passes is extra dat to the function. Can be set as null.
<span class='line'>355</span> 		* &lt;ul>
<span class='line'>356</span> 		* &lt;li>tolerance{Integer}: This is subtracted from the collision space to get the maximum collision area for the object. This defaults to 6.&lt;/li>
<span class='line'>357</span> 		* &lt;li>approximation{Integer}: This is the amount that the checked values are incremented by until they reach the maximum value allowed. This defaults to 10.&lt;/li>
<span class='line'>358</span> 		* &lt;/ul>
<span class='line'>359</span> 		*/</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">		</span><span class="NAME">tileCollision</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">,</span><span class="NAME">defaulttile</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">			
<span class='line'>362</span> 			</span><span class="NAME">th.touchedup</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">			</span><span class="NAME">th.toucheddown</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedleft</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedright</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">			
<span class='line'>367</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tolerance</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">data.tolerance</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">data.tolerance</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">approximation</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">data.approximation</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">data.approximation</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NAME">approximation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">			</span><span class="KEYW">do</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">				</span><span class="NAME">t</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">approximation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">></span><span class="NAME">th.colw</span><span class="PUNC">-</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">th.colw</span><span class="PUNC">-</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colh</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">defaulttile</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">defaulttile</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map.tileIsSolid</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.touchedup</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map.tileIsSolid</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toucheddown</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>377</span> 			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">!=</span><span class="NAME">th.colw</span><span class="PUNC">-</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">			
<span class='line'>379</span> 			</span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NAME">approximation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">			</span><span class="KEYW">do</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">				</span><span class="NAME">t</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">approximation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">></span><span class="NAME">th.colh</span><span class="PUNC">-</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">th.colh</span><span class="PUNC">-</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">defaulttile</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colw</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">defaulttile</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>385</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map.tileIsSolid</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.touchedleft</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map.tileIsSolid</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.touchedright</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">!=</span><span class="NAME">th.colh</span><span class="PUNC">-</span><span class="NAME">tolerance</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">			
<span class='line'>389</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.touchedup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">				</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">help.yPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">th.coly</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>392</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toucheddown</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">				</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">help.yPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colh</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">th.coly</span><span class="PUNC">-</span><span class="NAME">th.colh</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>396</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.touchedleft</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">				</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">help.xPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">th.colx</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>400</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.touchedright</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">				</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">help.xPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colw</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">th.colx</span><span class="PUNC">-</span><span class="NAME">th.colw</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>404</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">			
<span class='line'>406</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">		
<span class='line'>408</span> 		</span><span class="COMM">/**
<span class='line'>409</span> 		* @param {Object} th The object being checked for collisions.
<span class='line'>410</span> 		* &lt;ul>
<span class='line'>411</span> 		* &lt;li>&lt;/li>
<span class='line'>412</span> 		* &lt;li>&lt;/li>
<span class='line'>413</span> 		* &lt;li>&lt;/li>
<span class='line'>414</span> 		* &lt;li>&lt;/li>
<span class='line'>415</span> 		* &lt;/ul>
<span class='line'>416</span> 		* @param {Object} data This is used to pass in other data and arguments.
<span class='line'>417</span> 		* &lt;ul>
<span class='line'>418</span> 		* &lt;li>group {String}: (required) This is the group of objects being checked against.&lt;/li>
<span class='line'>419</span> 		* &lt;li>&lt;/li>
<span class='line'>420</span> 		* &lt;li>&lt;/li>
<span class='line'>421</span> 		* &lt;li>&lt;/li>
<span class='line'>422</span> 		* &lt;li>&lt;/li>
<span class='line'>423</span> 		* &lt;/ul> //incomplete
<span class='line'>424</span> 		*/</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">		</span><span class="NAME">spritewallCollision</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">toys.topview.collides</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">					</span><span class="NAME">wl</span><span class="PUNC">=</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys.topview.pixelcollides</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colhh</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wl</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">						</span><span class="NAME">th.touchedleft</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">						</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">						</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">wl.x</span><span class="PUNC">+</span><span class="NAME">wl.colx</span><span class="PUNC">+</span><span class="NAME">wl.colw</span><span class="PUNC">-</span><span class="NAME">th.colx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys.topview.pixelcollides</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colw</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colhh</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wl</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">						</span><span class="NAME">th.touchedright</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">						</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">						</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">wl.x</span><span class="PUNC">+</span><span class="NAME">wl.colx</span><span class="PUNC">-</span><span class="NAME">th.colw</span><span class="PUNC">-</span><span class="NAME">th.colx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys.topview.pixelcollides</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colhw</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colh</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wl</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">						</span><span class="NAME">th.toucheddown</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">						</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">						</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">wl.y</span><span class="PUNC">+</span><span class="NAME">wl.coly</span><span class="PUNC">-</span><span class="NAME">th.colh</span><span class="PUNC">-</span><span class="NAME">th.coly</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys.topview.pixelcollides</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colhw</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">wl</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">						</span><span class="NAME">th.touchedup</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">						</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">						</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">wl.y</span><span class="PUNC">+</span><span class="NAME">wl.coly</span><span class="PUNC">+</span><span class="NAME">wl.colh</span><span class="PUNC">-</span><span class="NAME">th.coly</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">						
<span class='line'>450</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">		
<span class='line'>452</span> 		</span><span class="COMM">/**
<span class='line'>453</span> 		* This checks if the object's z index is 0 which means it has hit the floor. If this has occured it also plays an impact or bounce noise if one is passed in. Note: The area above the floor is in the negative z index space so a value of 1 for z will return that the object has collided with the floor and z will then be set to zero.
<span class='line'>454</span> 		* @param {Object} th The object being checked for collision.
<span class='line'>455</span> 		* &lt;ul>
<span class='line'>456</span> 		* &lt;li>touchedfloor{boolean}: This value is not passed in but is created or set in the function. This contains the function's return value.&lt;/li>
<span class='line'>457</span> 		* &lt;li>&lt;/li>
<span class='line'>458</span> 		* &lt;li>&lt;/li>
<span class='line'>459</span> 		* &lt;li>&lt;/li>
<span class='line'>460</span> 		* &lt;/ul>
<span class='line'>461</span> 		* @param {Object} data This is used to pass in extra parameters.
<span class='line'>462</span> 		* &lt;ul>
<span class='line'>463</span> 		* &lt;li>&lt;/li>
<span class='line'>464</span> 		* &lt;/ul>
<span class='line'>465</span> 		*/</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">		</span><span class="NAME">floorCollision</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedfloor</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.z</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">				</span><span class="NAME">th.accz</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.accz</span><span class="PUNC">/</span><span class="NAME">data.bounce</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">&&</span><span class="NAME">data.audiobounce</span><span class="PUNC">&&</span><span class="NAME">th.accz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audiobounce</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">				</span><span class="NAME">th.z</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">				</span><span class="NAME">th.touchedfloor</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">			
<span class='line'>474</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">		
<span class='line'>476</span> 		</span><span class="COMM">/**
<span class='line'>477</span> 		* 
<span class='line'>478</span> 		*/</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">		</span><span class="NAME">adjustZindex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">			</span><span class="NAME">gbox.setZindex</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">		
<span class='line'>483</span> 		</span><span class="COMM">/**
<span class='line'>484</span> 		* 
<span class='line'>485</span> 		*/</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">		</span><span class="COMM">// Helper: returns the ahead pixel (i.e. destination use action)</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">		</span><span class="NAME">getAheadPixel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.facing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_RIGHT</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colw</span><span class="PUNC">+</span><span class="NAME">data.distance</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colhh</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_LEFT</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">-</span><span class="NAME">data.distance</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colhh</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_UP</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colhw</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">-</span><span class="NAME">data.distance</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_DOWN</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.colx</span><span class="PUNC">+</span><span class="NAME">th.colhw</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.coly</span><span class="PUNC">+</span><span class="NAME">th.colh</span><span class="PUNC">+</span><span class="NAME">data.distance</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">		
<span class='line'>508</span> 		</span><span class="COMM">/**
<span class='line'>509</span> 		* 
<span class='line'>510</span> 		*/</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">		</span><span class="COMM">// Helper: trigger a method in colliding objects (i.e. "use action")</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">		</span><span class="NAME">callInColliding</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">toys.topview.pixelcollides</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">data.call</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">						</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">data.call</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">		
<span class='line'>522</span> 		</span><span class="COMM">/**
<span class='line'>523</span> 		* 
<span class='line'>524</span> 		*/</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">		</span><span class="COMM">// Enemy methods</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">		</span><span class="NAME">wander</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">,</span><span class="NAME">defaulttile</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.wandercounter</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">th.toucheddown</span><span class="PUNC">||</span><span class="NAME">th.touchedup</span><span class="PUNC">||</span><span class="NAME">th.touchedleft</span><span class="PUNC">||</span><span class="NAME">th.touchedright</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">				</span><span class="NAME">th.wandercounter</span><span class="PUNC">=</span><span class="NAME">help.random</span><span class="PUNC">(</span><span class="NAME">data.minstep</span><span class="PUNC">,</span><span class="NAME">data.steprange</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">				</span><span class="NAME">th.wanderdirection</span><span class="PUNC">=</span><span class="NAME">help.random</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.wandercounter</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.wanderdirection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_LEFT</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">					</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">					</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">					</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">					</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">					</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_RIGHT</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">					</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">					</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">					</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">					</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">					</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>547</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_UP</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">					</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_UP</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">					</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">					</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_UP</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">					</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">					</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">toys.FACE_DOWN</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">					</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_DOWN</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">					</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">					</span><span class="NAME">th.facing</span><span class="PUNC">=</span><span class="NAME">toys.FACE_DOWN</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">					</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">					</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">					
<span class='line'>564</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">		
<span class='line'>567</span> 		</span><span class="COMM">/**
<span class='line'>568</span> 		* 
<span class='line'>569</span> 		*/</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">		</span><span class="COMM">// generators (firebullet specific for topdown - more complex than SHMUP one)</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">		</span><span class="NAME">fireBullet</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>572</span> 
<span class='line'>573</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">data.tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">			
<span class='line'>575</span> 						
<span class='line'>576</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">						</span><span class="NAME">_bullet</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">						</span><span class="NAME">zindex</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">						</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">						</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">						</span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">						</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">						</span><span class="NAME">acc</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">						</span><span class="NAME">angle</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">data.from.camera</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">						</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.accx</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">data.angle</span><span class="PUNC">,</span><span class="NAME">data.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">						</span><span class="NAME">accy</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.accy</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">data.angle</span><span class="PUNC">,</span><span class="NAME">data.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">						</span><span class="NAME">accz</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.sidex</span><span class="PUNC">==</span><span class="NAME">toys.FACE_LEFT</span><span class="PUNC">?</span><span class="NAME">data.from.x</span><span class="PUNC">-</span><span class="NAME">ts.tilehw</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.sidex</span><span class="PUNC">==</span><span class="NAME">toys.FACE_RIGHT</span><span class="PUNC">?</span><span class="NAME">data.from.x</span><span class="PUNC">+</span><span class="NAME">data.from.w</span><span class="PUNC">-</span><span class="NAME">ts.tilehw</span><span class="PUNC">:</span><span class="NAME">data.from.x</span><span class="PUNC">+</span><span class="NAME">data.from.hw</span><span class="PUNC">-</span><span class="NAME">ts.tilehw</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">data.gapx</span><span class="PUNC">?</span><span class="NAME">data.gapx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">						</span><span class="NAME">y</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.sidey</span><span class="PUNC">==</span><span class="NAME">toys.FACE_UP</span><span class="PUNC">?</span><span class="NAME">data.from.y</span><span class="PUNC">-</span><span class="NAME">ts.tilehh</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.sidey</span><span class="PUNC">==</span><span class="NAME">toys.FACE_DOWN</span><span class="PUNC">?</span><span class="NAME">data.from.y</span><span class="PUNC">+</span><span class="NAME">data.from.h</span><span class="PUNC">-</span><span class="NAME">ts.tilehh</span><span class="PUNC">:</span><span class="NAME">data.from.y</span><span class="PUNC">+</span><span class="NAME">data.from.hh</span><span class="PUNC">-</span><span class="NAME">ts.tilehh</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">data.gapy</span><span class="PUNC">?</span><span class="NAME">data.gapy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">						</span><span class="NAME">z</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.from.z</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">data.from.z</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">						</span><span class="NAME">collidegroup</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">						</span><span class="NAME">spark</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">						</span><span class="NAME">power</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">						</span><span class="NAME">lifetime</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">						</span><span class="NAME">tilemap</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">						</span><span class="NAME">defaulttile</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">						</span><span class="NAME">applyzgravity</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">						</span><span class="NAME">map</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">						</span><span class="NAME">defaulttile</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">						</span><span class="NAME">mapindex</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">						</span><span class="NAME">spritewalls</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">						</span><span class="NAME">colx</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">						</span><span class="NAME">coly</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">						</span><span class="NAME">colh</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NAME">ts.tileh</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">						</span><span class="NAME">colw</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NAME">ts.tilew</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">						</span><span class="NAME">duration</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">						</span><span class="NAME">onWallHit</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">							</span><span class="NAME">this.spark</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">							</span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">						</span><span class="NAME">bulletIsAlive</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">							</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">gbox.objectIsVisible</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">			
<span class='line'>623</span> 			</span><span class="NAME">obj.initialize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">				</span><span class="NAME">toys.topview.initialize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">			
<span class='line'>627</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">				</span><span class="NAME">this.cnt</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">				
<span class='line'>630</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.applyzgravity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">toys.topview.handleGravity</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// z-gravity					</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">				</span><span class="NAME">toys.topview.applyForces</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Apply forces</span><span class="WHIT">
<span class='line'>632</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.applyzgravity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">toys.topview.applyGravity</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// z-gravity</span><span class="WHIT">
<span class='line'>633</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.map</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">toys.topview.tileCollision</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.map</span><span class="PUNC">,</span><span class="NAME">this.mapindex</span><span class="PUNC">,</span><span class="NAME">this.defaulttile</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// tile collisions</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.spritewalls</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">toys.topview.spritewallCollision</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">this.spritewalls</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// walls collisions</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.applyzgravity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">toys.topview.floorCollision</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Collision with the floor (for z-gravity)</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">				</span><span class="NAME">toys.topview.adjustZindex</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">					</span><span class="NAME">this.duration</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.duration</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.bulletIsAlive</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.toucheddown</span><span class="PUNC">||</span><span class="NAME">this.touchedup</span><span class="PUNC">||</span><span class="NAME">this.touchedleft</span><span class="PUNC">||</span><span class="NAME">this.touchedright</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.onWallHit</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collidegroup</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">toys.topview.collides</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tolerance</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"hitByBullet"</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hitByBullet</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">									</span><span class="NAME">this.spark</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">									</span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">			
<span class='line'>654</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox.objectIsTrash</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">,</span><span class="NAME">this.frames</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="NAME">this.z</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">			
<span class='line'>659</span> 			</span><span class="NAME">gbox.setZindex</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">obj.y</span><span class="PUNC">+</span><span class="NAME">obj.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>660</span> </span><span class="WHIT">			
<span class='line'>661</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">		
<span class='line'>663</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">		
<span class='line'>665</span> 		</span><span class="COMM">/**
<span class='line'>666</span> 		* 
<span class='line'>667</span> 		*/</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">		</span><span class="NAME">makedoor</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>669</span> 
<span class='line'>670</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">map.tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">data.tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">						
<span class='line'>673</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">						</span><span class="NAME">zindex</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">						</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">						</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>680</span> </span><span class="WHIT">						</span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>681</span> </span><span class="WHIT">						</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>682</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>683</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">data.tilex</span><span class="PUNC">*</span><span class="NAME">mts.tilew</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">						</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">data.tiley</span><span class="PUNC">*</span><span class="NAME">mts.tileh</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">						</span><span class="NAME">z</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">						</span><span class="NAME">tilemap</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">						</span><span class="NAME">defaulttile</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">						</span><span class="NAME">map</span><span class="PUNC">:</span><span class="NAME">map</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">						</span><span class="NAME">colx</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">						</span><span class="NAME">coly</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">						</span><span class="NAME">colh</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NAME">ts.tileh</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">						</span><span class="NAME">colw</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fullhit</span><span class="PUNC">?</span><span class="NAME">ts.tilew</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">						</span><span class="NAME">opening</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">						</span><span class="NAME">doorheight</span><span class="PUNC">:</span><span class="NAME">ts.tileh</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">						</span><span class="NAME">opencounter</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">						</span><span class="NAME">opening</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">						</span><span class="NAME">closing</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">						</span><span class="NAME">audiobefore</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">						</span><span class="NAME">audioafter</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">						</span><span class="NAME">doOpen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">							</span><span class="NAME">this.opening</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">						</span><span class="NAME">whenClosed</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">						</span><span class="NAME">whenOpened</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">						</span><span class="NAME">whileMoving</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">						</span><span class="NAME">hitByBullet</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">						
<span class='line'>709</span> 						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">			
<span class='line'>714</span> 			</span><span class="COMM">// Closing animation</span><span class="WHIT">
<span class='line'>715</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj.closing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">obj.opencounter</span><span class="PUNC">=</span><span class="NAME">obj.doorheight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">			
<span class='line'>717</span> 			</span><span class="NAME">obj.initialize</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">				</span><span class="NAME">this.ismoving</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">				</span><span class="NAME">toys.topview.initialize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">			
<span class='line'>722</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.closing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.ismoving</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audiobefore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">this.audiobefore</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">						</span><span class="NAME">this.ismoving</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">					</span><span class="NAME">this.whileMoving</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">					</span><span class="NAME">this.opencounter</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opencounter</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audioafter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">this.audioafter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">						</span><span class="NAME">this.ismoving</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">						</span><span class="NAME">this.opencounter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">						</span><span class="NAME">this.closing</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">						</span><span class="NAME">this.whenClosed</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opening</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.ismoving</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audiobefore</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">this.audiobefore</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">						</span><span class="NAME">this.ismoving</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">					</span><span class="NAME">this.whileMoving</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">					</span><span class="NAME">this.opencounter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.opencounter</span><span class="PUNC">>=</span><span class="NAME">this.doorheight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audioafter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">this.audioafter</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">						</span><span class="NAME">this.ismoving</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.whenOpened</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">			
<span class='line'>753</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox.objectIsTrash</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">,</span><span class="NAME">this.frames</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="NAME">this.z</span><span class="PUNC">+</span><span class="NAME">this.opencounter</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">this.h</span><span class="PUNC">-</span><span class="NAME">this.opencounter</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">			
<span class='line'>758</span> 			</span><span class="NAME">gbox.setZindex</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">obj.y</span><span class="PUNC">+</span><span class="NAME">obj.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">			
<span class='line'>760</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">		</span><span class="COMM">// Set the object speed making sure that the X and Y coords are multiple of the speed. Useful on maze-based games.</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">		</span><span class="NAME">setStaticSpeed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">speed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">			</span><span class="NAME">th.staticspeed</span><span class="PUNC">=</span><span class="NAME">speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">			</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">/</span><span class="NAME">speed</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">			</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">th.y</span><span class="PUNC">/</span><span class="NAME">speed</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">	
<span class='line'>770</span> 	
<span class='line'>771</span> 	</span><span class="COMM">/**
<span class='line'>772</span> 	* @namespace shmup The libraries for a 2D top-down Shmup game.
<span class='line'>773</span> 	*/</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">	</span><span class="COMM">// Shoot'em up specifics</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">	</span><span class="NAME">shmup</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">		
<span class='line'>777</span> 		</span><span class="COMM">/**
<span class='line'>778</span> 		* 
<span class='line'>779</span> 		*/</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">		</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">			</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">				</span><span class="NAME">th</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">						</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">						</span><span class="NAME">maxacc</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">controlmaxacc</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">						</span><span class="NAME">responsive</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Responsiveness</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">						</span><span class="NAME">bounds</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Bounds box (ship cannot exit from there)</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">						</span><span class="NAME">weapon</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Weapon</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">						</span><span class="NAME">hittime</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">						</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">						</span><span class="NAME">health</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">						</span><span class="NAME">tolerance</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>799</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>800</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">			</span><span class="NAME">toys.shmup.spawn</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">		
<span class='line'>804</span> 		</span><span class="COMM">/**
<span class='line'>805</span> 		* 
<span class='line'>806</span> 		*/</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">		</span><span class="NAME">spawn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">			</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// user is moving side</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">			</span><span class="NAME">th.vpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// user is moving side</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">			</span><span class="NAME">th.counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// self counter</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">			</span><span class="NAME">th.hittimer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">			</span><span class="NAME">th.killed</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">			</span><span class="NAME">help.copyModel</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">		
<span class='line'>816</span> 		</span><span class="COMM">/**
<span class='line'>817</span> 		* 
<span class='line'>818</span> 		*/</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">		</span><span class="NAME">getNextX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxacc</span><span class="PUNC">,</span><span class="NAME">th.maxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">		
<span class='line'>821</span> 		</span><span class="COMM">/**
<span class='line'>822</span> 		* 
<span class='line'>823</span> 		*/</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">		</span><span class="NAME">getNextY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxacc</span><span class="PUNC">,</span><span class="NAME">th.maxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">		
<span class='line'>826</span> 		</span><span class="COMM">/**
<span class='line'>827</span> 		* 
<span class='line'>828</span> 		*/</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">		</span><span class="NAME">controlKeys</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">keys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">			
<span class='line'>831</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">				</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">></span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">				</span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.xpushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.up</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">				</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_UP</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">></span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.down</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">				</span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_DOWN</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">&lt;</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.responsive</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">,</span><span class="NAME">th.controlmaxacc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.ypushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">		
<span class='line'>851</span> 		</span><span class="COMM">/**
<span class='line'>852</span> 		* 
<span class='line'>853</span> 		*/</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">		</span><span class="NAME">applyForces</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">			</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">toys.shmup.getNextX</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">			</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">toys.shmup.getNextY</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">		
<span class='line'>859</span> 		</span><span class="COMM">/**
<span class='line'>860</span> 		* 
<span class='line'>861</span> 		*/</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">		</span><span class="NAME">handleAccellerations</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.xpushing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.goToZero</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.ypushing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NAME">help.goToZero</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">		
<span class='line'>867</span> 		</span><span class="COMM">/**
<span class='line'>868</span> 		* 
<span class='line'>869</span> 		*/</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">		</span><span class="NAME">keepInBounds</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">&lt;</span><span class="NAME">th.bounds.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">				</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">th.bounds.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.w</span><span class="PUNC">></span><span class="NAME">th.bounds.x</span><span class="PUNC">+</span><span class="NAME">th.bounds.w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">				</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">th.bounds.x</span><span class="PUNC">+</span><span class="NAME">th.bounds.w</span><span class="PUNC">-</span><span class="NAME">th.w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>877</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.y</span><span class="PUNC">&lt;</span><span class="NAME">th.bounds.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">				</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">th.bounds.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">></span><span class="NAME">th.bounds.y</span><span class="PUNC">+</span><span class="NAME">th.bounds.h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">				</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">th.bounds.y</span><span class="PUNC">+</span><span class="NAME">th.bounds.h</span><span class="PUNC">-</span><span class="NAME">th.h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>884</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">		
<span class='line'>887</span> 		</span><span class="COMM">/**
<span class='line'>888</span> 		* 
<span class='line'>889</span> 		*/</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">		</span><span class="NAME">setFrame</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.hittimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.hittimer</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">			</span><span class="NAME">th.frame</span><span class="PUNC">=</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.counter</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">th.hittimer</span><span class="PUNC">?</span><span class="NAME">th.frames.hit</span><span class="PUNC">:</span><span class="NAME">th.frames.still</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">		
<span class='line'>895</span> 		</span><span class="COMM">/**
<span class='line'>896</span> 		* 
<span class='line'>897</span> 		*/</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">		</span><span class="NAME">fireBullet</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">		
<span class='line'>900</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">data.tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">			
<span class='line'>902</span> 			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">						</span><span class="NAME">_bullet</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">						</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">						</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">						</span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">						</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">						</span><span class="NAME">acc</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">						</span><span class="NAME">angle</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">						</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.accx</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">data.angle</span><span class="PUNC">,</span><span class="NAME">data.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">						</span><span class="NAME">accy</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.accy</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">data.angle</span><span class="PUNC">,</span><span class="NAME">data.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">data.from.x</span><span class="PUNC">+</span><span class="NAME">data.from.hw</span><span class="PUNC">-</span><span class="NAME">ts.tilehw</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">data.gapx</span><span class="PUNC">?</span><span class="NAME">data.gapx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">						</span><span class="NAME">y</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.upper</span><span class="PUNC">?</span><span class="NAME">data.from.y</span><span class="PUNC">-</span><span class="NAME">ts.tilehh</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">data.gapy</span><span class="PUNC">?</span><span class="NAME">data.gapy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">data.from.y</span><span class="PUNC">+</span><span class="NAME">data.from.h</span><span class="PUNC">-</span><span class="NAME">ts.tilehh</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">data.gapy</span><span class="PUNC">?</span><span class="NAME">data.gapy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">						</span><span class="NAME">collidegroup</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">						</span><span class="NAME">spark</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">						</span><span class="NAME">power</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">			
<span class='line'>926</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">				</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">				</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">				</span><span class="NAME">this.cnt</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox.objectIsVisible</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.collidegroup</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">gbox.collides</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tolerance</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"hitByBullet"</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">this.collidegroup</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hitByBullet</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">									</span><span class="NAME">this.spark</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">									</span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">			
<span class='line'>942</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">,</span><span class="NAME">this.frames</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.side</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">			
<span class='line'>946</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">		
<span class='line'>948</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">		
<span class='line'>950</span> 		</span><span class="COMM">/**
<span class='line'>951</span> 		* 
<span class='line'>952</span> 		*/</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">		</span><span class="NAME">hitByBullet</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">by.power</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">				</span><span class="NAME">th.health</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">by.power</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.health</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.kill</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">  </span><span class="NAME">th.hittimer</span><span class="PUNC">=</span><span class="NAME">th.hittime</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">		
<span class='line'>960</span> 		</span><span class="COMM">/**
<span class='line'>961</span> 		* 
<span class='line'>962</span> 		*/</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">		</span><span class="NAME">generateEnemy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">			</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">model</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">						</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">						</span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">						</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">						</span><span class="NAME">acc</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">						</span><span class="NAME">angle</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">						</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">						</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">						</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.accx</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">data.angle</span><span class="PUNC">,</span><span class="NAME">data.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">						</span><span class="NAME">accy</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.accy</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">data.angle</span><span class="PUNC">,</span><span class="NAME">data.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>980</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">						</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">						</span><span class="COMM">// -- spec</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">						</span><span class="NAME">animationset</span><span class="PUNC">:</span><span class="STRN">"still"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">						</span><span class="NAME">defaultanimationset</span><span class="PUNC">:</span><span class="STRN">"still"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">						</span><span class="NAME">hitanimationset</span><span class="PUNC">:</span><span class="STRN">"still"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">						</span><span class="NAME">hittime</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">						</span><span class="NAME">script</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">						</span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">						</span><span class="NAME">scriptline</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.scriptline</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">data.scriptline</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">						</span><span class="NAME">newline</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">						</span><span class="NAME">waitframes</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">						</span><span class="NAME">doframes</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">						</span><span class="NAME">mode</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">						</span><span class="NAME">line</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">						</span><span class="NAME">dohandler</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">						</span><span class="NAME">ended</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">						</span><span class="NAME">health</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">						</span><span class="NAME">hittimer</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">						</span><span class="NAME">kill</span><span class="PUNC">:</span><span class="NAME">toys.NOOP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">						</span><span class="NAME">tolerance</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">						</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">						</span><span class="NAME">invulnerable</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">						</span><span class="NAME">hitAnimation</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">time</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">							</span><span class="NAME">this.hittimer</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">time</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">this.hittime</span><span class="PUNC">:</span><span class="NAME">time</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">							</span><span class="NAME">this.animationset</span><span class="PUNC">=</span><span class="NAME">this.hitanimationset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">						</span><span class="NAME">goTo</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Jump to a line</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">							</span><span class="NAME">this.waitframes</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">							</span><span class="NAME">this.doframes</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">							</span><span class="NAME">this.line</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">							</span><span class="NAME">this.scriptline</span><span class="PUNC">=</span><span class="NAME">nl</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">						</span><span class="NAME">hitByBullet</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.invulnerable</span><span class="PUNC">&&</span><span class="NAME">by.power</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">								</span><span class="NAME">this.health</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">by.power</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.health</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.kill</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.hitAnimation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">			
<span class='line'>1023</span> 			
<span class='line'>1024</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.initialize</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">					</span><span class="NAME">this.initialize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">					</span><span class="NAME">this.initialize</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.ended</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.waitframes</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.doframes</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.line.waitfor</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">this.line.waitfor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">						</span><span class="NAME">this.scriptline</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">						</span><span class="NAME">this.everycnt</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.script</span><span class="PUNC">[</span><span class="NAME">this.scriptline</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">							</span><span class="NAME">this.ended</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.script</span><span class="PUNC">[</span><span class="NAME">this.scriptline</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">goto</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scriptline</span><span class="PUNC">=</span><span class="NAME">this.script</span><span class="PUNC">[</span><span class="NAME">this.scriptline</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">goto</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">							</span><span class="NAME">this.line</span><span class="PUNC">=</span><span class="NAME">this.script</span><span class="PUNC">[</span><span class="NAME">this.scriptline</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.afterframes</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">								</span><span class="NAME">this.waitframes</span><span class="PUNC">=</span><span class="NAME">this.line.afterframes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.forframes</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">								</span><span class="NAME">this.doframes</span><span class="PUNC">=</span><span class="NAME">this.line.forframes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">								</span><span class="NAME">this.doframes</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.cleardo</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">								</span><span class="NAME">this.dohandler</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.doit</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">								</span><span class="NAME">this.dohandler</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">									</span><span class="NAME">actiontimes</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">									</span><span class="NAME">timer</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.line.doit.every</span><span class="PUNC">==</span><span class="STRN">"keep"</span><span class="PUNC">?</span><span class="NAME">this.dohandler.every</span><span class="PUNC">:</span><span class="NAME">this.line.doit.every</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">									</span><span class="NAME">every</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.line.doit.every</span><span class="PUNC">==</span><span class="STRN">"keep"</span><span class="PUNC">?</span><span class="NAME">this.dohandler.every</span><span class="PUNC">:</span><span class="NAME">this.line.doit.every</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">									</span><span class="NAME">once</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.line.doit.once</span><span class="PUNC">==</span><span class="STRN">"keep"</span><span class="PUNC">?</span><span class="NAME">this.dohandler.once</span><span class="PUNC">:</span><span class="NAME">this.line.doit.once</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">									</span><span class="NAME">action</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.line.doit.action</span><span class="PUNC">==</span><span class="STRN">"keep"</span><span class="PUNC">?</span><span class="NAME">this.dohandler.action</span><span class="PUNC">:</span><span class="NAME">this.line.doit.action</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">									</span><span class="NAME">render</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.line.doit.render</span><span class="PUNC">==</span><span class="STRN">"keep"</span><span class="PUNC">?</span><span class="NAME">this.dohandler.render</span><span class="PUNC">:</span><span class="NAME">this.line.doit.render</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">								
<span class='line'>1057</span> 						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.waitframes</span><span class="PUNC">&&</span><span class="NAME">this.doframes</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">this.ended</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="WHIT">						</span><span class="NAME">this.doframes</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.setinvulnerable</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.invulnerable</span><span class="PUNC">=</span><span class="NAME">this.line.setinvulnerable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.setx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">this.line.setx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1063</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.sety</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.line.sety</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1064</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.addx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.line.addx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.addy</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.line.addy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.setaccx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.accx</span><span class="PUNC">=</span><span class="NAME">this.line.setaccx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.setaccy</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.accy</span><span class="PUNC">=</span><span class="NAME">this.line.setaccy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.setacc</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">							</span><span class="NAME">this.acc</span><span class="PUNC">=</span><span class="NAME">this.line.setacc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">							</span><span class="NAME">this.accx</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">							</span><span class="NAME">this.accy</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.addaccx</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.accx</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.line.addaccx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.addaccy</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.accy</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.line.addaccy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.addacc</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">							</span><span class="NAME">this.acc</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.line.addacc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">							</span><span class="NAME">this.accx</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">							</span><span class="NAME">this.accy</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">						
<span class='line'>1081</span> 						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.setangle</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">							</span><span class="NAME">this.angle</span><span class="PUNC">=</span><span class="NAME">this.line.setangle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">							</span><span class="NAME">this.accx</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">							</span><span class="NAME">this.accy</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.addangle</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">							</span><span class="NAME">this.angle</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.line.addangle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">							</span><span class="NAME">this.accx</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateX</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">							</span><span class="NAME">this.accy</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">trigo.translateY</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.angle</span><span class="PUNC">,</span><span class="NAME">this.acc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.line.everyframe</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.waitframes</span><span class="PUNC">=</span><span class="NAME">this.line.everyframe</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">							
<span class='line'>1093</span> 					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.waitframes</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.waitframes</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.dohandler</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.dohandler.action</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.dohandler.timer</span><span class="PUNC">==</span><span class="NAME">this.dohandler.every</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">						</span><span class="NAME">this.dohandler.action</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.dohandler.actiontimes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">						</span><span class="NAME">this.dohandler.timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">						</span><span class="NAME">this.dohandler.actiontimes</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.dohandler.once</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.dohandler.timer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.handler</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.handler</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">				
<span class='line'>1105</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.hittimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">					</span><span class="NAME">this.hittimer</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.hittimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.animationset</span><span class="PUNC">=</span><span class="NAME">this.defaultanimationset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">				
<span class='line'>1110</span> 				</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">				</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">				</span><span class="NAME">this.cnt</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">				
<span class='line'>1114</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1115</span> 
<span class='line'>1116</span> </span><span class="WHIT">			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">,</span><span class="NAME">this.frames</span><span class="PUNC">[</span><span class="NAME">this.animationset</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.side</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.dohandler</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.dohandler.render</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.dohandler.render</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">			
<span class='line'>1121</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1122</span> 
<span class='line'>1123</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">		
<span class='line'>1125</span> 		</span><span class="COMM">/**
<span class='line'>1126</span> 		* 
<span class='line'>1127</span> 		*/</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">		</span><span class="NAME">generateScroller</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">					</span><span class="NAME">help.cloneObject</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">gr</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">						</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">						</span><span class="NAME">stage</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">						</span><span class="NAME">speed</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">						</span><span class="NAME">stop</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Remember to set the last stop ever! or the last loop!</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">						</span><span class="NAME">block</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">						</span><span class="NAME">bly</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">						</span><span class="NAME">lblock</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">						</span><span class="NAME">lbly</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">						</span><span class="NAME">lget</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">						</span><span class="NAME">tbly</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">						</span><span class="NAME">trb</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">						</span><span class="NAME">maxwidth</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">						</span><span class="NAME">loopstart</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loopend</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">looprounds</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">						</span><span class="NAME">panspeed</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">panstimer</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">destspeed</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">						
<span class='line'>1148</span> 						</span><span class="NAME">setLoop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">st</span><span class="PUNC">,</span><span class="NAME">en</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">							</span><span class="NAME">this.loopstart</span><span class="PUNC">=</span><span class="NAME">st</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">							</span><span class="NAME">this.loopend</span><span class="PUNC">=</span><span class="NAME">en</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">							</span><span class="NAME">this.lget</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">							</span><span class="NAME">this.looprounds</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">						
<span class='line'>1155</span> 						</span><span class="NAME">quitLoop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">							</span><span class="NAME">this.setLoop</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">							</span><span class="NAME">this.looprounds</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">					
<span class='line'>1160</span> 						</span><span class="NAME">setSpeed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">							</span><span class="NAME">this.speed</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">							</span><span class="NAME">this.destspeed</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">						
<span class='line'>1165</span> 						</span><span class="NAME">panToSpeed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="NAME">pans</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">							</span><span class="NAME">this.destspeed</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">							</span><span class="NAME">this.panspeed</span><span class="PUNC">=</span><span class="NAME">pans</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">						
<span class='line'>1170</span> 						</span><span class="NAME">quitStop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">							</span><span class="NAME">this.stop</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">						
<span class='line'>1174</span> 						</span><span class="NAME">setStop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">							</span><span class="NAME">this.stop</span><span class="PUNC">=</span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">						
<span class='line'>1178</span> 						</span><span class="NAME">setX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">this.maxwidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">this.maxwidth</span><span class="PUNC">-</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">						
<span class='line'>1184</span> 					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">			
<span class='line'>1188</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.stop</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">&lt;</span><span class="NAME">this.stop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.speed</span><span class="PUNC">!=</span><span class="NAME">this.destspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.panstimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">							</span><span class="NAME">this.panstimer</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.speed</span><span class="PUNC">&lt;</span><span class="NAME">this.destspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.speed</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.speed</span><span class="PUNC">></span><span class="NAME">this.destspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.speed</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">							</span><span class="NAME">this.panstimer</span><span class="PUNC">=</span><span class="NAME">this.panspeed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">					</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.stop</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">>=</span><span class="NAME">this.stop</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.stop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.loopend</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">></span><span class="NAME">this.loopend</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">						</span><span class="NAME">this.y</span><span class="PUNC">=</span><span class="NAME">this.loopstart</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this.y</span><span class="PUNC">-</span><span class="NAME">this.loopend</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">						</span><span class="NAME">this.looprounds</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.lget</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">							</span><span class="NAME">this.block</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">							</span><span class="NAME">this.bly</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">							</span><span class="NAME">this.lget</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">							</span><span class="NAME">this.block</span><span class="PUNC">=</span><span class="NAME">this.lblock</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">							</span><span class="NAME">this.bly</span><span class="PUNC">=</span><span class="NAME">this.lbly</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">						
<span class='line'>1213</span> 					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">						
<span class='line'>1216</span> 				</span><span class="COMM">// Cerca il blocco da mostrare</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">				</span><span class="NAME">this.trb</span><span class="PUNC">=</span><span class="NAME">this.block</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">				</span><span class="NAME">this.tbly</span><span class="PUNC">=</span><span class="NAME">this.bly</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">				</span><span class="KEYW">do</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">					</span><span class="NAME">this.trb</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">					</span><span class="NAME">this.tbly</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">this.stage</span><span class="PUNC">[</span><span class="NAME">this.trb</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>1222</span> 				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.tbly</span><span class="PUNC">&lt;</span><span class="NAME">this.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">				
<span class='line'>1224</span> 				</span><span class="NAME">this.block</span><span class="PUNC">=</span><span class="NAME">this.trb</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">				</span><span class="NAME">this.bly</span><span class="PUNC">=</span><span class="NAME">this.tbly</span><span class="PUNC">-</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">this.stage</span><span class="PUNC">[</span><span class="NAME">this.trb</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">				
<span class='line'>1227</span> 						
<span class='line'>1228</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.lget</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">					</span><span class="NAME">this.lblock</span><span class="PUNC">=</span><span class="NAME">this.block</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">					</span><span class="NAME">this.lbly</span><span class="PUNC">=</span><span class="NAME">this.bly</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">					</span><span class="NAME">this.lget</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">				
<span class='line'>1234</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">				
<span class='line'>1236</span> 			</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">this.tbly</span><span class="PUNC">-</span><span class="NAME">this.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">				</span><span class="KEYW">do</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dy</span><span class="PUNC">></span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">this.stage</span><span class="PUNC">[</span><span class="NAME">this.trb</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">dy</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">					</span><span class="NAME">this.trb</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">					</span><span class="NAME">dy</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">this.stage</span><span class="PUNC">[</span><span class="NAME">this.trb</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">done</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">			
<span class='line'>1247</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1248</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1249</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">		
<span class='line'>1251</span> 	</span><span class="COMM">/**
<span class='line'>1252</span> 	* @namespace platformer The libraries for generating a 2D platformer game.
<span class='line'>1253</span> 	*/</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">	</span><span class="NAME">platformer</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="WHIT">		
<span class='line'>1256</span> 		</span><span class="COMM">/**
<span class='line'>1257</span> 		* 
<span class='line'>1258</span> 		*/</span><span class="WHIT">
<span class='line'>1259</span> </span><span class="WHIT">		</span><span class="NAME">initialize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">			</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">				</span><span class="NAME">th</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">				</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">						</span><span class="NAME">maxaccx</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxaccy</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">						</span><span class="NAME">jumpsize</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jumpaccy</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">						</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">						</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">						</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">						</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">						</span><span class="NAME">side</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">			</span><span class="NAME">toys.platformer.spawn</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">		
<span class='line'>1279</span> 		</span><span class="COMM">/**
<span class='line'>1280</span> 		* 
<span class='line'>1281</span> 		*/</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">		</span><span class="NAME">spawn</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">			</span><span class="NAME">th.curjsize</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// current jump size</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">			</span><span class="NAME">th.counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// self counter</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedfloor</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// touched floor</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedceil</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedleftwall</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedrightwall</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">			</span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// user is moving side</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">			</span><span class="NAME">th.killed</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">			</span><span class="NAME">help.copyModel</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">		
<span class='line'>1294</span> 		</span><span class="COMM">/**
<span class='line'>1295</span> 		* 
<span class='line'>1296</span> 		*/</span><span class="WHIT">
<span class='line'>1297</span> </span><span class="WHIT">		</span><span class="NAME">getNextX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.accx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">		
<span class='line'>1299</span> 		</span><span class="COMM">/**
<span class='line'>1300</span> 		* 
<span class='line'>1301</span> 		*/</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">		</span><span class="NAME">getNextY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxaccy</span><span class="PUNC">,</span><span class="NAME">th.maxaccy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">		
<span class='line'>1304</span> 		</span><span class="COMM">/**
<span class='line'>1305</span> 		* 
<span class='line'>1306</span> 		*/</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">		</span><span class="NAME">applyGravity</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">			</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">toys.platformer.getNextX</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">			</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">toys.platformer.getNextY</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	
<span class='line'>1311</span> 		
<span class='line'>1312</span> 		</span><span class="COMM">/**
<span class='line'>1313</span> 		* 
<span class='line'>1314</span> 		*/</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">		</span><span class="NAME">horizontalKeys</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">keys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">				</span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxaccx</span><span class="PUNC">,</span><span class="NAME">th.maxaccx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsPressed</span><span class="PUNC">(</span><span class="NAME">keys.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">				</span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">				</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.limit</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NAME">th.maxaccx</span><span class="PUNC">,</span><span class="NAME">th.maxaccx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">		
<span class='line'>1325</span> 		</span><span class="COMM">/**
<span class='line'>1326</span> 		* 
<span class='line'>1327</span> 		*/</span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">		</span><span class="NAME">verticalTileCollision</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">th.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">th.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedfloor</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedceil</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">	
<span class='line'>1334</span> 			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map.tileIsSolidCeil</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">				</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">help.yPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">				</span><span class="NAME">th.touchedceil</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">map.tileIsSolidFloor</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">				</span><span class="NAME">th.y</span><span class="PUNC">=</span><span class="NAME">help.yPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">th.h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">				</span><span class="NAME">th.touchedfloor</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">		
<span class='line'>1346</span> 		</span><span class="COMM">/**
<span class='line'>1347</span> 		* 
<span class='line'>1348</span> 		*/</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">		</span><span class="NAME">horizontalTileCollision</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">			
<span class='line'>1354</span> 			</span><span class="NAME">th.touchedleftwall</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">			</span><span class="NAME">th.touchedrightwall</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">			
<span class='line'>1357</span> 			</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">&lt;</span><span class="NAME">th.h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">				</span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">				</span><span class="NAME">right</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.w</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">					
<span class='line'>1361</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">map.tileIsSolidFloor</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">					</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">					</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">help.xPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.x</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">					</span><span class="NAME">th.touchedleftwall</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>1366</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">map.tileIsSolidFloor</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">					</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">					</span><span class="NAME">th.x</span><span class="PUNC">=</span><span class="NAME">help.xPixelToTile</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.w</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">th.w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">					</span><span class="NAME">th.touchedrightwall</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">				</span><span class="NAME">t</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">map.tileset</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">		
<span class='line'>1375</span> 		</span><span class="COMM">/**
<span class='line'>1376</span> 		* Checks if the passed object is touching the floor and can therefore jump at present.
<span class='line'>1377</span> 		* @param th This is the object being checked for jump ability at the time of calling.
<span class='line'>1378</span> 		*/</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">		</span><span class="NAME">canJump</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.touchedfloor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">		
<span class='line'>1383</span> 		</span><span class="COMM">/**
<span class='line'>1384</span> 		* 
<span class='line'>1385</span> 		*/</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">		</span><span class="NAME">jumpKeys</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">key</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">toys.platformer.canJump</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">key.doublejump</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">key.jump</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">th.curjsize</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">key.audiojump</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">key.audiojump</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">th.jumpaccy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">				</span><span class="NAME">th.curjsize</span><span class="PUNC">=</span><span class="NAME">th.jumpsize</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.curjsize</span><span class="PUNC">&&</span><span class="NAME">gbox.keyIsHold</span><span class="PUNC">(</span><span class="NAME">key.jump</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Jump modulation</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">				</span><span class="NAME">th.accy</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">				</span><span class="NAME">th.curjsize</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">				</span><span class="NAME">th.curjsize</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">		
<span class='line'>1400</span> 		</span><span class="COMM">/**
<span class='line'>1401</span> 		* 
<span class='line'>1402</span> 		*/</span><span class="WHIT">	
<span class='line'>1403</span> 		</span><span class="NAME">bounce</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">			</span><span class="NAME">th.curjsize</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">			</span><span class="NAME">th.accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">data.jumpsize</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">		
<span class='line'>1408</span> 		</span><span class="COMM">/**
<span class='line'>1409</span> 		* 
<span class='line'>1410</span> 		*/</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">		</span><span class="NAME">handleAccellerations</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">			</span><span class="COMM">// Gravity</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.touchedfloor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accy</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">			</span><span class="COMM">// Attrito</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.pushing</span><span class="PUNC">==</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">help.goToZero</span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">		
<span class='line'>1418</span> 		</span><span class="COMM">/**
<span class='line'>1419</span> 		* 
<span class='line'>1420</span> 		*/</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">		</span><span class="NAME">setSide</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.side</span><span class="PUNC">=</span><span class="NAME">th.accx</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">		
<span class='line'>1425</span> 		</span><span class="COMM">/**
<span class='line'>1426</span> 		* 
<span class='line'>1427</span> 		*/</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">		</span><span class="NAME">setFrame</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.touchedfloor</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.pushing</span><span class="PUNC">!=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">					</span><span class="NAME">th.frame</span><span class="PUNC">=</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.counter</span><span class="PUNC">,</span><span class="NAME">th.frames.walking</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">					</span><span class="NAME">th.frame</span><span class="PUNC">=</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.counter</span><span class="PUNC">,</span><span class="NAME">th.frames.still</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accy</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">				</span><span class="NAME">th.frame</span><span class="PUNC">=</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.counter</span><span class="PUNC">,</span><span class="NAME">th.frames.falling</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">				</span><span class="NAME">th.frame</span><span class="PUNC">=</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.counter</span><span class="PUNC">,</span><span class="NAME">th.frames.jumping</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">		
<span class='line'>1440</span> 		</span><span class="COMM">/**
<span class='line'>1441</span> 		* 
<span class='line'>1442</span> 		*/</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">		</span><span class="NAME">auto</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">			</span><span class="COMM">// Moves on a platform. It tries to do not fall down, if specified.</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">			</span><span class="COMM">// Args: (object,{moveWhileFalling:&lt;moves while not touching the floor>,speed:&lt;movement speed>})</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">			</span><span class="COMM">// Outs: the frame</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">			</span><span class="NAME">goomba</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.moveWhileFalling</span><span class="PUNC">||</span><span class="NAME">th.touchedfloor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.side</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">						</span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_LEFT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">						</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">						</span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_RIGHT</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">						</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.pushing</span><span class="PUNC">=</span><span class="NAME">toys.PUSH_NONE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">			</span><span class="NAME">dontFall</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1459</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">&&</span><span class="NAME">th.touchedfloor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">til</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.accx</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">til</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">toys.platformer.getNextX</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">th.w</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">+</span><span class="NAME">th.accx</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				
<span class='line'>1462</span> 					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">til</span><span class="PUNC">=</span><span class="NAME">help.getTileInMap</span><span class="PUNC">(</span><span class="NAME">toys.platformer.getNextX</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.h</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">map.tileIsSolidFloor</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">til</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">						</span><span class="NAME">th.side</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">th.side</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">						</span><span class="NAME">th.accx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">			</span><span class="NAME">horizontalBounce</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.touchedleftwall</span><span class="PUNC">||</span><span class="NAME">th.touchedrightwall</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.side</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">th.side</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">	
<span class='line'>1475</span> 	</span><span class="COMM">// State-based toys</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">	</span><span class="COMM">// CONSTANTS</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">	</span><span class="NAME">TOY_BUSY</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">	</span><span class="NAME">TOY_DONE</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">	</span><span class="NAME">TOY_IDLE</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">	
<span class='line'>1481</span> 	</span><span class="COMM">// PRIVATE</span><span class="WHIT">
<span class='line'>1482</span> 
<span class='line'>1483</span> </span><span class="WHIT">	</span><span class="COMM">// Generical toys method</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">		
<span class='line'>1485</span> 	</span><span class="COMM">/**
<span class='line'>1486</span> 	* 
<span class='line'>1487</span> 	*/</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">	</span><span class="NAME">resetToy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">	
<span class='line'>1490</span> 	</span><span class="COMM">/**
<span class='line'>1491</span> 	* 
<span class='line'>1492</span> 	*/</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">	</span><span class="NAME">getToyValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">,</span><span class="NAME">def</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">def</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">v</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">	
<span class='line'>1495</span> 	</span><span class="COMM">/**
<span class='line'>1496</span> 	* 
<span class='line'>1497</span> 	*/</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">	</span><span class="NAME">getToyStatus</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">toys.TOY_BUSY</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__status</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">	
<span class='line'>1500</span> 	</span><span class="COMM">/**
<span class='line'>1501</span> 	* 
<span class='line'>1502</span> 	*/</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">	</span><span class="NAME">_toydone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__status</span><span class="PUNC">&lt;</span><span class="NAME">toys.TOY_IDLE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__status</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__status</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">	
<span class='line'>1508</span> 	</span><span class="COMM">/**
<span class='line'>1509</span> 	* 
<span class='line'>1510</span> 	*/</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">	</span><span class="NAME">_toybusy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">		</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__status</span><span class="PUNC">=</span><span class="NAME">toys.TOY_BUSY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__status</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">	
<span class='line'>1516</span> 	</span><span class="COMM">/**
<span class='line'>1517</span> 	* 
<span class='line'>1518</span> 	*/</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">	</span><span class="NAME">_toyfrombool</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">?</span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">	
<span class='line'>1521</span> 	</span><span class="COMM">/**
<span class='line'>1522</span> 	* 
<span class='line'>1523</span> 	*/</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">	</span><span class="NAME">_maketoy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">			</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">__status</span><span class="PUNC">:</span><span class="NAME">toys.TOY_BUSY</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">	
<span class='line'>1532</span> 	</span><span class="COMM">/**
<span class='line'>1533</span> 	* @namespace timer Timer functionality based methods
<span class='line'>1534</span> 	*/</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">	</span><span class="COMM">// Pure timers</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">	</span><span class="NAME">timer</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">		
<span class='line'>1538</span> 		</span><span class="COMM">/**
<span class='line'>1539</span> 		* 
<span class='line'>1540</span> 		*/</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">		</span><span class="NAME">randomly</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">=</span><span class="NAME">help.random</span><span class="PUNC">(</span><span class="NAME">data.base</span><span class="PUNC">,</span><span class="NAME">data.range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">=</span><span class="NAME">help.random</span><span class="PUNC">(</span><span class="NAME">data.base</span><span class="PUNC">,</span><span class="NAME">data.range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	
<span class='line'>1552</span> 		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">		
<span class='line'>1554</span> 		</span><span class="COMM">/**
<span class='line'>1555</span> 		* 
<span class='line'>1556</span> 		*/</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">		</span><span class="NAME">real</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">subtimer</span><span class="PUNC">=</span><span class="NAME">gbox.getFps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.countdown</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">=</span><span class="NAME">data.countdown</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">			</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">subtimer</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">subtimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">subtimer</span><span class="PUNC">=</span><span class="NAME">gbox.getFps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.countdown</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>1572</span> 						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiocritical</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">&lt;=</span><span class="NAME">data.critical</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">							</span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audiocritical</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">time</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1579</span> 
<span class='line'>1580</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">		
<span class='line'>1582</span> 		</span><span class="COMM">/**
<span class='line'>1583</span> 		* 
<span class='line'>1584</span> 		*/</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">		</span><span class="NAME">every</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">			</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">==</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">		
<span class='line'>1594</span> 		</span><span class="COMM">/**
<span class='line'>1595</span> 		* 
<span class='line'>1596</span> 		*/</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">		</span><span class="NAME">after</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">==</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">	
<span class='line'>1606</span> 	</span><span class="COMM">/**
<span class='line'>1607</span> 	* 
<span class='line'>1608</span> 	*/</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">	</span><span class="COMM">// Logical helpers</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">	</span><span class="NAME">logic</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">		
<span class='line'>1612</span> 		</span><span class="COMM">/**
<span class='line'>1613</span> 		* 
<span class='line'>1614</span> 		*/</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">		</span><span class="NAME">once</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">cond</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cond</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cond</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">	
<span class='line'>1622</span> 	</span><span class="COMM">/**
<span class='line'>1623</span> 	* 
<span class='line'>1624</span> 	*/</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">	</span><span class="COMM">// UI</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">	</span><span class="NAME">ui</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">		
<span class='line'>1628</span> 		</span><span class="COMM">/**
<span class='line'>1629</span> 		* 
<span class='line'>1630</span> 		*/</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">		</span><span class="NAME">menu</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">opt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">opt.resetmenu</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fd</span><span class="PUNC">=</span><span class="NAME">gbox.getFont</span><span class="PUNC">(</span><span class="NAME">opt.font</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">opt.selected</span><span class="PUNC">?</span><span class="NAME">opt.selected</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">opt.items.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opt.items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">></span><span class="NAME">w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">opt.items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">				</span><span class="NAME">gbox.createCanvas</span><span class="PUNC">(</span><span class="STRN">"menu-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">fd.tilew</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">opt.items.length</span><span class="PUNC">*</span><span class="NAME">fd.tileh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">opt.items.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"menu-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">opt.font</span><span class="PUNC">,</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">opt.items</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">fd.tileh</span><span class="PUNC">*</span><span class="NAME">i</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fh</span><span class="PUNC">=</span><span class="NAME">fd.tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fw</span><span class="PUNC">=</span><span class="NAME">fd.tilew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">opt.keys.up</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opt.audiooption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">opt.audiooption</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">opt.keys.down</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">&lt;</span><span class="NAME">opt.items.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opt.audiooption</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">opt.audiooption</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">opt.keys.ok</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">opt.audioconfirm</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">opt.audioconfirm</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">opt.keys.cancel</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"menu-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">opt.x</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fw</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">opt.y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">opt.camera</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">opt.font</span><span class="PUNC">,</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">opt.selector</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">opt.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">opt.y</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">selected</span><span class="PUNC">*</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fh</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">opt.camera</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">&lt;</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ok</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">						</span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// selected > 0</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// selected == -1</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">		
<span class='line'>1672</span> 		</span><span class="COMM">/**
<span class='line'>1673</span> 		* 
<span class='line'>1674</span> 		*/</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">		</span><span class="COMM">// Returns a full customizable object for optimized huds</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">		</span><span class="NAME">hud</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">			</span><span class="NAME">gbox.createCanvas</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">				</span><span class="NAME">w</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">				</span><span class="NAME">surfaceid</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">				
<span class='line'>1682</span> 				</span><span class="COMM">/**
<span class='line'>1683</span> 				* 
<span class='line'>1684</span> 				*/</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">				</span><span class="NAME">updateWidget</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__hidden</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"label"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">prepad</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">=</span><span class="NAME">help.prepad</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">prepad</span><span class="PUNC">,</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">padwith</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">postpad</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">=</span><span class="NAME">help.postpad</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">postpad</span><span class="PUNC">,</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">padwith</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">							</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">=</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"symbols"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxshown</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxshown</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapy</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">ts.tileh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">=</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">							</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxshown</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">									</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tiles</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">></span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tiles.length</span><span class="PUNC">?</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tiles.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">cnt</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapy</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">emptytile</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">										</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">emptytile</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapy</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>1703</span> 								</span><span class="NAME">cnt</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tiles.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1705</span> 
<span class='line'>1706</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"stack"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bw</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxshown</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">ts.tilew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rightalign</span><span class="PUNC">?</span><span class="NAME">bw</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">bw</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxshown</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapy</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">ts.tileh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">							</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxshown</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value.length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">									</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">rightalign</span><span class="PUNC">?</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">-</span><span class="NAME">ts.tileh</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">*</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapy</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"radio"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">ts.tileh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frames</span><span class="PUNC">[</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1719</span> 
<span class='line'>1720</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"blit"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">ts.tileh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1725</span> 
<span class='line'>1726</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"bool"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">ts.tileh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">								</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frame</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"gauge"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						
<span class='line'>1736</span> 							</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxvalue</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">				
<span class='line'>1741</span> 				</span><span class="COMM">/**
<span class='line'>1742</span> 				* 
<span class='line'>1743</span> 				*/</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">				</span><span class="NAME">hideWidgets</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__hidden</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">					</span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">				
<span class='line'>1749</span> 				</span><span class="COMM">/**
<span class='line'>1750</span> 				* 
<span class='line'>1751</span> 				*/</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">				</span><span class="NAME">showWidgets</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">l.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">l</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__hidden</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">					</span><span class="NAME">this.redraw</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">				
<span class='line'>1757</span> 				</span><span class="COMM">/**
<span class='line'>1758</span> 				* 
<span class='line'>1759</span> 				*/</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">				</span><span class="NAME">getValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">				
<span class='line'>1764</span> 				</span><span class="COMM">/**
<span class='line'>1765</span> 				* 
<span class='line'>1766</span> 				*/</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">				</span><span class="NAME">getNumberValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1770</span> 
<span class='line'>1771</span> </span><span class="WHIT">				</span><span class="COMM">/**
<span class='line'>1772</span> 				* 
<span class='line'>1773</span> 				*/</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">				</span><span class="NAME">setValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">==</span><span class="STRN">"value"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxvalue</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">></span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxvalue</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">maxvalue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">minvalue</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">&lt;</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">minvalue</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">minvalue</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>1779</span> 							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">widget</span><span class="PUNC">==</span><span class="STRN">"radio"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">%</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frames.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">						</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">							
<span class='line'>1782</span> 						</span><span class="NAME">this.updateWidget</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">				
<span class='line'>1786</span> 				</span><span class="COMM">/**
<span class='line'>1787</span> 				* 
<span class='line'>1788</span> 				*/</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">				</span><span class="NAME">pushValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">					</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">					</span><span class="NAME">this.updateWidget</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">				
<span class='line'>1794</span> 				</span><span class="COMM">/**
<span class='line'>1795</span> 				* 
<span class='line'>1796</span> 				*/</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">				</span><span class="NAME">addValue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.setValue</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">w</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">				
<span class='line'>1801</span> 				</span><span class="COMM">/**
<span class='line'>1802</span> 				* 
<span class='line'>1803</span> 				*/</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">				</span><span class="NAME">setWidget</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">					</span><span class="NAME">this.w</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">					</span><span class="NAME">this.updateWidget</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">				
<span class='line'>1809</span> 				</span><span class="COMM">/**
<span class='line'>1810</span> 				* 
<span class='line'>1811</span> 				*/</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">				</span><span class="NAME">redraw</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.updateWidget</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">				
<span class='line'>1817</span> 				</span><span class="COMM">/**
<span class='line'>1818</span> 				* 
<span class='line'>1819</span> 				*/</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">				</span><span class="NAME">blit</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="NAME">this.surfaceid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">			
<span class='line'>1824</span> 			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">	
<span class='line'>1828</span> 	</span><span class="COMM">/**
<span class='line'>1829</span> 	* 
<span class='line'>1830</span> 	*/</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">	</span><span class="NAME">fullscreen</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">	
<span class='line'>1833</span> 		</span><span class="COMM">/**
<span class='line'>1834</span> 		* 
<span class='line'>1835</span> 		*/</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">		</span><span class="NAME">fadeout</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">data.resetfade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">stv</span><span class="PUNC">=</span><span class="NAME">gbox.getAudioVolume</span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">chv</span><span class="PUNC">=</span><span class="NAME">gbox.getChannelVolume</span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">			</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">data.fadespeed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">			</span><span class="NAME">data.alpha</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitFade</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioVolume</span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">stv</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">data.alpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>1848</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.alpha</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">					</span><span class="NAME">gbox.stopChannel</span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">					</span><span class="NAME">gbox.setChannelVolume</span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">chv</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">data.alpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">		
<span class='line'>1855</span> 		</span><span class="COMM">/**
<span class='line'>1856</span> 		* 
<span class='line'>1857</span> 		*/</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">		</span><span class="NAME">fadein</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">data.resetfade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1861</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">stv</span><span class="PUNC">=</span><span class="NAME">gbox.getAudioVolume</span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">chv</span><span class="PUNC">=</span><span class="NAME">gbox.getChannelDefaultVolume</span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">			</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">data.fadespeed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1867</span> </span><span class="WHIT">				</span><span class="NAME">data.alpha</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioVolume</span><span class="PUNC">(</span><span class="NAME">data.audiofade</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">stv</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">data.alpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setChannelVolume</span><span class="PUNC">(</span><span class="NAME">data.audiochannelfade</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">chv</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">data.alpha</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitFade</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fade</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">	
<span class='line'>1876</span> 	</span><span class="COMM">/**
<span class='line'>1877</span> 	* 
<span class='line'>1878</span> 	*/</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">	</span><span class="NAME">text</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">		
<span class='line'>1881</span> 		</span><span class="COMM">/**
<span class='line'>1882</span> 		* 
<span class='line'>1883</span> 		*/</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">		</span><span class="NAME">blink</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">visible</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">times</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">>=</span><span class="NAME">data.blinkspeed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">visible</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">visible</span><span class="PUNC">;</span><span class="WHIT">		
<span class='line'>1893</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.times</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">times</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">visible</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.times</span><span class="PUNC">?</span><span class="NAME">data.times</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">times</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">		
<span class='line'>1900</span> 		</span><span class="COMM">/**
<span class='line'>1901</span> 		* 
<span class='line'>1902</span> 		*/</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">		</span><span class="NAME">fixed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data.time</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">texttimer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">	
<span class='line'>1913</span> 	</span><span class="COMM">/**
<span class='line'>1914</span> 	* 
<span class='line'>1915</span> 	*/</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">	</span><span class="NAME">logos</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">		
<span class='line'>1918</span> 		</span><span class="COMM">/**
<span class='line'>1919</span> 		* 
<span class='line'>1920</span> 		*/</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">		</span><span class="NAME">linear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">data.sx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">data.sy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">every</span><span class="PUNC">=</span><span class="NAME">data.every</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">played</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">every</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">!=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">data.y</span><span class="PUNC">!=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">&lt;=</span><span class="NAME">data.speed</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">data.y</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">&lt;=</span><span class="NAME">data.speed</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">data.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">data.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">						</span><span class="NAME">trigo.translate</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">trigo.getAngle</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.speed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">played</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">played</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">every</span><span class="PUNC">=</span><span class="NAME">data.every</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">every</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1942</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.text</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1943</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1944</span> </span><span class="WHIT">					</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">data.font</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="WHIT">					</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1946</span> </span><span class="WHIT">					</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">data.text</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.tileset</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">data.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">data.tile</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">data.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">data.fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">data.flipv</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.alpha</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			
<span class='line'>1950</span> 			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.alpha</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1952</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">==</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">data.y</span><span class="PUNC">==</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1953</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1954</span> </span><span class="WHIT">		
<span class='line'>1955</span> 		</span><span class="COMM">/**
<span class='line'>1956</span> 		* 
<span class='line'>1957</span> 		*/</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">		</span><span class="NAME">crossed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">=</span><span class="NAME">data.gapx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lw</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.alpha</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.alpha</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1972</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1973</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					
<span class='line'>1974</span> 				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1975</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1976</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">		
<span class='line'>1980</span> 		</span><span class="COMM">/**
<span class='line'>1981</span> 		* 
<span class='line'>1982</span> 		*/</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">		</span><span class="NAME">zoomout</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1985</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NAME">data.zoom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1986</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">!=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blit</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img.height</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img.width</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">-</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img.width</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">-</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img.height</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dh</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img.height</span><span class="PUNC">*</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">img.width</span><span class="PUNC">*</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">zoom</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">		
<span class='line'>2003</span> 		</span><span class="COMM">/**
<span class='line'>2004</span> 		* 
<span class='line'>2005</span> 		*/</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">		</span><span class="NAME">rising</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lw</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">data.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">></span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">gapx</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blit</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dh</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lw</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.alpha</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.reflex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.blit</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dh</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lw</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.reflex</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cnt</span><span class="PUNC">>=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audioreach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					
<span class='line'>2020</span> 				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toybusy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.reflex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.y</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">lh</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.reflex</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">				
<span class='line'>2025</span> 				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toydone</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">		
<span class='line'>2029</span> 		</span><span class="COMM">/**
<span class='line'>2030</span> 		* 
<span class='line'>2031</span> 		*/</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">		</span><span class="NAME">bounce</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">accy</span><span class="PUNC">=</span><span class="NAME">data.accy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">data.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">h</span><span class="PUNC">>=</span><span class="NAME">data.floory</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.audiobounce</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">data.audiobounce</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">data.floory</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">accy</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">accy</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">data.heavy</span><span class="PUNC">?</span><span class="NAME">data.heavy</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">accy</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">accy</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">accy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">data.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">					
<span class='line'>2050</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">done</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">	
<span class='line'>2054</span> 	</span><span class="COMM">/**
<span class='line'>2055</span> 	* 
<span class='line'>2056</span> 	*/</span><span class="WHIT">
<span class='line'>2057</span> </span><span class="WHIT">	</span><span class="NAME">dialogue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2058</span> </span><span class="WHIT">		
<span class='line'>2059</span> 		</span><span class="COMM">/**
<span class='line'>2060</span> 		* 
<span class='line'>2061</span> 		*/</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">		</span><span class="NAME">render</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">toys._maketoy</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">newscene</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneid</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">				</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">				</span><span class="NAME">gbox.createCanvas</span><span class="PUNC">(</span><span class="STRN">"dialogue-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data.hideonend</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">data.hideonend</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">newscene</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anim</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">newscene</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneid</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">					</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneid</span><span class="PUNC">==</span><span class="NAME">data.scenes.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wait</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene</span><span class="PUNC">=</span><span class="NAME">data.scenes</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd</span><span class="PUNC">=</span><span class="NAME">gbox.getFont</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.font</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.font</span><span class="PUNC">:</span><span class="NAME">data.font</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dh</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dh</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneW</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dw</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dw</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2086</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneX</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dx</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2087</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneY</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dy</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.dy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2088</span> </span><span class="WHIT">						</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"dialogue-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.slide</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">							
<span class='line'>2090</span> 							</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"dialogue-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.slide.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.slide.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.slide.y</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.scroller</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">							</span><span class="NAME">gbox.createCanvas</span><span class="PUNC">(</span><span class="STRN">"scroller-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneW</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.scroller.length</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.spacing</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">							</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.scroller.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">								</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"scroller-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2096</span> </span><span class="WHIT">										</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="WHIT">										</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">										</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">i</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.spacing</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2099</span> </span><span class="WHIT">										</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneW</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="WHIT">										</span><span class="NAME">halign</span><span class="PUNC">:</span><span class="NAME">gbox.ALIGN_CENTER</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="WHIT">										</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.scroller</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2104</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">							</span><span class="NAME">gbox.createCanvas</span><span class="PUNC">(</span><span class="STRN">"bonus-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneW</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus.length</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.spacing</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.audiomusic</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.audiomusic</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2108</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wait</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">data.esckey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">data.skipkey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">newscene</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">									
<span class='line'>2116</span> 						</span><span class="COMM">// SKIP KEYS</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">						
<span class='line'>2118</span> 						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHit</span><span class="PUNC">(</span><span class="NAME">data.esckey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.keyIsHold</span><span class="PUNC">(</span><span class="NAME">data.skipkey</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.speed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2120</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">						
<span class='line'>2122</span> 						</span><span class="COMM">// MOVING</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">						
<span class='line'>2124</span> 						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.talk</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// DIALOGUES</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="WHIT">						
<span class='line'>2126</span> 						
<span class='line'>2127</span> 							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">==</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.speed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">								</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">								</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.audio</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">%</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.hitAudio</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.audio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2132</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">								</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tmp</span><span class="PUNC">></span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.talk</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">									</span><span class="NAME">tmp</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.talk</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">									</span><span class="NAME">row</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">==</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.talk.length</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">										</span><span class="NAME">row</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">										</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2141</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2142</span> </span><span class="WHIT">									</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"dialogue-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">										</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">data.font</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">										</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">										</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">*</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.tileh</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">										</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.talk</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">tmp</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2148</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2149</span> </span><span class="WHIT">									</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wait</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2150</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="WHIT">						
<span class='line'>2152</span> 						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.scroller</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// SCROLLER (i.e. credits)</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">						
<span class='line'>2154</span> 							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">==</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.speed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">								</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">								</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">==</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"scroller-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.push</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">									</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wait</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">							
<span class='line'>2161</span> 						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// BONUS (classic bonus award screen)</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">							</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">row</span><span class="PUNC">&lt;=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">;</span><span class="NAME">row</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">									</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"bonus-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2165</span> </span><span class="WHIT">										</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">data.font</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2166</span> </span><span class="WHIT">										</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">										</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.spacing</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">										</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="WHIT">
<span class='line'>2169</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">								</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">									</span><span class="COMM">// Mask is %VAL%e%MUL%=%TOT%</span><span class="WHIT">
<span class='line'>2172</span> </span><span class="WHIT">									</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tmptext</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mask.replace</span><span class="PUNC">(</span><span class="REGX">/%VAL%/</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/%MUL%/</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/%TOT%/</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">*</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2173</span> </span><span class="WHIT">									</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"bonus-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">										</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">										</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">data.font</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">										</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">										</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.spacing</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">										</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tmptext</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">							
<span class='line'>2183</span> 							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wait</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mul</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2186</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">>=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">speed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2187</span> </span><span class="WHIT">										</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">										</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">></span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mulvalue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2190</span> </span><span class="WHIT">											</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tmptext</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">											</span><span class="NAME">next</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2193</span> </span><span class="WHIT">											</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">												</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">callback</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">arg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2197</span> </span><span class="WHIT">									
<span class='line'>2198</span> 								</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">>=</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.speed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">next</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">next</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">==</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">										</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">wait</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2202</span> </span><span class="WHIT">									</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2203</span> </span><span class="WHIT">										</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2204</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2205</span> </span><span class="WHIT">											</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">text</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2206</span> </span><span class="WHIT">											</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tmptext</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="WHIT">											</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">timer</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">										</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">counter</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">							
<span class='line'>2215</span> 					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2216</span> </span><span class="WHIT">				
<span class='line'>2217</span> 				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2218</span> </span><span class="WHIT">				
<span class='line'>2219</span> 				</span><span class="COMM">// RENDERING</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">				
<span class='line'>2221</span> 				
<span class='line'>2222</span> 				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.talk</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// DIALOGUES</span><span class="WHIT">
<span class='line'>2223</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">box</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">							</span><span class="NAME">gbox.blitRect</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">box</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2226</span> </span><span class="WHIT">						</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anim</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anim</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">						</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anim</span><span class="PUNC">,</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">portraitx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">portraity</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">data.who</span><span class="PUNC">[</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.who</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"dialogue-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.scroller</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// SCROLLER (i.e. credits)</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blit</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"scroller-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneX</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneY</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneW</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">-</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dh</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">&lt;</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">?</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">letter</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneH</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2232</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scene.bonus</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// BONUS (i.e. credits)</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"bonus-"</span><span class="PUNC">+</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneX</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sceneY</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">		
<span class='line'>2235</span> 			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">toys._toyfrombool</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">th.toys</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">	
<span class='line'>2239</span> 	</span><span class="COMM">// GENERATORS</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">	
<span class='line'>2241</span> 		
<span class='line'>2242</span> 	</span><span class="COMM">/**
<span class='line'>2243</span> 	* 
<span class='line'>2244</span> 	*/</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">	</span><span class="NAME">generate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">		
<span class='line'>2247</span> 		</span><span class="COMM">/**
<span class='line'>2248</span> 		* 
<span class='line'>2249</span> 		*/</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">		</span><span class="NAME">sparks</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">			</span><span class="NAME">simple</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">group</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">data.tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2253</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.frames</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">					</span><span class="NAME">data.frames</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">speed</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.animspeed</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">data.animspeed</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">frames</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">ts.tilerow</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data.frames.frames</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2257</span> 
<span class='line'>2258</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">					</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">						</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">							</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">group</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">							</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.hw</span><span class="PUNC">-</span><span class="NAME">ts.tilehw</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">data.gapx</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">data.gapx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">							</span><span class="NAME">y</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.valign</span><span class="PUNC">==</span><span class="STRN">"top"</span><span class="PUNC">?</span><span class="NAME">th.y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">+</span><span class="NAME">th.hh</span><span class="PUNC">-</span><span class="NAME">ts.tilehh</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">data.gapy</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">data.gapy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">							</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">data.tileset</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">							</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">							</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">accy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">							</span><span class="NAME">frame</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">							</span><span class="NAME">timer</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.delay</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NAME">data.delay</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">							</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="NAME">data.frames</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">							</span><span class="NAME">toptimer</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.frames.frames.length</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">data.frames.speed</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">							</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">th.camera</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2273</span> </span><span class="WHIT">							</span><span class="NAME">gravity</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">							</span><span class="NAME">trashoffscreen</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">							</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">th.fliph</span><span class="PUNC">:</span><span class="NAME">data.fliph</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">th.flipv</span><span class="PUNC">:</span><span class="NAME">data.flipv</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">							</span><span class="NAME">blinkspeed</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">					</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2280</span> 
<span class='line'>2281</span> </span><span class="WHIT">				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">					</span><span class="NAME">this.timer</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.timer</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">						</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="WHIT">						</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.gravity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.accy</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.timer</span><span class="PUNC">==</span><span class="NAME">this.toptimer</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.trashoffscreen</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox.objectIsVisible</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="WHIT">				
<span class='line'>2291</span> 				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.timer</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.blinkspeed</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">this.timer</span><span class="PUNC">/</span><span class="NAME">this.blinkspeed</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">						</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">this.timer</span><span class="PUNC">,</span><span class="NAME">this.frames</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.fliph</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.flipv</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">this.alpha</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					
<span class='line'>2294</span> 				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">				
<span class='line'>2296</span> 				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">		
<span class='line'>2299</span> 			</span><span class="COMM">/**
<span class='line'>2300</span> 			* 
<span class='line'>2301</span> 			*/</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">			</span><span class="NAME">popupText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">group</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">				</span><span class="NAME">data.text</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fd</span><span class="PUNC">=</span><span class="NAME">gbox.getFont</span><span class="PUNC">(</span><span class="NAME">data.font</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">				
<span class='line'>2306</span> 				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">					</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">						</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">							</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">group</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">							</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">th.x</span><span class="PUNC">+</span><span class="NAME">th.hw</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">fd.tilehw</span><span class="PUNC">*</span><span class="NAME">data.text.length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">							</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">-</span><span class="NAME">fd.tilehh</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">							</span><span class="NAME">vaccy</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">data.jump</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">							</span><span class="NAME">font</span><span class="PUNC">:</span><span class="STRN">"small"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">							</span><span class="NAME">keep</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">							</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">data.text</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">							</span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">							</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">th.camera</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="WHIT">					</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">				
<span class='line'>2323</span> 				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.objectIsVisible</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.vaccy</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">							</span><span class="NAME">this.vaccy</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">							</span><span class="NAME">this.cnt</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">						</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.vaccy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">>=</span><span class="NAME">this.keep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">				
<span class='line'>2334</span> 				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">					</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">this.font</span><span class="PUNC">,</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">this.text</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">				
<span class='line'>2338</span> 				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">		
<span class='line'>2341</span> 			</span><span class="COMM">/**
<span class='line'>2342</span> 			* 
<span class='line'>2343</span> 			*/</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">			</span><span class="NAME">bounceDie</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">group</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">					</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">						</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2348</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2349</span> </span><span class="WHIT">							</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">group</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">							</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">th.tileset</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">							</span><span class="NAME">frame</span><span class="PUNC">:</span><span class="NAME">th.frame</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2352</span> </span><span class="WHIT">							</span><span class="NAME">side</span><span class="PUNC">:</span><span class="NAME">th.side</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">							</span><span class="NAME">frames</span><span class="PUNC">:</span><span class="NAME">th.frames.die</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">							</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">th.x</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">							</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">th.y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">							</span><span class="NAME">vaccy</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NAME">data.jump</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">							</span><span class="NAME">accx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">							</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">data.flipv</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">							</span><span class="NAME">cnt</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">							</span><span class="NAME">blinkspeed</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">							</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">th.camera</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">					</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">				
<span class='line'>2366</span> 				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox.objectIsVisible</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">						</span><span class="NAME">this.vaccy</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">						</span><span class="NAME">this.y</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.vaccy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="WHIT">						</span><span class="NAME">this.x</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">this.accx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="WHIT">						</span><span class="NAME">this.cnt</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	
<span class='line'>2373</span> 				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2374</span> </span><span class="WHIT">				
<span class='line'>2375</span> 				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2376</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.blinkspeed</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">/</span><span class="NAME">this.blinkspeed</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="WHIT">						</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">gbox.getBufferContext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">this.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">help.decideFrame</span><span class="PUNC">(</span><span class="NAME">this.cnt</span><span class="PUNC">,</span><span class="NAME">this.frames</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">this.x</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">this.y</span><span class="PUNC">,</span><span class="NAME">camera</span><span class="PUNC">:</span><span class="NAME">this.camera</span><span class="PUNC">,</span><span class="NAME">fliph</span><span class="PUNC">:</span><span class="NAME">this.side</span><span class="PUNC">,</span><span class="NAME">flipv</span><span class="PUNC">:</span><span class="NAME">this.flipv</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					
<span class='line'>2378</span> 				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2379</span> </span><span class="WHIT">				
<span class='line'>2380</span> 				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">		
<span class='line'>2384</span> 		</span><span class="COMM">/**
<span class='line'>2385</span> 		* 
<span class='line'>2386</span> 		*/</span><span class="WHIT">
<span class='line'>2387</span> </span><span class="WHIT">		</span><span class="NAME">audio</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2388</span> </span><span class="WHIT">		
<span class='line'>2389</span> 			</span><span class="COMM">/**
<span class='line'>2390</span> 			* 
<span class='line'>2391</span> 			*/</span><span class="WHIT">
<span class='line'>2392</span> </span><span class="WHIT">			</span><span class="NAME">fadeOut</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">group</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2393</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">=</span><span class="NAME">gbox.addObject</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="WHIT">					</span><span class="NAME">help.mergeWithModel</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="WHIT">						</span><span class="NAME">data</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">							</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">group</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">							</span><span class="NAME">fadespeed</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">0.02</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.fadein</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2399</span> </span><span class="WHIT">							</span><span class="NAME">stoponmute</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">							</span><span class="NAME">audio</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2401</span> </span><span class="WHIT">							</span><span class="NAME">channel</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2402</span> </span><span class="WHIT">							</span><span class="NAME">destination</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">					</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">				</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2406</span> 
<span class='line'>2407</span> </span><span class="WHIT">				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.logicon</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"first"</span><span class="PUNC">:</span><span class="NAME">data.logicon</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.destination</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2409</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.destination</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.destination</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.destination</span><span class="PUNC">=</span><span class="NAME">gbox.getChannelDefaultVolume</span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.destination</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.playAudio</span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2414</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="WHIT">				
<span class='line'>2416</span> 				</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">data.bliton</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"blit"</span><span class="PUNC">:</span><span class="NAME">data.bliton</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.changeAudioVolume</span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">,</span><span class="NAME">this.fadespeed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.changeChannelVolume</span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">,</span><span class="NAME">this.fadespeed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2419</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="WHIT">						</span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="WHIT">							</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox.getAudioVolume</span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">)</span><span class="PUNC">&lt;=</span><span class="NAME">this.destination</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="WHIT">							</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox.getAudioVolume</span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NAME">this.destination</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="WHIT">					   </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="WHIT">						</span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>2425</span> </span><span class="WHIT">							</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox.getChannelVolume</span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">)</span><span class="PUNC">&lt;=</span><span class="NAME">this.destination</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2426</span> </span><span class="WHIT">							</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox.getChannelVolume</span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">)</span><span class="PUNC">>=</span><span class="NAME">this.destination</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2427</span> </span><span class="WHIT">					   </span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="WHIT">					</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2429</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">&&</span><span class="NAME">this.stoponmute</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.stopChannel</span><span class="PUNC">(</span><span class="NAME">this.channel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2430</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">&&</span><span class="NAME">this.stoponmute</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this.fadespeed</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.stopAudio</span><span class="PUNC">(</span><span class="NAME">this.audio</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">						</span><span class="NAME">gbox.trashObject</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2435</span> </span><span class="WHIT">		
<span class='line'>2436</span> 		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">		
<span class='line'>2438</span> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">	
<span class='line'>2440</span> 
<span class='line'>2441</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2442</span> </span></pre></body></html>