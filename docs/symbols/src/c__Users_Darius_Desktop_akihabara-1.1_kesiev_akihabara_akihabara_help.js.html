<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ---</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Copyright (c) 2010 Francesco Cottone, http://www.kesiev.com/</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>  4</span> 
<span class='line'>  5</span> </span><span class="COMM">/**
<span class='line'>  6</span>  * @namespace Help module provides some Javascript-specific functions, such object copying, randomizing functions, 
<span class='line'>  7</span>  * string/array handlers and the akihabaraInit function.
<span class='line'>  8</span>  */</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">help</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 10</span> 
<span class='line'> 11</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 12</span>  * Generates numbers from st to ed, along with a skip value.
<span class='line'> 13</span>  * @param {Integer} st Starting number.
<span class='line'> 14</span>  * @param {Integer} ed Ending number.
<span class='line'> 15</span>  * @param {Integer} skip Number to increment by.
<span class='line'> 16</span>  * @returns An array containing the set of numbers from st to ed, incrementing by skip.
<span class='line'> 17</span>  */</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">	</span><span class="NAME">seq</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">st</span><span class="PUNC">,</span><span class="NAME">ed</span><span class="PUNC">,</span><span class="NAME">skip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">st</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">ed</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">skip</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">skip</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 23</span> 
<span class='line'> 24</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 25</span>  * Multiplies two numbers together, returning the result, unless the first parameter is less than 2, in which case it returns 1.
<span class='line'> 26</span>  * @param {Float} v First value.
<span class='line'> 27</span>  * @param {Float} mul Second value.
<span class='line'> 28</span>  * @returns An integer, v*mul, unless v&lt;2 in which case it returns 1.
<span class='line'> 29</span>  */</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">	</span><span class="COMM">// Handle a multiplier like counter. that means, 0=1 / 1=1 / 2=2*mul etc...</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">	</span><span class="NAME">multiplier</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">v</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">&lt;</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">v</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">mul</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">mul</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 36</span>  * Prepends a string with repeated instances of another string until it the result is greater than or equal to a desired length.
<span class='line'> 37</span>  * @param {String} str The string you wish to modify.
<span class='line'> 38</span>  * @param {Integer} len The desired length of your resultant string.
<span class='line'> 39</span>  * @param {String} pad The string you wish to prepend to str.
<span class='line'> 40</span>  * @returns A string whose length is no greater than len+pad.length, with pad prepending str repeatedly.
<span class='line'> 41</span>  */</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">	</span><span class="NAME">prepad</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">,</span><span class="NAME">pad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">		</span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">		</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">str.length</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">=</span><span class="NAME">pad</span><span class="PUNC">+</span><span class="NAME">str</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 49</span>  * Postpends a string with repeated instances of another string until it the result is greater than or equal to a desired length.
<span class='line'> 50</span>  * @param {String} str The string you wish to modify.
<span class='line'> 51</span>  * @param {Integer} len The desired length of your resultant string.
<span class='line'> 52</span>  * @param {String} pad The string you wish to postpend to str.
<span class='line'> 53</span>  * @returns A string whose length is no greater than len+pad.length, with pad postpending str repeatedly.
<span class='line'> 54</span>  */</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">	</span><span class="NAME">postpad</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">str</span><span class="PUNC">,</span><span class="NAME">len</span><span class="PUNC">,</span><span class="NAME">pad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">		</span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">		</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">str.length</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">pad</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">str</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 60</span> 
<span class='line'> 61</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 62</span>  * Tests to see if an object is being "jumped on" by another object. Only works for platformers, since it assumes accy>0 means you're falling onto something else.
<span class='line'> 63</span>  * @param {Object} th The object that is (possibly) being jumped on.
<span class='line'> 64</span>  * @param {Object} by The object doing the jumping-on.
<span class='line'> 65</span>  * @returns True if the two objects are overlapping enough and by.accy>0.
<span class='line'> 66</span>  */</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">	</span><span class="NAME">isSquished</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">by.accy</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">gbox.collides</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">by</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">th.y</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">by.y</span><span class="PUNC">+</span><span class="NAME">by.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&lt;</span><span class="PUNC">(</span><span class="NAME">th.h</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 72</span>  * Generates uniformly distributed random integers between min and min+range, non-inclusive. So help.random(0,2) will only return 0 and 1, etc.
<span class='line'> 73</span>  * @param {Integer} min The minimum random value to be returned by the function.
<span class='line'> 74</span>  * @param {Integer} range The number of different values returned by the function.
<span class='line'> 75</span>  * @returns An integer between min (includive) and min+range (noninclusive).
<span class='line'> 76</span>  */</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">	</span><span class="NAME">random</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">min</span><span class="PUNC">,</span><span class="NAME">range</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">+</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">range</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'> 83</span>  * Determines which frame of a given animation to display. Will loop an animation.
<span class='line'> 84</span>  * @param {Integer} cnt A global frame counter.
<span class='line'> 85</span>  * @param {Object} anim An object with parameters speed (the animation speed) and frames (the array representing the animation sequence).
<span class='line'> 86</span>  * @returns The particular animation frame to display during this step.
<span class='line'> 87</span>  */</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">	</span><span class="NAME">decideFrame</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">,</span><span class="NAME">anim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">anim.frames</span><span class="PUNC">[</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">/</span><span class="NAME">anim.speed</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">anim.frames.length</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'> 93</span>  * Determines which frame of a given animation to display. Will remain on the last frame when the animation has played once.
<span class='line'> 94</span>  * @param {Integer} cnt A global frame counter.
<span class='line'> 95</span>  * @param {Object} anim An object with parameters speed (the animation speed) and frames (the array representing the animation sequence).
<span class='line'> 96</span>  * @returns The particular animation frame to display during this step.
<span class='line'> 97</span>  */</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">	</span><span class="NAME">decideFrameOnce</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">,</span><span class="NAME">anim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">anim.frames</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">>=</span><span class="NAME">anim.frames.length</span><span class="PUNC">*</span><span class="NAME">anim.speed</span><span class="PUNC">?</span><span class="NAME">anim.frames.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">/</span><span class="NAME">anim.speed</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>103</span>  * Returns whether the animation was fully played at least once with decideFrame or fully with decideFrameOnce.
<span class='line'>104</span>  * @param {Integer} cnt A global frame counter.
<span class='line'>105</span>  * @param {Object} anim An object with parameters speed (the animation speed) and frames (the array representing the animation sequence).
<span class='line'>106</span>  * @returns A boolean, true if the animation has been played at least once.
<span class='line'>107</span>  */</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT"> 	</span><span class="NAME">isLastFrameOnce</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">,</span><span class="NAME">anim</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">>=</span><span class="NAME">anim.frames.length</span><span class="PUNC">*</span><span class="NAME">anim.speed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>111</span> 
<span class='line'>112</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>113</span>  * Given an incrementing value each step, this will return a value increasing from 0 until max/2, at which point it will decrement to 0, then go back up to max/2, in an endless cycle.
<span class='line'>114</span>  * @param {Integer} counter A counter.
<span class='line'>115</span>  * @param {Integer} max This determines the period of the function -- assuming counter is incrementing by one, a complete back-and-forth will take 'max' steps.
<span class='line'>116</span>  * @returns An integer.
<span class='line'>117</span>  */</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">	</span><span class="NAME">upAndDown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">counter</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">counter</span><span class="PUNC">%</span><span class="NAME">max</span><span class="PUNC">)</span><span class="PUNC">></span><span class="PUNC">(</span><span class="NAME">max</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">counter</span><span class="PUNC">%</span><span class="NAME">max</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">counter</span><span class="PUNC">%</span><span class="NAME">max</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>123</span>  * Given x,y coordinates and map information, this returns the tile at a given point.
<span class='line'>124</span>  * @param {Integer} x An x-coordinate.
<span class='line'>125</span>  * @param {Integer} y A y-coordinate.
<span class='line'>126</span>  * @param {Object} map The map object.
<span class='line'>127</span>  * @param {Object} ifout An object or value to be returned if the x,y coordinate pair is outside the map.
<span class='line'>128</span>  * @param {String} mapid The id for the map array within the map object. Default is 'map'.
<span class='line'>129</span>  * @returns An integer representing the value of the tile in the map array at that x,y coordinate. If there is no tile, null is returned.
<span class='line'>130</span>  */</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT"> 	</span><span class="NAME">getTileInMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">ifout</span><span class="PUNC">,</span><span class="NAME">mapid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">mapid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">mapid</span><span class="PUNC">=</span><span class="STRN">"map"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox._tiles</span><span class="PUNC">[</span><span class="NAME">map.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">/</span><span class="NAME">ts.tilew</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">/</span><span class="NAME">ts.tileh</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ty</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">ty</span><span class="PUNC">>=</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">mapid</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ifout</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">tx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">tx</span><span class="PUNC">>=</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">mapid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ty</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ifout</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">mapid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ty</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">tx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>140</span> 
<span class='line'>141</span> </span><span class="WHIT"> </span><span class="COMM">/**
<span class='line'>142</span>  * Takes an ascii-art-style array of characters and converts it to an Akihabara-compatible map format.
<span class='line'>143</span>  * @param {Array} map An array of characters representing a map.
<span class='line'>144</span>  * @param {Array} tra A translation array. This is an array of arrays, formatted like [ [null, char1], [0, char2], [1, char3] ]. There must at least be a null entry, followed by one numerical entry for each tile type you want to render, corresponding to the unique characters in the map array. The null entry maps a character to empty space.
<span class='line'>145</span>  * @returns A map array formatted such that it can be attached to a map object.
<span class='line'>146</span>  */</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">	</span><span class="NAME">asciiArtToMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">tra</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sz</span><span class="PUNC">=</span><span class="NAME">tra</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xpos</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pie</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">map.length</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">			</span><span class="NAME">xpos</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">			</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xpos</span><span class="PUNC">&lt;</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">				</span><span class="NAME">pie</span><span class="PUNC">=</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">substr</span><span class="PUNC">(</span><span class="NAME">xpos</span><span class="PUNC">,</span><span class="NAME">sz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">t</span><span class="PUNC">&lt;</span><span class="NAME">tra.length</span><span class="PUNC">;</span><span class="NAME">t</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pie</span><span class="PUNC">==</span><span class="NAME">tra</span><span class="PUNC">[</span><span class="NAME">t</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">row.push</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">row.push</span><span class="PUNC">(</span><span class="NAME">tra</span><span class="PUNC">[</span><span class="NAME">t</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">				</span><span class="NAME">xpos</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">sz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">			</span><span class="NAME">ret.push</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>170</span>   * Calculates and sets the width and height (map.h, map.w) and half-width and half-height (map.hh, map.hw) of a map object.
<span class='line'>171</span>   * @param {Object} map A map object, containing a map array and a tileset array.
<span class='line'>172</span>   * @returns A map object with map.w, map.h, map.hh, and map.hw set correctly.
<span class='line'>173</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">	</span><span class="COMM">// Finalize a map definition, setting height and width in pixels etc.</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">	</span><span class="COMM">// Args: (map)</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">	</span><span class="COMM">// Outs: finalized map</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">	</span><span class="NAME">finalizeTilemap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox._tiles</span><span class="PUNC">[</span><span class="NAME">map.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">		</span><span class="NAME">map.h</span><span class="PUNC">=</span><span class="NAME">map.map.length</span><span class="PUNC">*</span><span class="NAME">ts.tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">		</span><span class="NAME">map.w</span><span class="PUNC">=</span><span class="NAME">map.map</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">		</span><span class="NAME">map.hw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">map.w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">		</span><span class="NAME">map.hh</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">map.h</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>184</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>185</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>187</span>   * Converts an x-coordinate of a pixel to its corresponding tile x-coordinate.
<span class='line'>188</span>   * @param {Object} map A map object, containing a map array and a tileset array.
<span class='line'>189</span>   * @param {Integer} x An x-coordinate.
<span class='line'>190</span>   * @param {Integer} gap (Not used.)
<span class='line'>191</span>   * @returns A map object with map.w, map.h, map.hh, and map.hw set correctly.
<span class='line'>192</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">	</span><span class="NAME">xPixelToTileX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">gap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox._tiles</span><span class="PUNC">[</span><span class="NAME">map.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">/</span><span class="NAME">ts.tilew</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>199</span>   * Converts a y-coordinate of a pixel to its corresponding tile y-coordinate.
<span class='line'>200</span>   * @param {Object} map A map object, containing a map array and a tileset array.
<span class='line'>201</span>   * @param {Integer} y A y-coordinate.
<span class='line'>202</span>   * @param {Integer} gap (Not used.)
<span class='line'>203</span>   * @returns A map object with map.w, map.h, map.hh, and map.hw set correctly.
<span class='line'>204</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">	</span><span class="NAME">yPixelToTileY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">gap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox._tiles</span><span class="PUNC">[</span><span class="NAME">map.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">/</span><span class="NAME">ts.tileh</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>211</span>   * Converts an x-coordinate of a pixel to the x-coordinate of the tile column it's in. This effectively "snaps" an x coordinate to a tile edge.
<span class='line'>212</span>   * @param {Object} map A map object, containing a map array and a tileset array.
<span class='line'>213</span>   * @param {Integer} x An x-coordinate.
<span class='line'>214</span>   * @param {Integer} gap Number of pixels gap in tilemap. Default is 0.
<span class='line'>215</span>   * @returns The x-coordinate in pixels of the tile column.
<span class='line'>216</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">	</span><span class="NAME">xPixelToTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">gap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox._tiles</span><span class="PUNC">[</span><span class="NAME">map.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">/</span><span class="NAME">ts.tilew</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">gap</span><span class="PUNC">?</span><span class="NAME">gap</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>221</span> 
<span class='line'>222</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>223</span>   * Converts a y-coordinate of a pixel to the y-coordinate of the tile row it's in. This effectively "snaps" a y coordinate to a tile edge.
<span class='line'>224</span>   * @param {Object} map A map object, containing a map array and a tileset array.
<span class='line'>225</span>   * @param {Integer} y A y-coordinate.
<span class='line'>226</span>   * @param {Integer} gap Number of pixels gap in tilemap. Default is 0.
<span class='line'>227</span>   * @returns The y-coordinate in pixels of the tile row.
<span class='line'>228</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">	</span><span class="NAME">yPixelToTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">gap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox._tiles</span><span class="PUNC">[</span><span class="NAME">map.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">/</span><span class="NAME">ts.tileh</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">gap</span><span class="PUNC">?</span><span class="NAME">gap</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">ts.tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>235</span>   * Limits a number to a certain range. If the number is below the minimum, the minimum is returned. If the number is above the maximum, the maximum is returned.
<span class='line'>236</span>   * @param {Float} v A value.
<span class='line'>237</span>   * @param {Float} min The minimum limit.
<span class='line'>238</span>   * @param {Float} max The maximum limit.
<span class='line'>239</span>   * @returns A value equal to v if min&lt;v&lt;max. Returns min if v&lt;min, max if v>max.
<span class='line'>240</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">	</span><span class="NAME">limit</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="NAME">min</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">&lt;</span><span class="NAME">min</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">min</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">></span><span class="NAME">max</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">max</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>246</span>   * Subtracts or adds 1 to a value, always converging to zero. For example, passing -3 yields -2, 5 yields 4, etc. Works best with integers.
<span class='line'>247</span>   * @param {Integer} v A value.
<span class='line'>248</span>   * @returns A value that is one closer to 0 on the number line than v.
<span class='line'>249</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">	</span><span class="NAME">goToZero</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">?</span><span class="NAME">v</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">/</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>253</span>   * Merges two sets of parameters together without overwriting existing parameters. This merges from model to data, and if data and model share parameters, data's values remain intact.
<span class='line'>254</span>   * @param {Object} data An object containing a set of parameters, the destination of the merge.
<span class='line'>255</span>   * @param {Object} model An object containing a set of parameters, the source of the merge.
<span class='line'>256</span>   * @returns A merged model where the values of 'data' remain untouched: only new parameters and values from 'model' make it in.
<span class='line'>257</span>   * @example
<span class='line'>258</span>   * dst = {a: 1, b: 2, c: "three"};
<span class='line'>259</span>   * src = {c: "three", d: "four"};
<span class='line'>260</span>   * merged = help.mergeWithModel(dst,src);
<span class='line'>261</span>   * merged; // => {a: 1, b: 2, c: 3, d: "four"};
<span class='line'>262</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">	</span><span class="NAME">mergeWithModel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">model</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">model</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>272</span>   * Merges two sets of parameters together overwriting any existing parameters. This merges model->data, and if data and model share parameters, data's are overwritten by model's.
<span class='line'>273</span>   * @param {Object} data An object containing a set of parameters, the destination of the merge.
<span class='line'>274</span>   * @param {Object} model An object containing a set of parameters, the source of the merge.
<span class='line'>275</span>   * @returns A merged model where the values of 'model' take precedence over those of 'data'. The 'data' object is returned and will be an exact copy of 'model', plus any parameters that 'data' had before the merge that 'model' did not.
<span class='line'>276</span>   * @example
<span class='line'>277</span>   * dst = {a: 1, b: 2, c: "three"};
<span class='line'>278</span>   * src = {c: "three", d: "four"};
<span class='line'>279</span>   * merged = help.mergeWithModel(dst,src);
<span class='line'>280</span>   * merged; // => {a: 1, b: 2, c: "three", d: "four"}
<span class='line'>281</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">	</span><span class="NAME">copyModel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">model</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">model</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>288</span> 
<span class='line'>289</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>290</span>   * Creates a subset of an existing set of parameters.
<span class='line'>291</span>   * @param {Object} obj An object containing a set of parameters, the source of the data.
<span class='line'>292</span>   * @param {Array} attrs An array of strings, containing the names of parameters you wish to copy.
<span class='line'>293</span>   * @returns A new set of parameters based on the subset specified.
<span class='line'>294</span>   * @example
<span class='line'>295</span>   * data = {a: 1, b: 2, c: "three"};
<span class='line'>296</span>   * newdata = help.createModel(data, ["a", "c"]);
<span class='line'>297</span>   * newdata; // => {a: 1, c: "three"}
<span class='line'>298</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">	</span><span class="NAME">createModel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">attrs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">attrs.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">[</span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">attrs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>306</span>   * Creates a duplicate of an existing set of parameters.
<span class='line'>307</span>   * @param {Object} model An object containing a set of parameters.
<span class='line'>308</span>   * @returns A new object, equivalent to 'model'.
<span class='line'>309</span>   * @example
<span class='line'>310</span>   * data = {a: 1, b: 2, c: "three"};
<span class='line'>311</span>   * newdata = help.cloneObject(data);
<span class='line'>312</span>   * newdata; // => {a: 1, b: 2, c: "three"}
<span class='line'>313</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">	</span><span class="NAME">cloneObject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">model</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">model</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>322</span>   * Sets a tile in the map and draws it. Does not return anything.
<span class='line'>323</span>   * @param {Object} ctx The canvas context for the map. Accessed via gbox.getCanvasContext("canvasname")
<span class='line'>324</span>   * @param {Object} map The game map object.
<span class='line'>325</span>   * @param {Integer} x The index of the tile column within the map array -- so a 1 would mean the second column of tiles. 
<span class='line'>326</span>   * @param {Integer} y The index of the tile row within the map array -- so a 1 would mean the second row of tiles. 
<span class='line'>327</span>   * @param {Integer} tile The integer representing the new tile you wish to draw. This is its index within the tileset; a null value will erase whatever tile is present.
<span class='line'>328</span>   * @param {String} The ID of the map. Defaults to 'map'.
<span class='line'>329</span>   * @example
<span class='line'>330</span>   * // Remove the second tile to the right and down from the upper left corner of the tile map. Assumes our map canvas is called 'map_canvas'.
<span class='line'>331</span>   * help.setTileInMap(gbox.getCanvasContext("map_canvas"),map,1,1,null,"map");
<span class='line'>332</span>   */</span><span class="WHIT">	  </span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">	</span><span class="NAME">setTileInMap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">,</span><span class="NAME">tilemap</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">,</span><span class="NAME">map</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">gbox.getTiles</span><span class="PUNC">(</span><span class="NAME">tilemap.tileset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">		</span><span class="NAME">tilemap</span><span class="PUNC">[</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="STRN">"map"</span><span class="PUNC">:</span><span class="NAME">map</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">tile</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitClear</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">ts.tileh</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">ts.tilew</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitTile</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">tilemap.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">tile</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>342</span> 
<span class='line'>343</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>344</span>   * Returns the Nth element in an array. If the array is shorter than N, it returns the last element of the array.
<span class='line'>345</span>   * @param {Array} a An array.
<span class='line'>346</span>   * @param {Integer} id An index to the array.
<span class='line'>347</span>   * @returns If id > a.length, it returns a[a.length-1]. Otherwise returns a[id].
<span class='line'>348</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">	</span><span class="NAME">getArrayCapped</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">>=</span><span class="NAME">a.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">a.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>352</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">	</span><span class="COMM">// Get an item of an array of object, using a field as index. is returned the first entry if the field is not valued.</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">	</span><span class="NAME">getArrayIndexed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">		</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">></span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">field</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="NAME">a.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>363</span>   * Converts a quantity of frames into a timestamp formatted "mm:ss:cs" (minutes, seconds, centiseconds). Calculated using the current frames per second.
<span class='line'>364</span>   * @param {Integer} frames A quantity of frames.
<span class='line'>365</span>   * @returns A string containing a timestamp formatted "mm:ss:cs", representing the length of time it would take to render that many frames.
<span class='line'>366</span>   * @example
<span class='line'>367</span>   * // Assuming 25 frames per second, Akihabara's default.
<span class='line'>368</span>   * timestamp = help.framestotime(25);
<span class='line'>369</span>   * timestamp; // => '00:01:00';
<span class='line'>370</span>   * timestamp = help.framestotime(25 * 60);
<span class='line'>371</span>   * timestamp; // => '01:00:00';  
<span class='line'>372</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">	</span><span class="NAME">framestotime</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">csec</span><span class="PUNC">=</span><span class="NAME">Math.ceil</span><span class="PUNC">(</span><span class="NAME">frames</span><span class="PUNC">/</span><span class="NAME">gbox.getFps</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prepad</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">csec</span><span class="PUNC">/</span><span class="NUMB">6000</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">this.prepad</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">csec</span><span class="PUNC">/</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">60</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">this.prepad</span><span class="PUNC">(</span><span class="NAME">csec</span><span class="PUNC">%</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="STRN">"0"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>380</span>   * Reads the value of a query parameter from the URL of the web page. 
<span class='line'>381</span>   * @param {String} name The name of the URL parameter.
<span class='line'>382</span>   * @returns The value of the URL parameter, as a string.
<span class='line'>383</span>   * @example
<span class='line'>384</span>   * // If the URL is http://example.com/game.html?lives=3
<span class='line'>385</span>   * player.lives = help.geturlparameter("lives");
<span class='line'>386</span>   * player.lives; // => 3
<span class='line'>387</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">	</span><span class="NAME">geturlparameter</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">	  </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">name.replace</span><span class="PUNC">(</span><span class="REGX">/[\[]/</span><span class="PUNC">,</span><span class="STRN">"\\\["</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/[\]]/</span><span class="PUNC">,</span><span class="STRN">"\\\]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">	  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">regexS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"[\\?&]"</span><span class="PUNC">+</span><span class="NAME">name</span><span class="PUNC">+</span><span class="STRN">"=([^&#]*)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">	  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">regex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">regexS</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">	  </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">regex.exec</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">window.location.href</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">	  </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">	  </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>400</span>   * Writes the contents of an object to a string. Useful for debugging.
<span class='line'>401</span>   * @param {Object} Any object.
<span class='line'>402</span>   * @returns A string containing all the contents of an object. If the object contains functions, the string will contain the code for those functions.
<span class='line'>403</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">	</span><span class="NAME">objToStr</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">n</span><span class="PUNC">+</span><span class="STRN">":["</span><span class="PUNC">+</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"] "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>411</span>   * Tests whether an object contains a given parameter.
<span class='line'>412</span>   * @param {Object} A reference to a parameter of an object.
<span class='line'>413</span>   * @returns True if the object contains that parameter, false if it does not.
<span class='line'>414</span>   * @example
<span class='line'>415</span>   * foo = {a: 1, b: 2};
<span class='line'>416</span>   * help.isDefined(foo.a); // => true
<span class='line'>417</span>   * help.isDefined(foo.c); // => false
<span class='line'>418</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">	</span><span class="NAME">isDefined</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">===</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>424</span>   * Automatically configures a bunch of settings depending on the web browser and device that is viewing the game. Mostly sets the maximum number of audio channels and touch settings.
<span class='line'>425</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">	</span><span class="NAME">getDeviceConfig</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>427</span> 
<span class='line'>428</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cap</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/iPhone/i</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/iPod/i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/Android/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">			</span><span class="NAME">cap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">touch</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NUMB">320</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/iPad/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">			</span><span class="NAME">cap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">touch</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NUMB">768</span><span class="PUNC">,</span><span class="NAME">forcedidle</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Forced idle time is needed for correct framerate calculation.</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">			</span><span class="NAME">cap</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">zoom</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">		</span><span class="NAME">cap.canaudio</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'audio'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">canPlayType</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>437</span> 
<span class='line'>438</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cap.canaudio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/iPad/i</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/iPhone/i</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/iPod/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">				</span><span class="NAME">cap.audiocompatmode</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Single audio per time, so compatibility mode is needed. Plays only the "bgmusic" channel.</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioteam</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Only a member is required in the audioteam.</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioisexperimental</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Audio is experimental, since limited.</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/Chrome/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioteam</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Quite low performance on playback responsiveness.</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/Firefox/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioteam</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Testing smaller audioteam</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">				</span><span class="NAME">cap.audiopositiondelay</span><span class="PUNC">=</span><span class="NUMB">0.3</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Ogg playback is slower 0.3 between MP3 playback. Don't know why :)</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">				</span><span class="NAME">cap.audiocreatemode</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Firefox is stalling while downloading lot of things</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/Minefield/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioteam</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Testing smaller audioteam</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">				</span><span class="NAME">cap.audiocreatemode</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Firefox is stalling while downloading lot of things</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">				</span><span class="COMM">// Minefield has fixed the 0.3 delay!</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/Safari/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioteam</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Testing smaller audioteam						</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">navigator.userAgent.match</span><span class="PUNC">(</span><span class="REGX">/Opera/i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioteam</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Testing smaller audioteam			</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">				</span><span class="NAME">cap.audiocreatemode</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Do not like audio object cloning very much</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>459</span> </span><span class="WHIT">				</span><span class="NAME">cap.audioisexperimental</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Audio is just experimental on all other devices.</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>462</span> 
<span class='line'>463</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cap</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>465</span> 
<span class='line'>466</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>467</span>   * This provides a number of configurations: fps, display zoom, dynamic frameskip, force touch parameters, etc. Many of these settings can
<span class='line'>468</span>   * be set manually by passing an object with the parameters defined, or via URL parameters.
<span class='line'>469</span>   * @param {Object} data An optional object containing parameters you wish to set. Works for data.zoom, data.splash, data.width, data.height, data.title, data.fps, and data.padmode.
<span class='line'>470</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">	</span><span class="NAME">akihabaraInit</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">title</span><span class="PUNC">:</span><span class="NAME">data</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">device</span><span class="PUNC">=</span><span class="NAME">this.getDeviceConfig</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>474</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">footnotes</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="STRN">"MADE WITH AKIHABARA (C)2010 - GPL2/MIT"</span><span class="PUNC">,</span><span class="STRN">"Project: www.kesiev.com/akihabara"</span><span class="PUNC">,</span><span class="STRN">"Sources: github.com/kesiev/akihabara"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">		</span><span class="NAME">document.title</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.title</span><span class="PUNC">?</span><span class="NAME">data.title</span><span class="PUNC">:</span><span class="STRN">"Akihabara"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.splash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.splash.footnotes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">footnotes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data.splash.footnotes.push</span><span class="PUNC">(</span><span class="NAME">footnotes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">			</span><span class="NAME">gbox.setSplashSettings</span><span class="PUNC">(</span><span class="NAME">data.splash</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenwidth</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.width</span><span class="PUNC">?</span><span class="NAME">data.width</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.portrait</span><span class="PUNC">?</span><span class="NUMB">240</span><span class="PUNC">:</span><span class="NUMB">320</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">screenheight</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.height</span><span class="PUNC">?</span><span class="NAME">data.height</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">data.portrait</span><span class="PUNC">?</span><span class="NUMB">320</span><span class="PUNC">:</span><span class="NUMB">240</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data.splash</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">data.splash.minilogo</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setSplashSettings</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">minilogo</span><span class="PUNC">:</span><span class="STRN">"logo"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data.splash</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">data.splash.background</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setSplashSettings</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">background</span><span class="PUNC">:</span><span class="STRN">"akihabara/splash.png"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data.splash</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">data.splash.minimalTime</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setSplashSettings</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">minimalTime</span><span class="PUNC">:</span><span class="NUMB">3000</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data.splash</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">data.splash.footnotes</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setSplashSettings</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">footnotes</span><span class="PUNC">:</span><span class="NAME">footnotes</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">		</span><span class="NAME">document.body.style.backgroundColor</span><span class="PUNC">=</span><span class="STRN">"#000000"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">		</span><span class="NAME">gbox.setScreenBorder</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"statusbar"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setStatusBar</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"db"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setDoubleBuffering</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"noautoskip"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAutoskip</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"zoom"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setZoom</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"zoom"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">	     	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">data.zoom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setZoom</span><span class="PUNC">(</span><span class="NAME">data.zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.zoom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setZoom</span><span class="PUNC">(</span><span class="NAME">device.zoom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.width</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setZoom</span><span class="PUNC">(</span><span class="NAME">device.width</span><span class="PUNC">/</span><span class="NAME">screenwidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"fps"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setFps</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"fps"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox.setFps</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fps</span><span class="PUNC">?</span><span class="NAME">data.fps</span><span class="PUNC">:</span><span class="NUMB">25</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"fskip"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setFrameskip</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"fskip"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"forcedidle"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setForcedIdle</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"forcedidle"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.forcedidle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setForcedIdle</span><span class="PUNC">(</span><span class="NAME">device.forcedidle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"canlog"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setCanLog</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>502</span> 
<span class='line'>503</span> </span><span class="WHIT">		</span><span class="NAME">gbox.initScreen</span><span class="PUNC">(</span><span class="NAME">screenwidth</span><span class="PUNC">,</span><span class="NAME">screenheight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>504</span> 
<span class='line'>505</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"showplayers"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setShowPlayers</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"showplayers"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"yes"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"canaudio"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setCanAudio</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"canaudio"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"yes"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">			</span><span class="NAME">gbox.setCanAudio</span><span class="PUNC">(</span><span class="NAME">device.canaudio</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">device.audioisexperimental</span><span class="PUNC">||</span><span class="NAME">gbox.getFlag</span><span class="PUNC">(</span><span class="STRN">"experimental"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiocompatmode"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioCompatMode</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiocompatmode"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.audiocompatmode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioCompatMode</span><span class="PUNC">(</span><span class="NAME">device.audiocompatmode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audioteam"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioTeam</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audioteam"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.audioteam</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioTeam</span><span class="PUNC">(</span><span class="NAME">device.audioteam</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"loweraudioteam"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setLowerAudioTeam</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"loweraudioteam"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.loweraudioteam</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setLowerAudioTeam</span><span class="PUNC">(</span><span class="NAME">device.loweraudioteam</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiocreatemode"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioCreateMode</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiocreatemode"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.audiocreatemode</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioCreateMode</span><span class="PUNC">(</span><span class="NAME">device.audiocreatemode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiodequeuetime"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioDequeueTime</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiodequeuetime"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.audiodequeuetime</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioDequeueTime</span><span class="PUNC">(</span><span class="NAME">device.audiodequeuetime</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiopositiondelay"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioPositionDelay</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"audiopositiondelay"</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.isDefined</span><span class="PUNC">(</span><span class="NAME">device.audiopositiondelay</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setAudioPositionDelay</span><span class="PUNC">(</span><span class="NAME">device.audiopositiondelay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"touch"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"no"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">help.geturlparameter</span><span class="PUNC">(</span><span class="STRN">"touch"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"yes"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="NAME">device.touch</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">				</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.padmode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">					</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"fretboard"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">						</span><span class="NAME">iphofretboard.initialize</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NAME">bg</span><span class="PUNC">:</span><span class="STRN">"akihabara/fretboard.png"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">					</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">					</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">						</span><span class="NAME">iphopad.initialize</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NAME">dpad</span><span class="PUNC">:</span><span class="STRN">"akihabara/dpad.png"</span><span class="PUNC">,</span><span class="NAME">buttons</span><span class="PUNC">:</span><span class="STRN">"akihabara/buttons.png"</span><span class="PUNC">,</span><span class="NAME">bg</span><span class="PUNC">:</span><span class="STRN">"akihabara/padbg.png"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>539</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>540</span> </span></pre></body></html>