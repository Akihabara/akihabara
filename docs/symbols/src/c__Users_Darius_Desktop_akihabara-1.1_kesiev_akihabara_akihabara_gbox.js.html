<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ---</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Copyright (c) 2010 Francesco Cottone, http://www.kesiev.com/</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>  4</span> 
<span class='line'>  5</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dynalist</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>  6</span> </span><span class="WHIT">	</span><span class="NAME">create</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>  7</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>  8</span> </span><span class="WHIT">			</span><span class="NAME">first</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>  9</span> </span><span class="WHIT">			</span><span class="NAME">last</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="WHIT">			</span><span class="NAME">data</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 11</span> </span><span class="WHIT">			</span><span class="NAME">dl</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 12</span> </span><span class="WHIT">			</span><span class="NAME">gar</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 13</span> </span><span class="WHIT">			</span><span class="NAME">disconnect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 14</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 15</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 16</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="WHIT">			</span><span class="NAME">addObject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nid</span><span class="PUNC">=</span><span class="NAME">this.gar.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nid</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">					</span><span class="NAME">nid</span><span class="PUNC">=</span><span class="NAME">this.dl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">					</span><span class="NAME">this.dl</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.first</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// First element</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">					</span><span class="NAME">obj.__next</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">					</span><span class="NAME">obj.__first</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">					</span><span class="NAME">this.first</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">					</span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// Chain next</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">					</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__prio</span><span class="PUNC">></span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// if last, chain in queue</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">						</span><span class="NAME">obj.__next</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">						</span><span class="NAME">obj.__first</span><span class="PUNC">=</span><span class="NAME">this.last</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">						</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.last</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">						</span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// else reconnect objects</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">						</span><span class="NAME">obj.__first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">						</span><span class="NAME">obj.__next</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">						</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj.__first</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obj.__first</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.first</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">				</span><span class="NAME">obj.__prio</span><span class="PUNC">=</span><span class="NAME">prio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">				</span><span class="NAME">obj.__id</span><span class="PUNC">=</span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">				</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">nid</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">			</span><span class="NAME">setPrio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obd</span><span class="PUNC">,</span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__prio</span><span class="PUNC">==</span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.first</span><span class="PUNC">!=</span><span class="NAME">this.last</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__prio</span><span class="PUNC">&lt;</span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">!=</span><span class="NAME">this.last</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">						</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__prio</span><span class="PUNC">>=</span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">!=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">							</span><span class="COMM">// disconnect</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">							</span><span class="NAME">this.disconnect</span><span class="PUNC">(</span><span class="NAME">obd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">							</span><span class="COMM">// Reconnect</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.last</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">this.last</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">								</span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">!=</span><span class="NAME">this.first</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">						</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__prio</span><span class="PUNC">&lt;=</span><span class="NAME">prio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">!=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">							</span><span class="COMM">// disconnect</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">							</span><span class="NAME">this.disconnect</span><span class="PUNC">(</span><span class="NAME">obd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.first</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">this.first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="WHIT">								</span><span class="NAME">this.first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">								</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__first</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.last</span><span class="PUNC">=</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">				</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__prio</span><span class="PUNC">=</span><span class="NAME">prio</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">			</span><span class="NAME">remove</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">				</span><span class="NAME">this.disconnect</span><span class="PUNC">(</span><span class="NAME">obd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">				</span><span class="NAME">this.gar.push</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">this.data</span><span class="PUNC">[</span><span class="NAME">obd</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>106</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>107</span> 
<span class='line'>108</span> </span><span class="COMM">// A special circular queue with some features useful for the resource loader</span><span class="WHIT">
<span class='line'>109</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cyclelist</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">	</span><span class="NAME">create</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">			</span><span class="NAME">_head</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">			</span><span class="NAME">_tail</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">			</span><span class="NAME">_data</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">			</span><span class="NAME">_size</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">?</span><span class="NAME">size</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">			</span><span class="NAME">_total</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">			</span><span class="NAME">_done</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">			</span><span class="NAME">_current</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">			</span><span class="NAME">getTotal</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._total</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Number of elements to be "poped"</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">			</span><span class="NAME">getDone</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._done</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Number of popped elements since the last empty</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">			</span><span class="NAME">getSize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._size</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// The maximum number of elements in the queue</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">			</span><span class="NAME">isProcessing</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._current</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// The last pop was not a null (i.e. the queue returned a valid object)</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">			</span><span class="NAME">isEnded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._head</span><span class="PUNC">==</span><span class="NAME">this._tail</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// There are other elements in the queue</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">			</span><span class="NAME">isBusy</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.isProcessing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">this.isEnded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// There are elements in the queue/the last one pop returned an object that is being processed</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">			</span><span class="NAME">getCurrent</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._current</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Return the last popped element</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">			</span><span class="NAME">push</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">				</span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">this._head</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">				</span><span class="NAME">this._head</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._head</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">this._size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">				</span><span class="NAME">this._total</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">			</span><span class="NAME">pop</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isEnded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">					</span><span class="NAME">this._total</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">					</span><span class="NAME">this._done</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">					</span><span class="NAME">this._current</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">					</span><span class="NAME">this._current</span><span class="PUNC">=</span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">this._tail</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">					</span><span class="NAME">this._tail</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._tail</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">this._size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">					</span><span class="NAME">this._done</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._current</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">			</span><span class="NAME">dump</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this._size</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">+</span><span class="STRN">") "</span><span class="PUNC">+</span><span class="NAME">this._data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">" | "</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NAME">this._head</span><span class="PUNC">?</span><span class="STRN">"HEAD "</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NAME">this._tail</span><span class="PUNC">?</span><span class="STRN">"TAIL "</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">				</span><span class="NAME">r</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"\n\n"</span><span class="PUNC">+</span><span class="NAME">this._done</span><span class="PUNC">+</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">this._total</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>153</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>154</span> 
<span class='line'>155</span> </span><span class="COMM">// A simple circular cache handler</span><span class="WHIT">
<span class='line'>156</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cachelist</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">	</span><span class="NAME">create</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">			</span><span class="NAME">_cache</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">			</span><span class="NAME">_queue</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">			</span><span class="NAME">_head</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">			</span><span class="NAME">_size</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">?</span><span class="NAME">size</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">			</span><span class="NAME">add</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._cache</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._queue</span><span class="PUNC">[</span><span class="NAME">this._head</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._cache</span><span class="PUNC">[</span><span class="NAME">this._queue</span><span class="PUNC">[</span><span class="NAME">this._head</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">					</span><span class="NAME">this._queue</span><span class="PUNC">[</span><span class="NAME">this._head</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">k</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">					</span><span class="NAME">this._cache</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">pos</span><span class="PUNC">:</span><span class="NAME">this._head</span><span class="PUNC">,</span><span class="NAME">value</span><span class="PUNC">:</span><span class="NAME">v</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">					</span><span class="NAME">this._head</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._head</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">this._size</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this._cache</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">			</span><span class="NAME">read</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._cache</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">?</span><span class="NAME">this._cache</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">			</span><span class="NAME">clear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">				</span><span class="NAME">this._cache</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">				</span><span class="NAME">this._queue</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">				</span><span class="NAME">this._head</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>182</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>183</span> 
<span class='line'>184</span> </span><span class="COMM">/**
<span class='line'>185</span>  * @namespace
<span class='line'>186</span>  * Gamebox module allows multiple grouped objects to move simultaneously, it helps with collisions, 
<span class='line'>187</span>  * rendering and moving objects. It also provides monospaced pixel-font rendering, keyboard handling,  
<span class='line'>188</span>  * audio, double buffering and eventually FSEs. Gamebox can also store and load data from cookies! 
<span class='line'>189</span>  */</span><span class="WHIT">
<span class='line'>190</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gbox</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">	</span><span class="COMM">// CONSTANTS</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">	</span><span class="NAME">ALIGN_CENTER</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">	</span><span class="NAME">ALIGN_MIDDLE</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">	</span><span class="NAME">ALIGN_RIGHT</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">	</span><span class="NAME">ALIGN_BOTTOM</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">	</span><span class="NAME">COLOR_BLACK</span><span class="PUNC">:</span><span class="STRN">'rgb(0,0,0)'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">	</span><span class="NAME">COLOR_WHITE</span><span class="PUNC">:</span><span class="STRN">'rgb(255,255,255)'</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">	</span><span class="NAME">ZINDEX_LAYER</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">	</span><span class="COMM">// VARS</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">	</span><span class="NAME">_autoid</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">	</span><span class="NAME">_cb</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// callback for loadAll()</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">	</span><span class="NAME">_keyboard</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">	</span><span class="NAME">_keymap</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">		</span><span class="NAME">up</span><span class="PUNC">:</span><span class="NUMB">38</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">		</span><span class="NAME">down</span><span class="PUNC">:</span><span class="NUMB">40</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">		</span><span class="NAME">right</span><span class="PUNC">:</span><span class="NUMB">39</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">		</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">37</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">		</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NUMB">90</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">		</span><span class="NAME">b</span><span class="PUNC">:</span><span class="NUMB">88</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">		</span><span class="NAME">c</span><span class="PUNC">:</span><span class="NUMB">67</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">	</span><span class="NAME">_flags</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">		</span><span class="NAME">experimental</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">		</span><span class="NAME">noaudio</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">	</span><span class="NAME">_fonts</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">	</span><span class="NAME">_tiles</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">	</span><span class="NAME">_images</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">	</span><span class="NAME">_camera</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">	</span><span class="NAME">_screen</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">	</span><span class="NAME">_screenposition</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">	</span><span class="NAME">_keyboardpicker</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">	</span><span class="NAME">_screenh</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">	</span><span class="NAME">_screenw</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">	</span><span class="NAME">_screenhh</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">	</span><span class="NAME">_screenhw</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">	</span><span class="NAME">_zoom</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">	</span><span class="NAME">_canvas</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">	</span><span class="NAME">_objects</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">	</span><span class="NAME">_groups</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">	</span><span class="NAME">_renderorder</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">	</span><span class="NAME">_groupplay</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">	</span><span class="NAME">_actionqueue</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"first"</span><span class="PUNC">,</span><span class="STRN">"then"</span><span class="PUNC">,</span><span class="STRN">"blit"</span><span class="PUNC">,</span><span class="STRN">"after"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// initialize is executed once</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">	</span><span class="NAME">_mspf</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">	</span><span class="NAME">_fps</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">	</span><span class="NAME">_gametimer</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">	</span><span class="NAME">_frameskip</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">	</span><span class="NAME">_autoskip</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">min</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">max</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">lowidle</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">hiidle</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// minimum frameskip, maximum frameskip, minimum idle time allowed for increasing frameskip, maximum idle time allowed for decreasing frameskip</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">	</span><span class="NAME">_fskid</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">	</span><span class="NAME">_statbar</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">	</span><span class="NAME">_border</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">	</span><span class="NAME">_garbage</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">	</span><span class="NAME">_zindexch</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">	</span><span class="NAME">_framestart</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">	</span><span class="NAME">_zindex</span><span class="PUNC">:</span><span class="NAME">dynalist.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">	</span><span class="NAME">_db</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">	</span><span class="NAME">_systemcookie</span><span class="PUNC">:</span><span class="STRN">"__gboxsettings"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">	</span><span class="NAME">_sessioncache</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">	</span><span class="NAME">_breakcacheurl</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">a.indexOf</span><span class="PUNC">(</span><span class="STRN">"?"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">?</span><span class="STRN">"?"</span><span class="PUNC">:</span><span class="STRN">"&"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"_brc="</span><span class="PUNC">+</span><span class="NAME">gbox._sessioncache</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">	</span><span class="NAME">_forcedidle</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">	</span><span class="NAME">_gamewaiting</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">	</span><span class="NAME">_canlog</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">	</span><span class="NAME">_splash</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">		</span><span class="NAME">gaugeLittleColor</span><span class="PUNC">:</span><span class="STRN">"rgb(255,240,0)"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">		</span><span class="NAME">gaugeLittleBackColor</span><span class="PUNC">:</span><span class="STRN">"rgb(255,255,255)"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">		</span><span class="NAME">gaugeBorderColor</span><span class="PUNC">:</span><span class="STRN">"rgb(0,0,0)"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">		</span><span class="NAME">gaugeBackColor</span><span class="PUNC">:</span><span class="STRN">"rgb(100,100,100)"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">		</span><span class="NAME">gaugeColor</span><span class="PUNC">:</span><span class="STRN">"rgb(255,240,0)"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">		</span><span class="NAME">gaugeHeight</span><span class="PUNC">:</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">		</span><span class="NAME">background</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">		</span><span class="NAME">minimalTime</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">		</span><span class="NAME">footnotes</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">		</span><span class="NAME">footnotesSpacing</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">	</span><span class="NAME">_minimalexpired</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 0: not triggered, 1: triggered, 2: done</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">	</span><span class="NAME">setCanLog</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._canlog</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">&&</span><span class="NAME">window.console</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">	</span><span class="NAME">canLog</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._canlog</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">	</span><span class="NAME">log</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Overridden if console is really available</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">	</span><span class="NAME">_safedrawimage</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">img</span><span class="PUNC">,</span><span class="NAME">sx</span><span class="PUNC">,</span><span class="NAME">sy</span><span class="PUNC">,</span><span class="NAME">sw</span><span class="PUNC">,</span><span class="NAME">sh</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">,</span><span class="NAME">dh</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">img</span><span class="PUNC">||</span><span class="PUNC">!</span><span class="NAME">tox</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sx</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">dw</span><span class="PUNC">/</span><span class="NAME">sw</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">sx</span><span class="PUNC">;</span><span class="NAME">sw</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">sx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">dh</span><span class="PUNC">/</span><span class="NAME">sh</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">sy</span><span class="PUNC">;</span><span class="NAME">sh</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">sy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sx</span><span class="PUNC">+</span><span class="NAME">sw</span><span class="PUNC">></span><span class="NAME">img.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dw</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">dw</span><span class="PUNC">/</span><span class="NAME">sw</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">img.width</span><span class="PUNC">-</span><span class="NAME">sx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sw</span><span class="PUNC">=</span><span class="NAME">img.width</span><span class="PUNC">-</span><span class="NAME">sx</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">+</span><span class="NAME">sh</span><span class="PUNC">></span><span class="NAME">img.height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dh</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">dh</span><span class="PUNC">/</span><span class="NAME">sh</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">img.height</span><span class="PUNC">-</span><span class="NAME">sy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">sh</span><span class="PUNC">=</span><span class="NAME">img.height</span><span class="PUNC">-</span><span class="NAME">sy</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">		</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sh</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">sw</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">sx</span><span class="PUNC">&lt;</span><span class="NAME">img.width</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">sy</span><span class="PUNC">&lt;</span><span class="NAME">img.height</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">tox.drawImage</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="NAME">sy</span><span class="PUNC">,</span><span class="NAME">sw</span><span class="PUNC">,</span><span class="NAME">sh</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">,</span><span class="NAME">dh</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">	</span><span class="NAME">_keydown</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">e.fake</span><span class="PUNC">||</span><span class="NAME">window.event</span><span class="PUNC">?</span><span class="NAME">e.keyCode</span><span class="PUNC">:</span><span class="NAME">e.which</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">	</span><span class="NAME">_keyup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">e.fake</span><span class="PUNC">||</span><span class="NAME">window.event</span><span class="PUNC">?</span><span class="NAME">e.keyCode</span><span class="PUNC">:</span><span class="NAME">e.which</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">		</span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">	</span><span class="NAME">_resetkeys</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._keymap</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">			</span><span class="NAME">gbox._keyup</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">fake</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">keyCode</span><span class="PUNC">:</span><span class="NAME">gbox._keymap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">	</span><span class="NAME">_showkeyboardpicker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">		</span><span class="NAME">gbox._keyboardpicker.value</span><span class="PUNC">=</span><span class="STRN">"Click/Tap here to enable the keyboard"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">		</span><span class="NAME">gbox._keyboardpicker.style.left</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">gbox._screenposition.x</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">		</span><span class="NAME">gbox._keyboardpicker.style.top</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">gbox._screenposition.y</span><span class="PUNC">+</span><span class="NUMB">5</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">		</span><span class="NAME">gbox._keyboardpicker.style.width</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">gbox._screenposition.w</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">		</span><span class="NAME">gbox._keyboardpicker.style.height</span><span class="PUNC">=</span><span class="STRN">"30px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.border</span><span class="PUNC">=</span><span class="STRN">"1px dashed white"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.readOnly</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">	</span><span class="NAME">_hidekeyboardpicker</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.zIndex</span><span class="PUNC">=</span><span class="NUMB">100</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.readOnly</span><span class="PUNC">=</span><span class="STRN">"yes"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.position</span><span class="PUNC">=</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.textAlign</span><span class="PUNC">=</span><span class="STRN">"center"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.backgroundColor</span><span class="PUNC">=</span><span class="STRN">"#000000"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.color</span><span class="PUNC">=</span><span class="STRN">"#fefefe"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.cursor</span><span class="PUNC">=</span><span class="STRN">"pointer"</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.value</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.left</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.top</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.height</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.width</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.border</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.padding</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.style.margin</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">	</span><span class="NAME">_domgetabsposition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">		</span><span class="NAME">sizes.h</span><span class="PUNC">=</span><span class="NAME">oElement.offsetHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">		</span><span class="NAME">sizes.w</span><span class="PUNC">=</span><span class="NAME">oElement.offsetWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">		</span><span class="KEYW">while</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">oElement</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">			</span><span class="NAME">sizes.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oElement.offsetTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">			</span><span class="NAME">sizes.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oElement.offsetLeft</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">			</span><span class="NAME">oElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oElement.offsetParent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>329</span>   * Sets the gbox._forcedidle property.
<span class='line'>330</span>   * @param {Boolean} f The value to write to gbox._forcedidle.
<span class='line'>331</span>   */</span><span class="WHIT">	  </span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">	</span><span class="NAME">setForcedIdle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._forcedidle</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>335</span>   * Returns a gbox flag at index f.
<span class='line'>336</span>   * @param {Object} f The index of the flag you want returned.
<span class='line'>337</span>   */</span><span class="WHIT">	  </span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">	</span><span class="NAME">getFlag</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._flags</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>341</span>   * Sets the gbox._statbar property. Only useful if called before gbox.initScreen. Debugging funtionality.
<span class='line'>342</span>   * Much easier to access if you add '?statusbar=1' to your URL.
<span class='line'>343</span>   * @param {Boolean} f The value to write to gbox._statbar.
<span class='line'>344</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">  </span><span class="NAME">setStatusBar</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._statbar</span><span class="PUNC">=</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">	</span><span class="NAME">setScreenBorder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._border</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>347</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>349</span>   * Initializes the screen to a certain width and height, applies zoom attributes, populates the 
<span class='line'>350</span>   * body of the HTML document including the canvas element, sets an initial camera, creates a '_buffer'
<span class='line'>351</span>   * canvas, sets keyboard event listeners, and many other initialization functions.
<span class='line'>352</span>   * @param {Integer} w The width of the main canvas.
<span class='line'>353</span>   * @param {Integer} h The height of the main canvas.
<span class='line'>354</span>   */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">	</span><span class="NAME">initScreen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">		</span><span class="NAME">document.body.style.textAlign</span><span class="PUNC">=</span><span class="STRN">"center"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">		</span><span class="NAME">container.style.width</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">		</span><span class="NAME">container.style.height</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">		</span><span class="NAME">container.style.display</span><span class="PUNC">=</span><span class="STRN">"table"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">		</span><span class="NAME">this._box</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">		</span><span class="NAME">this._box.style.display</span><span class="PUNC">=</span><span class="STRN">"table-cell"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">		</span><span class="NAME">this._box.style.width</span><span class="PUNC">=</span><span class="STRN">"100%"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">		</span><span class="NAME">this._box.style.textAlign</span><span class="PUNC">=</span><span class="STRN">"center"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">		</span><span class="NAME">this._box.style.verticalAlign</span><span class="PUNC">=</span><span class="STRN">"middle"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">		</span><span class="NAME">this._screen</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._border</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._screen.style.border</span><span class="PUNC">=</span><span class="STRN">"1px solid black"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">		</span><span class="NAME">this._screen.setAttribute</span><span class="PUNC">(</span><span class="STRN">'height'</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">		</span><span class="NAME">this._screen.setAttribute</span><span class="PUNC">(</span><span class="STRN">'width'</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">		</span><span class="NAME">this._screen.style.width</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">this._zoom</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">		</span><span class="NAME">this._screen.style.height</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NAME">this._zoom</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">		</span><span class="NAME">this._screenh</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">		</span><span class="NAME">this._screenw</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">		</span><span class="NAME">this._screenhh</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">		</span><span class="NAME">this._screenhw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">		</span><span class="NAME">this._camera.x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">		</span><span class="NAME">this._camera.y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">		</span><span class="NAME">this._camera.h</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">		</span><span class="NAME">this._camera.w</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">		</span><span class="NAME">this._box.appendChild</span><span class="PUNC">(</span><span class="NAME">this._screen</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">		</span><span class="NAME">container.appendChild</span><span class="PUNC">(</span><span class="NAME">this._box</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">		</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>384</span> 
<span class='line'>385</span> </span><span class="WHIT">		</span><span class="NAME">this.createCanvas</span><span class="PUNC">(</span><span class="STRN">"_buffer"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">		</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">'keydown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._keydown</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">		</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">'keyup'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this._keyup</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._statbar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">			</span><span class="NAME">this._statbar</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._border</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._statbar.style.border</span><span class="PUNC">=</span><span class="STRN">"1px solid black"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">			</span><span class="NAME">this._statbar.style.margin</span><span class="PUNC">=</span><span class="STRN">"auto"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">			</span><span class="NAME">this._statbar.style.backgroundColor</span><span class="PUNC">=</span><span class="STRN">"#ffffff"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">			</span><span class="NAME">this._statbar.style.fontSize</span><span class="PUNC">=</span><span class="STRN">"10px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">			</span><span class="NAME">this._statbar.style.fontFamily</span><span class="PUNC">=</span><span class="STRN">"sans-serif"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">			</span><span class="NAME">this._statbar.style.width</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">w</span><span class="PUNC">*</span><span class="NAME">this._zoom</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">			</span><span class="NAME">this._box.appendChild</span><span class="PUNC">(</span><span class="NAME">this._statbar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">		</span><span class="COMM">// Keyboard support on devices that needs focus (like iPad) - actually is not working for a bug on WebKit's "focus" command.</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"input"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">		</span><span class="NAME">this._keyboardpicker.onclick</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._hidekeyboardpicker</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">		</span><span class="NAME">this._hidekeyboardpicker</span><span class="PUNC">(</span><span class="NAME">this._keyboardpicker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">		</span><span class="NAME">gbox._box.appendChild</span><span class="PUNC">(</span><span class="NAME">this._keyboardpicker</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">		</span><span class="NAME">gbox._screen.ontouchstart</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._screenposition</span><span class="PUNC">=</span><span class="NAME">gbox._domgetabsposition</span><span class="PUNC">(</span><span class="NAME">gbox._screen</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.touches</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">pageY</span><span class="PUNC">-</span><span class="NAME">gbox._screenposition.y</span><span class="PUNC">&lt;</span><span class="NUMB">30</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._showkeyboardpicker</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox._hidekeyboardpicker</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">		</span><span class="NAME">gbox._screen.ontouchend</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">evt.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">		</span><span class="NAME">gbox._screen.ontouchmove</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">evt.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">		</span><span class="NAME">gbox._screen.onmousedown</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">gbox._screenposition</span><span class="PUNC">=</span><span class="NAME">gbox._domgetabsposition</span><span class="PUNC">(</span><span class="NAME">gbox._screen</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.pageY</span><span class="PUNC">-</span><span class="NAME">gbox._screenposition.y</span><span class="PUNC">&lt;</span><span class="NUMB">30</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="NAME">gbox._showkeyboardpicker</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox._hidekeyboardpicker</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.preventDefault</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">evt.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">		</span><span class="NAME">gbox._sessioncache</span><span class="PUNC">=</span><span class="NAME">d.getDate</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">d.getMonth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">d.getFullYear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">d.getHours</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">d.getMinutes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"-"</span><span class="PUNC">+</span><span class="NAME">d.getSeconds</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">		</span><span class="NAME">gbox._loadsettings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Load default configuration</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">		</span><span class="NAME">gbox.setCanAudio</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Tries to enable audio by default</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>415</span> 
<span class='line'>416</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>417</span>   * Sets the gbox._db property. Turns on an off double buffering.
<span class='line'>418</span>   * @param {Boolean} db The value to write to gbox._db. True enables double buffering, false disables.
<span class='line'>419</span>   */</span><span class="WHIT">	  </span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">	</span><span class="NAME">setDoubleBuffering</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">db</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._db</span><span class="PUNC">=</span><span class="NAME">db</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>423</span>   * Writes text to the status bar, but only if the status bar is enabled.
<span class='line'>424</span>   * @param {String} txt The text to write to the status bar.
<span class='line'>425</span>   */</span><span class="WHIT">	  </span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">	</span><span class="NAME">setStatBar</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">txt</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._statbar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._statbar.innerHTML</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">txt</span><span class="PUNC">?</span><span class="NAME">txt</span><span class="PUNC">:</span><span class="STRN">"&nbsp"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>427</span> 
<span class='line'>428</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>429</span>   * Set the frames per second rate.
<span class='line'>430</span>   * @param {Integer} f Total frames per second for the game to run at.
<span class='line'>431</span>   */</span><span class="WHIT">	  </span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">	</span><span class="NAME">setFps</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">		</span><span class="NAME">this._fps</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">		</span><span class="NAME">this._mspf</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NUMB">1000</span><span class="PUNC">/</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>438</span>   * Get the frames per second rate (default is 25).
<span class='line'>439</span>   * @returns {Integer} Returns the frames per second.
<span class='line'>440</span>   */</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">	</span><span class="NAME">getFps</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._fps</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">	</span><span class="NAME">setAutoskip</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._autoskip</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">	</span><span class="NAME">setFrameskip</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._frameskip</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>446</span>   * Get the screen height.
<span class='line'>447</span>   * @returns {Integer} Screen height in pixels.
<span class='line'>448</span>   */</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">	</span><span class="NAME">getScreenH</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._screenh</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>450</span> 
<span class='line'>451</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>452</span>   * Get the screen width.
<span class='line'>453</span>   * @returns {Integer} Screen width in pixels.
<span class='line'>454</span>   */</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">	</span><span class="NAME">getScreenW</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._screenw</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>458</span>   * Get the screen half-height.
<span class='line'>459</span>   * @returns {Integer} Screen half-height in pixels.
<span class='line'>460</span>   */</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">	</span><span class="NAME">getScreenHH</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._screenhh</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>462</span> 
<span class='line'>463</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>464</span>   * Get the screen half-width.
<span class='line'>465</span>   * @returns {Integer} Screen half-width in pixels.
<span class='line'>466</span>   */</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">	</span><span class="NAME">getScreenHW</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._screenhw</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>468</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>469</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>470</span>   * Sets the gbox._zoom parameter, only works before gbox.initScreen is called.
<span class='line'>471</span>   * @param {Integer} z Zoom factor.
<span class='line'>472</span>   */</span><span class="WHIT">
<span class='line'>473</span> </span><span class="WHIT">	</span><span class="NAME">setZoom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">z</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._zoom</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>474</span> 
<span class='line'>475</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>476</span>   * Deprecated: gbox._cb is now set by passing it directly into gbox.loadAll(). Left in for backwards compatibility.
<span class='line'>477</span>   * @param {String} cb The name of the function to be called once gbox.loadAll is completed.
<span class='line'>478</span>   */</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">	</span><span class="NAME">setCallback</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._cb</span><span class="PUNC">=</span><span class="NAME">cb</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>480</span> 
<span class='line'>481</span> </span><span class="WHIT">	</span><span class="NAME">_playobject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">			</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">initialize</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>488</span> 
<span class='line'>489</span> </span><span class="WHIT">	</span><span class="NAME">_nextframe</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">		</span><span class="NAME">gbox._framestart</span><span class="PUNC">=</span><span class="NAME">gbox._mspf</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">gbox._framestart</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._autoskip</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox._framestart</span><span class="PUNC">&lt;</span><span class="NAME">gbox._autoskip.lowidle</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox._frameskip</span><span class="PUNC">&lt;</span><span class="NAME">gbox._autoskip.max</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setFrameskip</span><span class="PUNC">(</span><span class="NAME">gbox._frameskip</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox._framestart</span><span class="PUNC">></span><span class="NAME">gbox._autoskip.hiidle</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox._frameskip</span><span class="PUNC">></span><span class="NAME">gbox._autoskip.min</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.setFrameskip</span><span class="PUNC">(</span><span class="NAME">gbox._frameskip</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._statbar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.debugGetstats</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">		</span><span class="NAME">this._gametimer</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox.go</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">gbox._framestart</span><span class="PUNC">&lt;=</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">gbox._framestart</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>497</span> 
<span class='line'>498</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>499</span>   * This function is called once per frame. This is where the basic rendering and processing of groups occurs.
<span class='line'>500</span>   */</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">	</span><span class="NAME">go</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.isBusy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._gamewaiting</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitFade</span><span class="PUNC">(</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">font</span><span class="PUNC">:</span><span class="STRN">"_dbf"</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="NAME">text</span><span class="PUNC">:</span><span class="STRN">"LOADING..."</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">				</span><span class="NAME">gbox._gamewaiting</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._gamewaiting</span><span class="PUNC">&lt;=</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">gbox._loaderqueue.getDone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">gbox._loaderqueue.getSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">				</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">globalAlpha</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">				</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gbox._splash.gaugeLittleBackColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">				</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fillRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">gbox.getFont</span><span class="PUNC">(</span><span class="STRN">"_dbf"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tileh</span><span class="PUNC">,</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">				</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gbox._splash.gaugeLittleColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">				</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">fillRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">4</span><span class="PUNC">+</span><span class="NAME">gbox.getFont</span><span class="PUNC">(</span><span class="STRN">"_dbf"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">tileh</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">bw</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">bw</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">				</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">				</span><span class="NAME">gbox.setStatBar</span><span class="PUNC">(</span><span class="STRN">"Loading... ("</span><span class="PUNC">+</span><span class="NAME">gbox._loaderqueue.getDone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">gbox._loaderqueue.getTotal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._gamewaiting</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._gamewaiting</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">			</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox.go</span><span class="PUNC">,</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">			</span><span class="NAME">gbox._gamewaiting</span><span class="PUNC">=</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">			</span><span class="NAME">gbox._framestart</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gr</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">&lt;</span><span class="NAME">gbox._renderorder.length</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._groupplay</span><span class="PUNC">[</span><span class="NAME">gbox._renderorder</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._renderorder</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">gbox.ZINDEX_LAYER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gbox._actionqueue.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">gbox._zindex.first</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">							</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._groupplay</span><span class="PUNC">[</span><span class="NAME">gbox._zindex.data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">									</span><span class="NAME">gbox._playobject</span><span class="PUNC">(</span><span class="NAME">gbox._zindex.data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">gbox._zindex.data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o</span><span class="PUNC">,</span><span class="NAME">gbox._actionqueue</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span> </span><span class="WHIT">								</span><span class="NAME">id</span><span class="PUNC">=</span><span class="NAME">gbox._zindex.data</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__next</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>535</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>536</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gbox._actionqueue.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">							</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">gbox._renderorder</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">								</span><span class="NAME">gbox._playobject</span><span class="PUNC">(</span><span class="NAME">gbox._renderorder</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">gbox._actionqueue</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._fskid</span><span class="PUNC">>=</span><span class="NAME">gbox._frameskip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._db</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.blitImageToScreen</span><span class="PUNC">(</span><span class="NAME">gbox.getBuffer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">				</span><span class="NAME">gbox._fskid</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox._fskid</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">			</span><span class="NAME">gbox.purgeGarbage</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>547</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._zindexch.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gbox._zindexch.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.o</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.o</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">							</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.o</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">=</span><span class="NAME">gbox._zindex.addObject</span><span class="PUNC">(</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o</span><span class="PUNC">,</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">							</span><span class="NAME">gbox._zindex.setPrio</span><span class="PUNC">(</span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">o.o</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">,</span><span class="NAME">gbox._zindexch</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">				</span><span class="NAME">gbox._zindexch</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">			</span><span class="COMM">// Handle holding</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._keymap</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">gbox._keymap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">gbox._keymap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">gbox._keymap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">gbox._keymap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">&lt;</span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="NAME">gbox._keyboard</span><span class="PUNC">[</span><span class="NAME">gbox._keymap</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._forcedidle</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">				</span><span class="NAME">this._gametimer</span><span class="PUNC">=</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._nextframe</span><span class="PUNC">,</span><span class="NAME">gbox._forcedidle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Wait for the browser</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">				</span><span class="NAME">gbox._nextframe</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>572</span>   * Displays basic audio, object, and performance statistics in the status bar. Automatically called each frame if the status bar is enabled.
<span class='line'>573</span>   */</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">	</span><span class="NAME">debugGetstats</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">statline</span><span class="PUNC">=</span><span class="STRN">"Idle: "</span><span class="PUNC">+</span><span class="NAME">gbox._framestart</span><span class="PUNC">+</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">gbox._mspf</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">gbox._frameskip</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">?</span><span class="STRN">" ("</span><span class="PUNC">+</span><span class="NAME">gbox._frameskip</span><span class="PUNC">+</span><span class="STRN">"skip)"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">" | "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>576</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">&lt;</span><span class="NAME">gbox._groups.length</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._groupplay</span><span class="PUNC">[</span><span class="NAME">gbox._groups</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">				</span><span class="NAME">cnt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._objects</span><span class="PUNC">[</span><span class="NAME">gbox._groups</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cnt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">statline</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">gbox._groups</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"["</span><span class="PUNC">+</span><span class="NAME">cnt</span><span class="PUNC">+</span><span class="STRN">"] "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cnt</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ply</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._audio.aud</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">				</span><span class="NAME">cnt</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paused</span><span class="PUNC">&&</span><span class="PUNC">!</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">ended</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ply</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">		</span><span class="NAME">statline</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"| audio: "</span><span class="PUNC">+</span><span class="NAME">ply</span><span class="PUNC">+</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">cnt</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">this._audioteam</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>592</span> 			statline+="&lt;br>&lt;br>";
<span class='line'>593</span> 		var id=gbox._zindex.first;
<span class='line'>594</span> 			while (id!=null) {
<span class='line'>595</span> 				if (gbox._groupplay[gbox._zindex.data[id].g]) statline+=gbox._zindex.data[id].g+" | "+gbox._zindex.data[id].o+" ("+gbox._zindex.data[id].__prio+")&lt;br>";
<span class='line'>596</span> 				id=gbox._zindex.data[id].__next;
<span class='line'>597</span> 			}
<span class='line'>598</span> 			*/</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">		</span><span class="NAME">gbox.setStatBar</span><span class="PUNC">(</span><span class="NAME">statline</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">	</span><span class="NAME">setZindex</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">th</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">th.__zt</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">th.zindex</span><span class="PUNC">!=</span><span class="NAME">z</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">			</span><span class="NAME">th.zindex</span><span class="PUNC">=</span><span class="NAME">z</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">			</span><span class="NAME">this._zindexch.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">o</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">g</span><span class="PUNC">:</span><span class="NAME">th.group</span><span class="PUNC">,</span><span class="NAME">o</span><span class="PUNC">:</span><span class="NAME">th.id</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">z</span><span class="PUNC">:</span><span class="NAME">z</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>608</span> 
<span class='line'>609</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>610</span>   * Returns true if a given key in this._keymap is pressed. Only returns true on the transition from unpressed to pressed.
<span class='line'>611</span>   * @param {String} id A key in the keymap. By default, one of: "up" "down" "left" "right" "a" "b" "c"
<span class='line'>612</span>   * @returns {Boolean} True if the given key is transitioning from unpressed to pressed in this frame.
<span class='line'>613</span>   */</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">	</span><span class="NAME">keyIsHit</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._keyboard</span><span class="PUNC">[</span><span class="NAME">this._keymap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>617</span>   * Returns true if a given key in this._keymap is being held down. Returns true as long as the key is held down.
<span class='line'>618</span>   * @param {String} id A key in the keymap. By default, one of: "up" "down" "left" "right" "a" "b" "c"
<span class='line'>619</span>   * @returns {Boolean} True if the given key is held down.
<span class='line'>620</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">	</span><span class="NAME">keyIsPressed</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._keyboard</span><span class="PUNC">[</span><span class="NAME">this._keymap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>622</span> 
<span class='line'>623</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>624</span>   * Returns true if a given key in this._keymap has been held down for at least one frame. Will not return true if a key
<span class='line'>625</span>   * is quickly tapped, only once it has been held down for a frame.
<span class='line'>626</span>   * @param {String} id A key in the keymap. By default, one of: "up" "down" "left" "right" "a" "b" "c"
<span class='line'>627</span>   * @returns {Boolean} True if the given key has been held down for at least one frame.
<span class='line'>628</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">	</span><span class="NAME">keyIsHold</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._keyboard</span><span class="PUNC">[</span><span class="NAME">this._keymap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>632</span>   * Returns true if a given key in this._keymap is released. Only returns true on the transition from pressed to unpressed.
<span class='line'>633</span>   * @param {String} id A key in the keymap. By default, one of: "up" "down" "left" "right" "a" "b" "c"
<span class='line'>634</span>   * @returns {Boolean} True if the given key is transitioning from pressed to unpressed in this frame.
<span class='line'>635</span>   */</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">	</span><span class="NAME">keyIsReleased</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._keyboard</span><span class="PUNC">[</span><span class="NAME">this._keymap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">	</span><span class="NAME">_savesettings</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">saved</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._keymap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">saved</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"keymap-"</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="NAME">this._keymap</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">"~"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._flags</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">saved</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">"flag-"</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">+</span><span class="STRN">":"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this._flags</span><span class="PUNC">[</span><span class="NAME">f</span><span class="PUNC">]</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"~"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">		</span><span class="NAME">this.dataSave</span><span class="PUNC">(</span><span class="STRN">"sys"</span><span class="PUNC">,</span><span class="NAME">saved</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">	</span><span class="NAME">_loadsettings</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cfg</span><span class="PUNC">=</span><span class="NAME">this.dataLoad</span><span class="PUNC">(</span><span class="STRN">"sys"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cfg</span><span class="PUNC">!==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">			</span><span class="NAME">cfg</span><span class="PUNC">=</span><span class="NAME">cfg.split</span><span class="PUNC">(</span><span class="STRN">"~"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">kv</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mk</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cfg.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">				</span><span class="NAME">kv</span><span class="PUNC">=</span><span class="NAME">cfg</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">":"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">				</span><span class="NAME">mk</span><span class="PUNC">=</span><span class="NAME">kv</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"-"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">				</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mk</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">					</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"keymap"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._keymap</span><span class="PUNC">[</span><span class="NAME">mk</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">kv</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">					</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"flag"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._flags</span><span class="PUNC">[</span><span class="NAME">mk</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">kv</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>658</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>659</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>660</span> 
<span class='line'>661</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>662</span>   * Saves data to a browser cookie as a key-value pair, which can be restored later using gbox.dataLoad. Only 
<span class='line'>663</span>   * works if user has cookies enabled.
<span class='line'>664</span>   * @param {String} k The key which identifies the value you are storing.
<span class='line'>665</span>   * @param {String} v The value you wish to store. Needs to be a string!
<span class='line'>666</span>   * @param {String} d A date offset, to be added to the current date. Defines the cookie's expiration date. By default this is set to 10 years.
<span class='line'>667</span>   * @example
<span class='line'>668</span>   * // (from Capman)
<span class='line'>669</span>   * gbox.dataSave("capman-hiscore",maingame.hud.getNumberValue("score","value"));
<span class='line'>670</span>   */</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">	</span><span class="NAME">dataSave</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">date</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">		</span><span class="NAME">date.setTime</span><span class="PUNC">(</span><span class="NAME">date.getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">?</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">365</span><span class="PUNC">*</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">24</span><span class="PUNC">*</span><span class="NUMB">60</span><span class="PUNC">*</span><span class="NUMB">60</span><span class="PUNC">*</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">		</span><span class="NAME">document.cookie</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">this._systemcookie</span><span class="PUNC">+</span><span class="STRN">"~"</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">+</span><span class="STRN">"="</span><span class="PUNC">+</span><span class="NAME">v</span><span class="PUNC">+</span><span class="STRN">"; expires="</span><span class="PUNC">+</span><span class="NAME">date.toGMTString</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"; path=/"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>678</span>   * Loads data from a browser cookie. Send it a key and it returns a value (if available). Only works if user has cookies enabled.
<span class='line'>679</span>   * @param {String} k The key which identifies the value you are loading.
<span class='line'>680</span>   * @param {String} a A switch to determine whether a string or a number is returned. By default a string is returned.
<span class='line'>681</span>   * @returns {Object} A string or a number loaded from the cookie.
<span class='line'>682</span>   * @example
<span class='line'>683</span>   * hiscore = gbox.dataLoad("hiscore");
<span class='line'>684</span>   */</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">	</span><span class="NAME">dataLoad</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nameeq</span><span class="PUNC">=</span><span class="NAME">this._systemcookie</span><span class="PUNC">+</span><span class="STRN">"~"</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">+</span><span class="STRN">"="</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ca</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.cookie.split</span><span class="PUNC">(</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">ca.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">ca</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">			</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c.charAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">' '</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">c.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">c.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c.indexOf</span><span class="PUNC">(</span><span class="NAME">nameeq</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">				</span><span class="NAME">rt</span><span class="PUNC">=</span><span class="NAME">c.substring</span><span class="PUNC">(</span><span class="NAME">nameeq.length</span><span class="PUNC">,</span><span class="NAME">c.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">&&</span><span class="NAME">a.number</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rt</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">&&</span><span class="NAME">a.number</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rt</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>700</span> 
<span class='line'>701</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>702</span>   * Clears a value stored in a  key-value pair in a browser cookie. Sets value to "". Only works if user has cookies enabled.
<span class='line'>703</span>   * @param {String} k The key which identifies the value you are clearing.
<span class='line'>704</span>   */</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">	</span><span class="NAME">dataClear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this.dataSave</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>708</span>   * Gets the current camera object.
<span class='line'>709</span>   * @returns {Object} The camera object.
<span class='line'>710</span>   */</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">	</span><span class="NAME">getCamera</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._camera</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>714</span>   * Sets the y value of the current camera object.
<span class='line'>715</span>   * @param {Integer} y The camera object's new y value.
<span class='line'>716</span>   * @param {Object} viewdata An object containing parameters h and w, which are a bounding box that the camera is
<span class='line'>717</span>   * not supposed to leave. For example, to use your map as a bounding area for the camera, pass along {w: map.w, h: map.h}.
<span class='line'>718</span>   */</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">	</span><span class="NAME">setCameraY</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">viewdata</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">		</span><span class="NAME">this._camera.y</span><span class="PUNC">=</span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._camera.y</span><span class="PUNC">+</span><span class="NAME">this._camera.h</span><span class="PUNC">></span><span class="NAME">viewdata.h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._camera.y</span><span class="PUNC">=</span><span class="NAME">viewdata.h</span><span class="PUNC">-</span><span class="NAME">this._screenh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._camera.y</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._camera.y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>724</span> 
<span class='line'>725</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>726</span>   * Sets the x value of the current camera object.
<span class='line'>727</span>   * @param {Integer} x The camera object's new x value.
<span class='line'>728</span>   * @param {Object} viewdata An object containing parameters h and w, which are a bounding box that the camera is
<span class='line'>729</span>   * not supposed to leave. For example, to use your map as a bounding area for the camera, pass along {w: map.w, h: map.h}.
<span class='line'>730</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">	</span><span class="NAME">setCameraX</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">viewdata</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">		</span><span class="NAME">this._camera.x</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._camera.x</span><span class="PUNC">+</span><span class="NAME">this._camera.w</span><span class="PUNC">></span><span class="NAME">viewdata.w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._camera.x</span><span class="PUNC">=</span><span class="NAME">viewdata.w</span><span class="PUNC">-</span><span class="NAME">this._screenw</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._camera.x</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._camera.x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>738</span>   * Centers the camera.
<span class='line'>739</span>   * @param {Object} data An object containing x and y parameters -- typically the object you wish to center the camera on.
<span class='line'>740</span>   * @param {Object} viewdata An object containing parameters h and w, which are a bounding box that the camera is
<span class='line'>741</span>   * not supposed to leave. For example, to use your map as a bounding area for the camera, pass along {w: map.w, h: map.h}.
<span class='line'>742</span>   * @example
<span class='line'>743</span>   * // Center the camera on the player object
<span class='line'>744</span>   * gbox.centerCamera(gbox.getObject('player', 'player_id'), {w: map.w, h: map.h});
<span class='line'>745</span>   */</span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">	</span><span class="NAME">centerCamera</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">,</span><span class="NAME">viewdata</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">		</span><span class="NAME">this.setCameraX</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">-</span><span class="NAME">this._screenhw</span><span class="PUNC">,</span><span class="NAME">viewdata</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">		</span><span class="NAME">this.setCameraY</span><span class="PUNC">(</span><span class="NAME">data.y</span><span class="PUNC">-</span><span class="NAME">this._screenhh</span><span class="PUNC">,</span><span class="NAME">viewdata</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>750</span> 
<span class='line'>751</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>752</span>   * Get an array containing the names of each group in the game, in order of rendering.
<span class='line'>753</span>   * @returns {Array} An array of group names.
<span class='line'>754</span>   * @example
<span class='line'>755</span>   * grouplist = gbox.getGroups();
<span class='line'>756</span>   * grouplist; // => ["background", "player", "enemy", "game"]	
<span class='line'>757</span>   */</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">  </span><span class="NAME">getGroups</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._groups</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>761</span>   * Defines the names of each group in the game along with their rendering order.
<span class='line'>762</span>   * @param {Array} g An array of strings of group names, in the order in which the groups should be rendered. So
<span class='line'>763</span>   * g[0] will contain the first group to render, g[1] the second group to render, etc.
<span class='line'>764</span>   */</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">	</span><span class="NAME">setGroups</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">		</span><span class="NAME">this._groups</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">		</span><span class="NAME">this._groupplay</span><span class="PUNC">[</span><span class="NAME">gbox.ZINDEX_LAYER</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">g.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">				</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">				</span><span class="NAME">this._groupplay</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">				</span><span class="NAME">this._renderorder</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>777</span>   * A method of setting the render order of groups independently of gbox.setGroups. Sets gbox._renderorder, 
<span class='line'>778</span>   * which by default is equivalent to gbox._groups. However, gbox._renderorder is what ultimately determines
<span class='line'>779</span>   * the rendering order of groups. If you need to change your rendering order on the fly, use this function 
<span class='line'>780</span>   * by passing it a reordered array of group names.
<span class='line'>781</span>   * @param {Array} g An array of strings of group names, in the order in which the groups should be rendered. So
<span class='line'>782</span>   * g[0] will contain the first group to render, g[1] the second group to render, etc.
<span class='line'>783</span>   */</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">	</span><span class="NAME">setRenderOrder</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._renderorder</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>787</span>   * If a group is disabled, this will enable the group.
<span class='line'>788</span>   * @param {String} gid The id of the group.
<span class='line'>789</span>   */</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">	</span><span class="NAME">playGroup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._groupplay</span><span class="PUNC">[</span><span class="NAME">gid</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>791</span> 
<span class='line'>792</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>793</span>   * If a group is enabled, this will disable the group.
<span class='line'>794</span>   * @param {String} gid The id of the group.
<span class='line'>795</span>   */</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">	</span><span class="NAME">stopGroup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._groupplay</span><span class="PUNC">[</span><span class="NAME">gid</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>799</span>   * Toggles a group between enabled and disabled status.
<span class='line'>800</span>   * @param {String} gid The id of the group.
<span class='line'>801</span>   */</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">	</span><span class="NAME">toggleGroup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this._groupplay</span><span class="PUNC">[</span><span class="NAME">gid</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">this._groupplay</span><span class="PUNC">[</span><span class="NAME">gid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>805</span>   * Turns off all groups except for the one specified. 
<span class='line'>806</span>   * @param {String} gid The id of the group.
<span class='line'>807</span>   */</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">	</span><span class="NAME">soloGroup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this._groups.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._groups</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.playGroup</span><span class="PUNC">(</span><span class="NAME">this._groups</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.stopGroup</span><span class="PUNC">(</span><span class="NAME">this._groups</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>814</span>   * Enables all groups, toggling any groups that are currently disabled.
<span class='line'>815</span>   */</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">	</span><span class="NAME">playAllGroups</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this._groups.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.playGroup</span><span class="PUNC">(</span><span class="NAME">this._groups</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>817</span> 
<span class='line'>818</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>819</span>   * Destroys all objects in a given group.
<span class='line'>820</span>   * @param {String} gid The id of the group.
<span class='line'>821</span>   */</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">	</span><span class="NAME">clearGroup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">group</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._zindex.remove</span><span class="PUNC">(</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">	</span><span class="NAME">playGroups</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gid.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">this.playGroup</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">	</span><span class="NAME">stopGroups</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gid.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">this.stopGroup</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">	</span><span class="NAME">toggleGroups</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gid.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">this.toggleGroup</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>833</span>   * Given a group and an id for a particular object instance, this returns the instance requested.
<span class='line'>834</span>   * &lt;b>NOTE:&lt;/b> this does not return a copy of the object you've requested! Any modifications you make
<span class='line'>835</span>   * to the object returned are directly modifying the object you requested.
<span class='line'>836</span>   * @param {String} group The id of the group that contains the object.
<span class='line'>837</span>   * @param {String} id The id of the instance of the object.
<span class='line'>838</span>   * @returns {Object} The object requested.
<span class='line'>839</span>   * @example
<span class='line'>840</span>   * // Find the player and reduce health by half.
<span class='line'>841</span>   * playertemp = gbox.getObject('player','player_id');
<span class='line'>842</span>   * player.health = player.health/2;
<span class='line'>843</span>   */</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">	</span><span class="NAME">getObject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">group</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>845</span> 
<span class='line'>846</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>847</span>   * Creates a font.
<span class='line'>848</span>   * @param {Object} data An object containing: &lt;ul>&lt;li>id: the id of the font&lt;/li>
<span class='line'>849</span>   * &lt;li>image: reference to the font image loaded (must contain font character tiles in ASCII order)&lt;/li>
<span class='line'>850</span>   * &lt;li>firstletter: the ASCII character that the font image's first character corresponds to&lt;/li>
<span class='line'>851</span>   * &lt;li>tileh: height in pixels of the character tiles&lt;/li>
<span class='line'>852</span>   * &lt;li>tilew: width in pixels of the character tiles&lt;/li>
<span class='line'>853</span>   * &lt;li>tilerow: width in pixels of each row in the font image&lt;/li>
<span class='line'>854</span>   * &lt;li>gapx: x-coord gap between tile columns, in pixels&lt;/li>
<span class='line'>855</span>   * &lt;li>gapy: y-coord gap between tile rows, in pixels&lt;/li>&lt;/ul>
<span class='line'>856</span>   * @example
<span class='line'>857</span>   * gbox.addImage('font', 'font.png');
<span class='line'>858</span>   * gbox.addFont({ id: 'small', image: 'font', firstletter: ' ', tileh: 8, tilew: 8, tilerow: 255, gapx: 0, gapy: 0 });
<span class='line'>859</span>   */</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">	</span><span class="NAME">addFont</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">		</span><span class="NAME">data.tilehh</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">data.tileh</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">		</span><span class="NAME">data.tilehw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">data.tilew</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">		</span><span class="NAME">this._fonts</span><span class="PUNC">[</span><span class="NAME">data.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">		</span><span class="NAME">this._fonts</span><span class="PUNC">[</span><span class="NAME">data.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">firstascii</span><span class="PUNC">=</span><span class="NAME">data.firstletter.charCodeAt</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>868</span>   * Returns a font object containing data about the font.
<span class='line'>869</span>   * @param {String} id The id of the font, as set in gbox.addFont.
<span class='line'>870</span>   */</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">	</span><span class="NAME">getFont</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._fonts</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>874</span> 
<span class='line'>875</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>876</span>   * Deletes an object, keeping a record of its group and id in gbox._garbage.
<span class='line'>877</span>   * @param {Object} obj The object you wish to delete.
<span class='line'>878</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">	</span><span class="NAME">trashObject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">obj.group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">obj.group</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">		</span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">obj.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">		</span><span class="NAME">obj.__trashing</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>886</span>   * Clears the record held in gbox._garbage of what has been deleted.
<span class='line'>887</span>   * @param {Object} obj The object you wish to delete.
<span class='line'>888</span>   */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">	</span><span class="NAME">purgeGarbage</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">group</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._garbage</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>891</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">					</span><span class="NAME">this._zindex.remove</span><span class="PUNC">(</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">__zt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">		</span><span class="NAME">gbox._garbage</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>900</span>   * Deletes every object in a given group.
<span class='line'>901</span>   * @param {String} group The group id.
<span class='line'>902</span>   */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">	</span><span class="NAME">trashGroup</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">group</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">			</span><span class="NAME">this._garbage</span><span class="PUNC">[</span><span class="NAME">group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">obj</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>910</span>   * Returns whether an object is due to be trashed. Useful in cases you want to check if
<span class='line'>911</span>   * an object is marked as trash before it is actually deleted.
<span class='line'>912</span>   * @param {Object} o The object you're checking.
<span class='line'>913</span>   * @returns {Boolean} True if the object is marked as trash.
<span class='line'>914</span>   */</span><span class="WHIT">      </span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">	</span><span class="NAME">objectIsTrash</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o.__trashing</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>918</span>   * Creates a new game object. Generally speaking you pass a fully-defined object as the parameter (including a group, id, tileset, and so on).
<span class='line'>919</span>   * A group must be specified, or the program will crash. If no id is specified, then it will automatically provide 
<span class='line'>920</span>   * an id of 'obj-XXXX' where 'XXXX' is an automatically incrementing integer. This is where the &lt;i>initialize&lt;/i>, &lt;i>first&lt;/i>, and &lt;i>blit&lt;/i>
<span class='line'>921</span>   * functions are defined, as well.
<span class='line'>922</span>   * @param {Object} data The object you wish to create.
<span class='line'>923</span>   * @returns {Object} The object you created.
<span class='line'>924</span>   * @example
<span class='line'>925</span>   * data = {
<span class='line'>926</span>   *   group: 'player',
<span class='line'>927</span>   *   id: 'player_id',
<span class='line'>928</span>   *   tileset: 'player_tiles', 
<span class='line'>929</span>   *   x: 0,
<span class='line'>930</span>   *   y: 0,
<span class='line'>931</span>   *   initialize: function() {
<span class='line'>932</span>       this.x = 10;
<span class='line'>933</span>       this.y = 10;
<span class='line'>934</span>       },
<span class='line'>935</span>   * };
<span class='line'>936</span>   * gbox.addObject(data);
<span class='line'>937</span>   */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">	</span><span class="NAME">addObject</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">		</span><span class="COMM">// Extras</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">data.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">			</span><span class="NAME">data.id</span><span class="PUNC">=</span><span class="STRN">"obj-"</span><span class="PUNC">+</span><span class="NAME">this._autoid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">			</span><span class="NAME">this._autoid</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._autoid</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NUMB">1000</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.tileset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data.h</span><span class="PUNC">=</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">data.tileset</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data.w</span><span class="PUNC">=</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">data.tileset</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tilew</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.hw</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data.hw</span><span class="PUNC">=</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">data.tileset</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tilehw</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.hh</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data.hh</span><span class="PUNC">=</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">data.tileset</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tilehh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">		</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">data.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.zindex</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">			</span><span class="NAME">this.setZindex</span><span class="PUNC">(</span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">data.id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">data.zindex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">data.group</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">data.id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>957</span>   * Returns whether a given group contains no objets.
<span class='line'>958</span>   * @param {String} gid The group you're checking.
<span class='line'>959</span>   * @returns {Boolean} True if the group contains no objects.
<span class='line'>960</span>   */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">	</span><span class="NAME">groupIsEmpty</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._objects</span><span class="PUNC">[</span><span class="NAME">gid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>964</span>   * Creates a new canvas. By default, the width and height is the current gbox._screenw and gbox._screenh,
<span class='line'>965</span>   * but it can also be set by passing in a data object with the appropriate parameters.
<span class='line'>966</span>   * @param {String} id The id of the new canvas.
<span class='line'>967</span>   * @param {Object} data (Optional) The height and width of the new canvas, contained in data.h and data.w parameters.
<span class='line'>968</span>   * @example
<span class='line'>969</span>   * gbox.createCanvas('newCanvas', {w: 640, h: 480});
<span class='line'>970</span>   */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">	</span><span class="NAME">createCanvas</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteCanvas</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">		</span><span class="NAME">this._canvas</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">		</span><span class="NAME">this._canvas</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">'height'</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">&&</span><span class="NAME">data.h</span><span class="PUNC">?</span><span class="NAME">data.h</span><span class="PUNC">:</span><span class="NAME">this._screenh</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">		</span><span class="NAME">this._canvas</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">'width'</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">&&</span><span class="NAME">data.w</span><span class="PUNC">?</span><span class="NAME">data.w</span><span class="PUNC">:</span><span class="NAME">this._screenw</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>979</span>   * Deletes a given canvas.
<span class='line'>980</span>   * @param {String} id The id of the canvas to be deleted.
<span class='line'>981</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">	</span><span class="NAME">deleteCanvas</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canvas</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._canvas</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>987</span>   * Checks to see if an image was successfully loaded.
<span class='line'>988</span>   * @param {String} id The id of the image.
<span class='line'>989</span>   * @returns {Boolean} True if the image has been loaded.
<span class='line'>990</span>   */</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">	</span><span class="NAME">imageIsLoaded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"wasloaded"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>994</span>   * Gets information about a loaded image.
<span class='line'>995</span>   * @param {String} id The id of the image.
<span class='line'>996</span>   * @returns {Object} A DOM Image element, including the URL and last modified date of the image, its ID, and whether it was loaded successfully.
<span class='line'>997</span>   * @example
<span class='line'>998</span>   * image = gbox.getImage('logo');
<span class='line'>999</span>   * image; // => &lt;img src=?"logo.png?_brc=5-7-2010-15-48-42" src_org=?"logo.png" id=?"logo" wasloaded=?"true">?
<span class='line'>1000</span>   */</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">	</span><span class="NAME">getImage</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1004</span>   * Gets the buffer canvas (automatically created by gbox.initScreen).
<span class='line'>1005</span>   * @returns {Object} A DOM Canvas element, including the width and height of the canvas.
<span class='line'>1006</span>   */</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">	</span><span class="NAME">getBuffer</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getCanvas</span><span class="PUNC">(</span><span class="STRN">"_buffer"</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1008</span> 
<span class='line'>1009</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1010</span>   * Gets the buffer canvas context.
<span class='line'>1011</span>   * @returns {Object} A DOM Canvas context object.
<span class='line'>1012</span>   */</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">	</span><span class="NAME">getBufferContext</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._fskid</span><span class="PUNC">>=</span><span class="NAME">gbox._frameskip</span><span class="PUNC">?</span><span class="PUNC">(</span><span class="NAME">this._db</span><span class="PUNC">?</span><span class="NAME">this.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"_buffer"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1016</span>   * Gets a given canvas.
<span class='line'>1017</span>   * @param {Object} id The identifier of the canvas.
<span class='line'>1018</span>   * @returns {Object} A DOM Canvas element, including the width and height of the canvas.
<span class='line'>1019</span>   */</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">	</span><span class="NAME">getCanvas</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._canvas</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1023</span>   * Gets the two-dimensional canvas context of a given canvas. The object it returns contains all the drawing functions for the canvas.
<span class='line'>1024</span>   * See &lt;a href = "http://dev.w3.org/html5/spec/Overview.html#the-canvas-element">W3C&lt;/a> and
<span class='line'>1025</span>   * &lt;a href = "https://developer.mozilla.org/en/canvas_tutorial/basic_usage">Mozilla Developer Center&lt;/a> for details.
<span class='line'>1026</span>   * @param {Object} id The identifier of the canvas.
<span class='line'>1027</span>   * @returns {Object} A DOM Canvas context object.
<span class='line'>1028</span>   */</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">	</span><span class="NAME">getCanvasContext</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getCanvas</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1032</span>   * Adds an image file to the loader, assigning it to an ID. If adding an image to an existing ID, it checks to see if the file you're
<span class='line'>1033</span>   * adding is different than the one currently assigned to the ID. If it's different, it overwrites the old image. If it's the same, then
<span class='line'>1034</span>   * no action is taken.
<span class='line'>1035</span>   * @param {String} id The identifier of the image.
<span class='line'>1036</span>   * @param {String} filename The file name of the image.
<span class='line'>1037</span>   */</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">	</span><span class="NAME">addImage</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">filename</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"src_org"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NAME">filename</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">		</span><span class="NAME">this._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"image"</span><span class="PUNC">,</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">filename</span><span class="PUNC">:</span><span class="NAME">filename</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1048</span>   * Deletes an image currently in use. Does not delete the image file, but removes it from Akihabara's image list.
<span class='line'>1049</span>   * @param {String} id The identifier of the image.
<span class='line'>1050</span>   */</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">	</span><span class="NAME">deleteImage</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">this._images</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1056</span>   * Creates a new Akihabara tileset, adding it to the engine.
<span class='line'>1057</span>   * @param {Object} t An object containing: &lt;ul>&lt;li>id {String}: the new id of the tileset&lt;/li>
<span class='line'>1058</span>   * &lt;li>image {String}: reference to the tileset image loaded&lt;/li>
<span class='line'>1059</span>   * &lt;li>tileh {Integer}: height in pixels of the tiles&lt;/li>
<span class='line'>1060</span>   * &lt;li>tilew {Integer}: width in pixels of the tiles&lt;/li>
<span class='line'>1061</span>   * &lt;li>tilerow {Integer}: width in pixels of each row in the font image&lt;/li>
<span class='line'>1062</span>   * &lt;li>gapx {Integer}: x-coord gap between tile columns, in pixels&lt;/li>
<span class='line'>1063</span>   * &lt;li>gapy {Integer}: y-coord gap between tile rows, in pixels&lt;/li>&lt;/ul>
<span class='line'>1064</span>   */</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="WHIT">	</span><span class="NAME">addTiles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1066</span> </span><span class="WHIT">		</span><span class="NAME">t.tilehh</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">t.tileh</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1067</span> </span><span class="WHIT">		</span><span class="NAME">t.tilehw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">t.tilew</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">		</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">t.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">t</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1070</span> 
<span class='line'>1071</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1072</span>   * Gets an Akihabara tileset, adding it to the engine.
<span class='line'>1073</span>   * @param {String} t The ID of a tileset.
<span class='line'>1074</span>   * @returns An object containing: &lt;ul>&lt;li>id {String}: the new id of the tileset&lt;/li>
<span class='line'>1075</span>   * &lt;li>image {String}: reference to the tileset image loaded&lt;/li>
<span class='line'>1076</span>   * &lt;li>tileh {Integer}: height in pixels of the tiles&lt;/li>
<span class='line'>1077</span>   * &lt;li>tilew {Integer}: width in pixels of the tiles&lt;/li>
<span class='line'>1078</span>   * &lt;li>tilerow {Integer}: width in pixels of each row in the font image&lt;/li>
<span class='line'>1079</span>   * &lt;li>gapx {Integer}: x-coord gap between tile columns, in pixels&lt;/li>
<span class='line'>1080</span>   * &lt;li>gapy {Integer}: y-coord gap between tile rows, in pixels&lt;/li>&lt;/ul>
<span class='line'>1081</span>   */</span><span class="WHIT">
<span class='line'>1082</span> </span><span class="WHIT">	</span><span class="NAME">getTiles</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">t</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1083</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1085</span>   * Loads the initial splash screen and debugging font, then calls gbox._waitforloaded which adds to the game all the previously
<span class='line'>1086</span>   * defined resources. Once gbox._waitforloaded is done, it calls the callback function cb.
<span class='line'>1087</span>   * @params {String} cb The name of the function to be called when all assets are done loading.
<span class='line'>1088</span>   */</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">	</span><span class="NAME">loadAll</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">		</span><span class="COMM">// Setup logger</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canlog</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.log</span><span class="PUNC">=</span><span class="NAME">console.log</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">		</span><span class="COMM">// Set the callback function, which is called after the resources are loaded.</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._cb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._cb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">		</span><span class="COMM">// Default stuff</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">		</span><span class="NAME">this.addImage</span><span class="PUNC">(</span><span class="STRN">"_dbf"</span><span class="PUNC">,</span><span class="STRN">"akihabara/debugfont.png"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._splash.background</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.addImage</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">,</span><span class="NAME">this._splash.background</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">		</span><span class="NAME">gbox.addFont</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="STRN">"_dbf"</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">:</span><span class="STRN">"_dbf"</span><span class="PUNC">,</span><span class="NAME">firstletter</span><span class="PUNC">:</span><span class="STRN">" "</span><span class="PUNC">,</span><span class="NAME">tileh</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">tilew</span><span class="PUNC">:</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NAME">tilerow</span><span class="PUNC">:</span><span class="NUMB">16</span><span class="PUNC">,</span><span class="NAME">gapx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">gapy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._splash.minimalTime</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">			</span><span class="NAME">gbox._minimalexpired</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">		</span><span class="NAME">this._waitforloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">	</span><span class="NAME">_implicitsargs</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.camera</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">			</span><span class="NAME">data.dx</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">this._camera.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">			</span><span class="NAME">data.dy</span><span class="PUNC">-</span><span class="PUNC">=</span><span class="NAME">this._camera.y</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.sourcecamera</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">			</span><span class="NAME">data.x</span><span class="PUNC">=</span><span class="NAME">this._camera.x</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.parallaxx</span><span class="PUNC">?</span><span class="NAME">data.parallaxx</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">			</span><span class="NAME">data.y</span><span class="PUNC">=</span><span class="NAME">this._camera.y</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.parallaxy</span><span class="PUNC">?</span><span class="NAME">data.parallaxy</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1115</span>   * Draws a tile to a canvas context
<span class='line'>1116</span>   * @param {Object} tox The canvas context to be drawn on.
<span class='line'>1117</span>   * @param {Object} data An object containing data about the tile to be drawn, including:
<span class='line'>1118</span>   * &lt;ul>&lt;li>tileset {String}: the id of the tileset&lt;/li>
<span class='line'>1119</span>   * &lt;li>tile {Integer}: the index of the tile within the tileset to be drawn&lt;/li>
<span class='line'>1120</span>   * &lt;li>dx {Integer}: x coordinate to draw the tile at&lt;/li>
<span class='line'>1121</span>   * &lt;li>dy {Integer}: y coordinate to draw the tile at&lt;/li>
<span class='line'>1122</span>   * &lt;li>fliph {Integer}: horizontal flip, either 1 or -1&lt;/li>
<span class='line'>1123</span>   * &lt;li>flipv {Integer}: vertical flip, either 1 or -1&lt;/li>
<span class='line'>1124</span>   * &lt;li>alpha {Float}: alpha value (0 is transparent, 1 is opaque)&lt;/li>&lt;/ul>
<span class='line'>1125</span>   * @example
<span class='line'>1126</span>   * // from capman, draws an current object's tile, called from inside its blit function
<span class='line'>1127</span>   * gbox.blitTile(gbox.getBufferContext(),{tileset:this.tileset,tile:this.frame,dx:this.x,dy:this.y,fliph:this.fliph,flipv:this.flipv,camera:this.camera,alpha:1});
<span class='line'>1128</span>   */</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">	</span><span class="NAME">blitTile</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">data.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">=</span><span class="NAME">this.getImage</span><span class="PUNC">(</span><span class="NAME">ts.image</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">		</span><span class="NAME">this._implicitsargs</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">		</span><span class="NAME">tox.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">		</span><span class="NAME">tox.globalAlpha</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.alpha</span><span class="PUNC">?</span><span class="NAME">data.alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">		</span><span class="NAME">tox.translate</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="NAME">ts.tilew</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="NAME">ts.tileh</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tox.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">		</span><span class="NAME">this._safedrawimage</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">img</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ts.gapx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">ts.tilew</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.tile</span><span class="PUNC">%</span><span class="NAME">ts.tilerow</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">ts.gapy</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">ts.tileh</span><span class="PUNC">*</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">data.tile</span><span class="PUNC">/</span><span class="NAME">ts.tilerow</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">ts.tilew</span><span class="PUNC">:</span><span class="NAME">data.w</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">ts.tileh</span><span class="PUNC">:</span><span class="NAME">data.h</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.dx</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.dy</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">?</span><span class="NAME">data.w</span><span class="PUNC">:</span><span class="NAME">ts.tilew</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">?</span><span class="NAME">data.h</span><span class="PUNC">:</span><span class="NAME">ts.tileh</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">		</span><span class="NAME">tox.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1140</span> 
<span class='line'>1141</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1142</span>   * Draws an image to a canvas context
<span class='line'>1143</span>   * @param {Object} tox The canvas context to be drawn on.
<span class='line'>1144</span>   * @param {Object} image The image to draw. Must be a DOM Image element, typicallly accessed via gbox.getImage
<span class='line'>1145</span>   * @param {Object} data An object containing data about the tile to be drawn, including:
<span class='line'>1146</span>   * &lt;ul>&lt;li>dx {Integer}: (required) x coordinate to draw the image at&lt;/li>
<span class='line'>1147</span>   * &lt;li>dy {Integer}: (required) y coordinate to draw the image at&lt;/li>
<span class='line'>1148</span>   * &lt;li>fliph {Integer}: horizontal flip, either 1 or -1&lt;/li>
<span class='line'>1149</span>   * &lt;li>flipv {Integer}: vertical flip, either 1 or -1&lt;/li>
<span class='line'>1150</span>   * &lt;li>alpha {Float}: alpha value (0 is transparent, 1 is opaque)&lt;/li>&lt;/ul>
<span class='line'>1151</span>   * @example
<span class='line'>1152</span>   * // draw an image at (100,100)
<span class='line'>1153</span>   * gbox.blitAll(gbox.getBufferContext(),gbox.getImage("image_id"),{dx:100,dy:100});
<span class='line'>1154</span>   */</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">	</span><span class="NAME">blitAll</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">		</span><span class="NAME">this._implicitsargs</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">		</span><span class="NAME">tox.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">		</span><span class="NAME">tox.globalAlpha</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.alpha</span><span class="PUNC">?</span><span class="NAME">data.alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">		</span><span class="NAME">tox.translate</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="NAME">image.width</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="NAME">image.height</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tox.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">		</span><span class="NAME">this._safedrawimage</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">image.width</span><span class="PUNC">,</span><span class="NAME">image.height</span><span class="PUNC">,</span><span class="NAME">data.dx</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.dy</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">image.width</span><span class="PUNC">,</span><span class="NAME">image.height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">		</span><span class="NAME">tox.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">	</span><span class="NAME">blit</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">		</span><span class="NAME">this._implicitsargs</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">		</span><span class="NAME">tox.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">		</span><span class="NAME">tox.globalAlpha</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.alpha</span><span class="PUNC">?</span><span class="NAME">data.alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">		</span><span class="NAME">tox.translate</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="NAME">data.dw</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="NAME">data.dh</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">tox.scale</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">		</span><span class="NAME">this._safedrawimage</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">image</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">?</span><span class="NAME">data.x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.y</span><span class="PUNC">?</span><span class="NAME">data.y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">?</span><span class="NAME">data.w</span><span class="PUNC">:</span><span class="NAME">data.dw</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">?</span><span class="NAME">data.h</span><span class="PUNC">:</span><span class="NAME">data.dh</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.dx</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.fliph</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.dy</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">data.flipv</span><span class="PUNC">?</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">data.dw</span><span class="PUNC">,</span><span class="NAME">data.dh</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">		</span><span class="NAME">tox.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1177</span>   * Draws a tilemap to a canvas context
<span class='line'>1178</span>   * @param {Object} tox The canvas context to be drawn on.
<span class='line'>1179</span>   * @param {Object} data An object containing a set of tilemap data, including:
<span class='line'>1180</span>   * &lt;ul>&lt;li>tileset {String}: (required) the id of the tileset the tilemap is based on&lt;/li>
<span class='line'>1181</span>   * &lt;li>map {Array}: an array whose x and y coord represent the tilemap coordinates, containing integers that correspond to the index of a given tile (or null for no tile)&lt;/li>&lt;/ul>
<span class='line'>1182</span>   */</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">	</span><span class="NAME">blitTilemap</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ts</span><span class="PUNC">=</span><span class="NAME">this._tiles</span><span class="PUNC">[</span><span class="NAME">data.tileset</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">data.map.length</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">&lt;</span><span class="NAME">data.map</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="NAME">x</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.map</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.blitTile</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">tileset</span><span class="PUNC">:</span><span class="NAME">data.tileset</span><span class="PUNC">,</span><span class="NAME">tile</span><span class="PUNC">:</span><span class="NAME">data.map</span><span class="PUNC">[</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">ts.tilew</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1193</span>   * Draws text to a canvas context
<span class='line'>1194</span>   * @param {Object} tox The canvas context to be drawn on.
<span class='line'>1195</span>   * @param {Object} data An object containing a set of data, including:
<span class='line'>1196</span>   * &lt;ul>&lt;li>font {String}: (required) the id of font to draw the text with&lt;/li>
<span class='line'>1197</span>   * &lt;li>text {String}: (required) the text to display&lt;/li>
<span class='line'>1198</span>   * &lt;li>dx {Integer}: (required) the x coordinate to draw the text at&lt;/li>
<span class='line'>1199</span>   * &lt;li>dy {Integer}: (required) the y coordinate to draw the text at&lt;/li>
<span class='line'>1200</span>   * &lt;li>dw {Integer}: the width of the text area -- required if you define data.halign&lt;/li>
<span class='line'>1201</span>   * &lt;li>dh {Integer}: the height of the text area -- required if you define data.valign&lt;/li>
<span class='line'>1202</span>   * &lt;li>valign {Integer}: either gbox.ALIGN_BOTTOM (aligns from the bottom of the text area) or gbox.ALIGN_MIDDLE (vertically centers text in text area)&lt;/li>
<span class='line'>1203</span>   * &lt;li>halign {Integer}: either gbox.ALIGN_RIGHT (aligns to the right hand side of text area) or gbox.ALIGN_CENTER (horizontallly centers text in text area)&lt;/li>
<span class='line'>1204</span>   * &lt;li>alpha {Float}: alpha value (0 is transparent, 1 is opaque)&lt;/li>&lt;/ul>
<span class='line'>1205</span>   */</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">	</span><span class="NAME">blitText</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">		</span><span class="NAME">data.text</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Convert to string.</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">=</span><span class="NAME">this._fonts</span><span class="PUNC">[</span><span class="NAME">data.font</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">		</span><span class="NAME">this._implicitsargs</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">=</span><span class="NAME">data.dx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">=</span><span class="NAME">data.dy</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.valign</span><span class="PUNC">==</span><span class="NAME">gbox.ALIGN_BOTTOM</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">+</span><span class="NAME">data.dh</span><span class="PUNC">-</span><span class="NAME">fn.tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.valign</span><span class="PUNC">==</span><span class="NAME">gbox.ALIGN_MIDDLE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">+</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">data.dh</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">fn.tileh</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.halign</span><span class="PUNC">==</span><span class="NAME">gbox.ALIGN_RIGHT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">+</span><span class="NAME">data.dw</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">data.text.length</span><span class="PUNC">*</span><span class="NAME">fn.tilew</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.halign</span><span class="PUNC">==</span><span class="NAME">gbox.ALIGN_CENTER</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">+</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">data.dw</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">data.text.length</span><span class="PUNC">*</span><span class="NAME">fn.tilew</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">		</span><span class="NAME">tox.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">		</span><span class="NAME">tox.globalAlpha</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.alpha</span><span class="PUNC">?</span><span class="NAME">data.alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">&lt;</span><span class="NAME">data.text.length</span><span class="PUNC">;</span><span class="NAME">y</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">			</span><span class="NAME">tile</span><span class="PUNC">=</span><span class="NAME">data.text.charCodeAt</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">fn.firstascii</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.clear</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">tox.clearRect</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">fn.tilew</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">?</span><span class="NAME">data.w</span><span class="PUNC">:</span><span class="NAME">fn.tilew</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">?</span><span class="NAME">data.h</span><span class="PUNC">:</span><span class="NAME">fn.tileh</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">				</span><span class="NAME">this._safedrawimage</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">this.getImage</span><span class="PUNC">(</span><span class="NAME">fn.image</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn.gapx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">fn.tilew</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">%</span><span class="NAME">fn.tilerow</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">				</span><span class="NAME">fn.gapy</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">fn.tileh</span><span class="PUNC">*</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">tile</span><span class="PUNC">/</span><span class="NAME">fn.tilerow</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">fn.tilew</span><span class="PUNC">,</span><span class="NAME">fn.tileh</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">fn.tilew</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">?</span><span class="NAME">data.w</span><span class="PUNC">:</span><span class="NAME">fn.tilew</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">?</span><span class="NAME">data.h</span><span class="PUNC">:</span><span class="NAME">fn.tileh</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">		</span><span class="NAME">tox.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1230</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1232</span>   * Clears a rectangular area of a canvas context.
<span class='line'>1233</span>   * @param {Object} image The canvas context to be drawn on.
<span class='line'>1234</span>   * @param {Object} data An object containing a set of data, including:
<span class='line'>1235</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the top-left corner of the rectangle&lt;/li>
<span class='line'>1236</span>   * &lt;li>y {Integer}: (required) the y coordinate of the top-left corner of the rectangle&lt;/li>
<span class='line'>1237</span>   * &lt;li>w {Integer}: the width of the box; defaults to canvas width&lt;/li>
<span class='line'>1238</span>   * &lt;li>h {Integer}: the height the box; defaults to canvas height&lt;/li>&lt;/ul>
<span class='line'>1239</span>   */</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">	</span><span class="NAME">blitClear</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">		</span><span class="NAME">this._implicitsargs</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">		</span><span class="NAME">image.clearRect</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">data.y</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.w</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">image.canvas.width</span><span class="PUNC">:</span><span class="NAME">data.w</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">data.h</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">image.canvas.height</span><span class="PUNC">:</span><span class="NAME">data.h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1248</span>   * Draws an image directly to the screen's current canvas context. Used internally in gbox.go(). Probably shouldn't be used otherwise.
<span class='line'>1249</span>   */</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">	</span><span class="NAME">blitImageToScreen</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">		</span><span class="NAME">this._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">drawImage</span><span class="PUNC">(</span><span class="NAME">image</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">   </span><span class="COMM">/**
<span class='line'>1255</span>   * Draws a filled rectangle over an entire canvas context.
<span class='line'>1256</span>   * @param {Object} tox The canvas context to be filled.
<span class='line'>1257</span>   * @param {Object} data An object containing a set of data, including:
<span class='line'>1258</span>   * &lt;ul>&lt;li>alpha {Float}: the alpha value of the rectangle; defaults to 1&lt;/li>
<span class='line'>1259</span>   * &lt;li>color {Object}: the color of the box, formatted rgb(rValue, gValue, bValue); default black&lt;/li>&lt;/ul>
<span class='line'>1260</span>   */</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">	</span><span class="NAME">blitFade</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.blitRect</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">tox.canvas.width</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">tox.canvas.height</span><span class="PUNC">,</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NAME">data.alpha</span><span class="PUNC">,</span><span class="NAME">color</span><span class="PUNC">:</span><span class="NAME">data.color</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1266</span>   * Draws a filled rectangle to a canvas context.
<span class='line'>1267</span>   * @param {Object} tox The canvas context to be drawn on.
<span class='line'>1268</span>   * @param {Object} data An object containing a set of data, including:
<span class='line'>1269</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the top-left corner of the rectangle&lt;/li>
<span class='line'>1270</span>   * &lt;li>y {Integer}: (required) the y coordinate of the top-left corner of the rectangle&lt;/li>
<span class='line'>1271</span>   * &lt;li>w {Integer}: (required) the width of the box&lt;/li>
<span class='line'>1272</span>   * &lt;li>h {Integer}: (required) the height the box&lt;/li>
<span class='line'>1273</span>   * &lt;li>alpha {Float}: the alpha value of the rectangle; defaults to 1&lt;/li>
<span class='line'>1274</span>   * &lt;li>color {Object}: the color of the box, formatted rgb(rValue, gValue, bValue); default black&lt;/li>&lt;/ul>
<span class='line'>1275</span>   */</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">	</span><span class="NAME">blitRect</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">		</span><span class="NAME">tox.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">		</span><span class="NAME">tox.globalAlpha</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">data.alpha</span><span class="PUNC">?</span><span class="NAME">data.alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">		</span><span class="NAME">tox.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data.color</span><span class="PUNC">?</span><span class="NAME">data.color</span><span class="PUNC">:</span><span class="NAME">gbox.COLOR_BLACK</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">		</span><span class="NAME">tox.fillRect</span><span class="PUNC">(</span><span class="NAME">data.x</span><span class="PUNC">,</span><span class="NAME">data.y</span><span class="PUNC">,</span><span class="NAME">data.w</span><span class="PUNC">,</span><span class="NAME">data.h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">		</span><span class="NAME">tox.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1286</span>   * Calculates a box collision between two collision boxes within a given tolerance. A higher tolerance means less precise collision.
<span class='line'>1287</span>   * @param {Object} o1 A collision box you're testing for collision. Must contain:
<span class='line'>1288</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1289</span>   * &lt;li>y {Integer}: (required) the y coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1290</span>   * &lt;li>w {Integer}: (required) the width of the box&lt;/li>
<span class='line'>1291</span>   * &lt;li>h {Integer}: (required) the height the box&lt;/li>&lt;/ul>
<span class='line'>1292</span>   * @param {Object} o2 A collision box you're testing for collision. Must contain:
<span class='line'>1293</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1294</span>   * &lt;li>y {Integer}: (required) the y coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1295</span>   * &lt;li>w {Integer}: (required) the width of the box&lt;/li>
<span class='line'>1296</span>   * &lt;li>h {Integer}: (required) the height the box&lt;/li>&lt;/ul>
<span class='line'>1297</span>   * @param {Integer} t The tolerance for the collision, in pixels. A value of 0 means pixel-perfect box collision. A value of 2 would mean that the
<span class='line'>1298</span>   * boxes could overlap by up to 2 pixels without being considered a collision.
<span class='line'>1299</span>   * @returns True if the two collision boxes are colliding within the given tolerance.
<span class='line'>1300</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">	</span><span class="NAME">collides</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="NAME">o2</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">o1.y</span><span class="PUNC">+</span><span class="NAME">o1.h</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">&lt;</span><span class="NAME">o2.y</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1.y</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">o2.y</span><span class="PUNC">+</span><span class="NAME">o2.h</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1.x</span><span class="PUNC">+</span><span class="NAME">o1.w</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">&lt;</span><span class="NAME">o2.x</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1.x</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">></span><span class="NAME">o2.x</span><span class="PUNC">+</span><span class="NAME">o2.w</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1307</span>   * Calculates a point-box collision between a point and a collision box within a given tolerance. A higher tolerance means less precise collision.
<span class='line'>1308</span>   * @param {Object} o1 A point you're testing for collision. Must contain:
<span class='line'>1309</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the point&lt;/li>
<span class='line'>1310</span>   * &lt;li>y {Integer}: (required) the y coordinate of the point&lt;/li>&lt;/ul>
<span class='line'>1311</span>   * @param {Object} o2 A collision box you're testing for collision. Must contain:
<span class='line'>1312</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1313</span>   * &lt;li>y {Integer}: (required) the y coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1314</span>   * &lt;li>w {Integer}: (required) the width of the box&lt;/li>
<span class='line'>1315</span>   * &lt;li>h {Integer}: (required) the height the box&lt;/li>&lt;/ul>
<span class='line'>1316</span>   * @param {Integer} t The tolerance for the collision, in pixels. A value of 0 means pixel-perfect collision. A value of 2 would mean that the
<span class='line'>1317</span>   * point could exist within the outermost 2 pixels of the box without being considered a collision.
<span class='line'>1318</span>   * @returns True if the point is colliding with the box within the given tolerance.
<span class='line'>1319</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">	</span><span class="NAME">pixelcollides</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="NAME">o2</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">o1.y</span><span class="PUNC">&lt;</span><span class="NAME">o2.y</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1.y</span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">o2.y</span><span class="PUNC">+</span><span class="NAME">o2.h</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1.x</span><span class="PUNC">&lt;</span><span class="NAME">o2.x</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o1.x</span><span class="PUNC">></span><span class="NAME">o2.x</span><span class="PUNC">+</span><span class="NAME">o2.w</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">  </span><span class="COMM">/**
<span class='line'>1326</span>   * Determines whether an object is visible by seeing if it collides with the camera's viewport.
<span class='line'>1327</span>   * @param {Object} obj The object you're testing to see if it's visible. Must contain:
<span class='line'>1328</span>   * &lt;ul>&lt;li>x {Integer}: (required) the x coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1329</span>   * &lt;li>y {Integer}: (required) the y coordinate of the object's origin; assumes the Akihabara default of top-left being the origin&lt;/li>
<span class='line'>1330</span>   * &lt;li>w {Integer}: (required) the width of the object's collision box&lt;/li>
<span class='line'>1331</span>   * &lt;li>h {Integer}: (required) the height the object's box&lt;/li>&lt;/ul>
<span class='line'>1332</span>   * @returns True if the object's collision box is within the camera's viewport.
<span class='line'>1333</span>   */</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">	</span><span class="NAME">objectIsVisible</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.collides</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="NAME">this._camera</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">	</span><span class="COMM">// ---  AUDIO ENGINE</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">	</span><span class="NAME">_audiochannels</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">	</span><span class="NAME">_audiomastervolume</span><span class="PUNC">:</span><span class="NUMB">1.0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">	</span><span class="NAME">_canaudio</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">	</span><span class="NAME">_audiodequeuetime</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">	</span><span class="NAME">_audioprefetch</span><span class="PUNC">:</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">	</span><span class="NAME">_audiocompatmode</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 0: pause/play, 1: google chrome compatibility, 2: ipad compatibility (single channel)</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">	</span><span class="NAME">_createmode</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// 0: clone, 1: rehinstance</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">	</span><span class="NAME">_fakecheckprogressspeed</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Frequency of fake audio monitoring</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">	</span><span class="NAME">_fakestoptime</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Fake audio stop for compatibility mode</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">	</span><span class="NAME">_audioteam</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">	</span><span class="NAME">_loweraudioteam</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">	</span><span class="NAME">_audio</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">lding</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">qtimer</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">aud</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">ast</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">	</span><span class="NAME">_audioactions</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">	</span><span class="NAME">_showplayers</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">	</span><span class="NAME">_singlechannelname</span><span class="PUNC">:</span><span class="STRN">"bgmusic"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1357</span> </span><span class="WHIT">	</span><span class="NAME">_positiondelay</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">	</span><span class="NAME">_playerforcer</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">	</span><span class="NAME">_audiomutevolume</span><span class="PUNC">:</span><span class="NUMB">0.0001</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Zero is still not accepted by everyone :(</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">	</span><span class="NAME">_rawstopaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">su</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">su.duration</span><span class="PUNC">-</span><span class="NAME">su.currentTime</span><span class="PUNC">></span><span class="NAME">gbox._fakestoptime</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">				</span><span class="NAME">su.currentTime</span><span class="PUNC">=</span><span class="NAME">su.duration</span><span class="PUNC">-</span><span class="NAME">gbox._fakestoptime</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">			</span><span class="NAME">su.muted</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">			</span><span class="NAME">su.pause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1367</span> 
<span class='line'>1368</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">	</span><span class="NAME">_rawplayaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">su</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">			</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">su.currentTime</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">			</span><span class="NAME">su.muted</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">			</span><span class="NAME">su.play</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">			</span><span class="NAME">su.load</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">			</span><span class="NAME">gbox._playerforcer</span><span class="PUNC">=</span><span class="NAME">setInterval</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="PUNC">{</span><span class="NAME">su.play</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">clearInterval</span><span class="PUNC">(</span><span class="NAME">gbox._playerforcer</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NUMB">1000</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">			</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">su.currentTime</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">			</span><span class="NAME">su.play</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">	</span><span class="NAME">_finalizeaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ob</span><span class="PUNC">,</span><span class="NAME">who</span><span class="PUNC">,</span><span class="NAME">donext</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cur</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">who</span><span class="PUNC">?</span><span class="NAME">who</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">		</span><span class="NAME">cur.removeEventListener</span><span class="PUNC">(</span><span class="STRN">'ended'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._finalizeaudio</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">		</span><span class="NAME">cur.removeEventListener</span><span class="PUNC">(</span><span class="STRN">'timeupdate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._checkprogress</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">		</span><span class="NAME">cur.addEventListener</span><span class="PUNC">(</span><span class="STRN">'ended'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._playbackended</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">donext</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._loaderloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">	</span><span class="NAME">_audiodoload</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._audio.lding.muted</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">			</span><span class="NAME">gbox._finalizeaudio</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">gbox._audio.lding</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">			</span><span class="NAME">gbox._audio.lding.load</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">			</span><span class="NAME">gbox._audio.lding.play</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">	</span><span class="NAME">_timedfinalize</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">		</span><span class="NAME">gbox._rawstopaudio</span><span class="PUNC">(</span><span class="NAME">gbox._audio.lding</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1402</span> </span><span class="WHIT">		</span><span class="NAME">gbox._finalizeaudio</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">gbox._audio.lding</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">	</span><span class="NAME">_checkprogress</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.lding.currentTime</span><span class="PUNC">></span><span class="NAME">gbox._audioprefetch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._timedfinalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">	</span><span class="NAME">_fakecheckprogress</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.lding.currentTime</span><span class="PUNC">></span><span class="NAME">gbox._audioprefetch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._timedfinalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._fakecheckprogress</span><span class="PUNC">,</span><span class="NAME">gbox._fakecheckprogressspeed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">	</span><span class="NAME">_audiofiletomime</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fsp</span><span class="PUNC">=</span><span class="NAME">f.split</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fsp.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"ogg"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"audio/ogg"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"mp3"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"audio/mpeg"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">break</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">			</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"audio/mpeg"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">	</span><span class="NAME">_pushaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">this.currentTime</span><span class="PUNC">=</span><span class="NUMB">1.0</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">	</span><span class="NAME">_createnextaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cau</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cau.def</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">			</span><span class="NAME">gbox.deleteAudio</span><span class="PUNC">(</span><span class="NAME">cau.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">cau.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">cau.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">cy</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">volume</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">channel</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">play</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">mute</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">filename</span><span class="PUNC">:</span><span class="NAME">cau.filename</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cau.def</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">cau.def</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">cau.id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">cau.def</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox._createmode</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">cau.team</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ael</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">cau.id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">			</span><span class="NAME">gbox._finalizeaudio</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">ael</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ael</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'audio'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">			</span><span class="NAME">ael.volume</span><span class="PUNC">=</span><span class="NAME">gbox._audiomutevolume</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._showplayers</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.display</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.visibility</span><span class="PUNC">=</span><span class="STRN">"hidden"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.width</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.height</span><span class="PUNC">=</span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.position</span><span class="PUNC">=</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.left</span><span class="PUNC">=</span><span class="STRN">"0px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">			</span><span class="NAME">ael.style.top</span><span class="PUNC">=</span><span class="STRN">"-1000px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">		</span><span class="NAME">ael.setAttribute</span><span class="PUNC">(</span><span class="STRN">'controls'</span><span class="PUNC">,</span><span class="NAME">gbox._showplayers</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">		</span><span class="NAME">ael.setAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_id'</span><span class="PUNC">,</span><span class="NAME">cau.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">		</span><span class="NAME">ael.setAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_cnt'</span><span class="PUNC">,</span><span class="NAME">cau.team</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">		</span><span class="NAME">ael.addEventListener</span><span class="PUNC">(</span><span class="STRN">'loadedmetadata'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._pushaudio</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Push locked audio in safari</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox._createmode</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">cau.team</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">gbox._createmode</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ael.canPlayType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cmime</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cau.filename.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">					</span><span class="NAME">cmime</span><span class="PUNC">=</span><span class="NAME">gbox._audiofiletomime</span><span class="PUNC">(</span><span class="NAME">cau.filename</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="STRN">"no"</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">ael.canPlayType</span><span class="PUNC">(</span><span class="NAME">cmime</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">ael.canPlayType</span><span class="PUNC">(</span><span class="NAME">cmime</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">						</span><span class="NAME">ael.src</span><span class="PUNC">=</span><span class="NAME">gbox._breakcacheurl</span><span class="PUNC">(</span><span class="NAME">cau.filename</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1459</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cau.filename.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'source'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="WHIT">					</span><span class="NAME">src.setAttribute</span><span class="PUNC">(</span><span class="STRN">'src'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._breakcacheurl</span><span class="PUNC">(</span><span class="NAME">cau.filename</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1462</span> </span><span class="WHIT">					</span><span class="NAME">ael.appendChild</span><span class="PUNC">(</span><span class="NAME">src</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">			</span><span class="NAME">ael.addEventListener</span><span class="PUNC">(</span><span class="STRN">'ended'</span><span class="PUNC">,</span><span class="NAME">this._finalizeaudio</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">				</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._fakecheckprogress</span><span class="PUNC">,</span><span class="NAME">gbox._fakecheckprogressspeed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">				</span><span class="NAME">ael.addEventListener</span><span class="PUNC">(</span><span class="STRN">'timeupdate'</span><span class="PUNC">,</span><span class="NAME">this._checkprogress</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">			</span><span class="NAME">ael.setAttribute</span><span class="PUNC">(</span><span class="STRN">'buffering'</span><span class="PUNC">,</span><span class="STRN">"auto"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">			</span><span class="NAME">ael.volume</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">cau.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">ael</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">			</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">ael</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">			</span><span class="NAME">gbox._audio.lding</span><span class="PUNC">=</span><span class="NAME">ael</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">			</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._audiodoload</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">cau.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">push</span><span class="PUNC">(</span><span class="NAME">ael</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">			</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">ael</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">			</span><span class="NAME">gbox._loaderloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">	</span><span class="NAME">_playbackended</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">this.getAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_id'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">==</span><span class="NAME">this.getAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_cnt'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">this.getAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_id'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">&&</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">this.getAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_id'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">loop</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">					</span><span class="NAME">gbox._rawplayaudio</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">					</span><span class="NAME">this.currentTime</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">				</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">this.getAttribute</span><span class="PUNC">(</span><span class="STRN">'aki_id'</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">			</span><span class="NAME">this.pause</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">			</span><span class="NAME">this.muted</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">	</span><span class="NAME">_updateaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mute</span><span class="PUNC">?</span><span class="NAME">this._audiomutevolume</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">				</span><span class="NAME">this._audiomastervolume</span><span class="PUNC">*</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">				</span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">				</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">channel</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">channel</span><span class="PUNC">]</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">channel</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">channel</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">			</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1505</span> </span><span class="WHIT">	</span><span class="NAME">_minimaltimeexpired</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._minimalexpired</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">	</span><span class="NAME">_splashscreeniscompleted</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.background</span><span class="PUNC">?</span><span class="NAME">gbox.imageIsLoaded</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.minilogo</span><span class="PUNC">?</span><span class="NAME">gbox.imageIsLoaded</span><span class="PUNC">(</span><span class="STRN">"logo"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.footnotes</span><span class="PUNC">?</span><span class="NAME">gbox.imageIsLoaded</span><span class="PUNC">(</span><span class="STRN">"_dbf"</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">	</span><span class="NAME">_addqueue</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._audiodequeuetime</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">			</span><span class="NAME">gbox._dequeueaudio</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">			</span><span class="NAME">gbox._audioactions.push</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._audio.qtimer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">				</span><span class="NAME">gbox._audio.qtimer</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">				</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._dequeueaudio</span><span class="PUNC">,</span><span class="NAME">gbox._audiodequeuetime</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">	</span><span class="NAME">_dequeueaudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">rt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ac</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">rt</span><span class="PUNC">?</span><span class="NAME">rt</span><span class="PUNC">:</span><span class="NAME">gbox._audioactions.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ac.t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">					</span><span class="NAME">gbox._updateaudio</span><span class="PUNC">(</span><span class="NAME">ac.a.getAttribute</span><span class="PUNC">(</span><span class="STRN">"aki_id"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">					</span><span class="NAME">gbox._rawplayaudio</span><span class="PUNC">(</span><span class="NAME">ac.a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">					</span><span class="NAME">gbox._rawstopaudio</span><span class="PUNC">(</span><span class="NAME">ac.a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">					</span><span class="NAME">gbox._updateaudio</span><span class="PUNC">(</span><span class="NAME">ac.a.getAttribute</span><span class="PUNC">(</span><span class="STRN">"aki_id"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">rt</span><span class="PUNC">&&</span><span class="NAME">gbox._audioactions.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">				</span><span class="NAME">gbox._audio.qtimer</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">				</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._dequeueaudio</span><span class="PUNC">,</span><span class="NAME">gbox._audiodequeuetime</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox._audio.qtimer</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">	</span><span class="NAME">getAudioIsSingleChannel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audiocompatmode</span><span class="PUNC">==</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">	</span><span class="NAME">setAudioPositionDelay</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._positiondelay</span><span class="PUNC">=</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">	</span><span class="NAME">setAudioDequeueTime</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._audiodequeuetime</span><span class="PUNC">=</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">	</span><span class="NAME">setShowPlayers</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._showplayers</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">	</span><span class="NAME">setAudioCompatMode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">=</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">	</span><span class="NAME">setAudioCreateMode</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">gbox._createmode</span><span class="PUNC">=</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">	</span><span class="NAME">addAudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">filename</span><span class="PUNC">,</span><span class="NAME">def</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._canaudio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">filename</span><span class="PUNC">==</span><span class="NAME">filename</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">					</span><span class="NAME">gbox.deleteAudio</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox._audiocompatmode</span><span class="PUNC">!=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">def.channel</span><span class="PUNC">==</span><span class="NAME">gbox._singlechannelname</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">grsize</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">def.channel</span><span class="PUNC">==</span><span class="NAME">gbox._singlechannelname</span><span class="PUNC">?</span><span class="NAME">gbox._loweraudioteam</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">def.background</span><span class="PUNC">?</span><span class="NAME">gbox._loweraudioteam</span><span class="PUNC">:</span><span class="NAME">gbox._audioteam</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">grsize</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">					</span><span class="NAME">gbox._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"audio"</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="NAME">filename</span><span class="PUNC">:</span><span class="NAME">filename</span><span class="PUNC">,</span><span class="NAME">def</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">def</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">team</span><span class="PUNC">:</span><span class="NAME">i</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">	</span><span class="NAME">deleteAudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">				</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">document.body.removeChild</span><span class="PUNC">(</span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">gbox._audio.aud</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">	</span><span class="NAME">playAudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.hitAudio</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">	</span><span class="NAME">hitAudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ael</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">!=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">				</span><span class="NAME">this.stopAudio</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">%</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">			</span><span class="NAME">ael</span><span class="PUNC">=</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1584</span> </span><span class="WHIT">			</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1585</span> </span><span class="WHIT">			</span><span class="NAME">this._addqueue</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">t</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">ael</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">	</span><span class="NAME">stopAudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">permissive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ael</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">				</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">				</span><span class="NAME">ael</span><span class="PUNC">=</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ael.duration</span><span class="PUNC">-</span><span class="NUMB">1.5</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">					</span><span class="NAME">this._addqueue</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">t</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">ael</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">	</span><span class="NAME">setSplashSettings</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._splash</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">	</span><span class="NAME">resetChannel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1601</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1602</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">==</span><span class="STRN">"master"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ch</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._audiochannels</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">					</span><span class="NAME">this.setChannelVolume</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">,</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_def.volume</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">				</span><span class="NAME">this.setChannelVolume</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">,</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_def.volume</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1607</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1608</span> </span><span class="WHIT">	</span><span class="NAME">getChannelDefaultVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_def.volume</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">	</span><span class="NAME">setChannelVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">==</span><span class="STRN">"master"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audiomastervolume</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">=</span><span class="NAME">a</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._audio.aud</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._updateaudio</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">	</span><span class="NAME">getChannelVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">==</span><span class="STRN">"master"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audiomastervolume</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">	</span><span class="NAME">changeChannelVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vol</span><span class="PUNC">=</span><span class="NAME">this.getChannelVolume</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vol</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">vol</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vol</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">vol</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">			</span><span class="NAME">this.setChannelVolume</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">,</span><span class="NAME">vol</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">	</span><span class="NAME">stopChannel</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">gbox._audio.aud</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">></span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">&&</span><span class="NAME">gbox._audio.ast</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">play</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">ch</span><span class="PUNC">==</span><span class="STRN">"master"</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">channel</span><span class="PUNC">==</span><span class="NAME">ch</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">					</span><span class="NAME">this.stopAudio</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">	</span><span class="NAME">setAudioUnmute</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mute</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">this._updateaudio</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">	</span><span class="NAME">setAudioMute</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mute</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">this._updateaudio</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">	</span><span class="NAME">getAudioMute</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">mute</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">	</span><span class="NAME">setAudioVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">vol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">=</span><span class="NAME">vol</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">this._updateaudio</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">	</span><span class="NAME">getAudioVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">vol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">	</span><span class="NAME">setAudioPosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">currentTime</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">	</span><span class="NAME">getAudioPosition</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">currentTime</span><span class="PUNC">></span><span class="NAME">this._positiondelay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">currentTime</span><span class="PUNC">-</span><span class="NAME">this._positiondelay</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1642</span> 
<span class='line'>1643</span> </span><span class="WHIT">	</span><span class="NAME">getAudioDuration</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">&&</span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this._audio.aud</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cy</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">duration</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1644</span> 
<span class='line'>1645</span> </span><span class="WHIT">	</span><span class="NAME">changeAudioVolume</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">vol</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._canaudio</span><span class="PUNC">&&</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">+</span><span class="NAME">vol</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT">  </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">+</span><span class="NAME">vol</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this._audio.ast</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">volume</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">vol</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">this._updateaudio</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">	</span><span class="NAME">setCanAudio</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._canaudio</span><span class="PUNC">=</span><span class="PUNC">!</span><span class="NAME">this._flags.noaudio</span><span class="PUNC">&&</span><span class="NAME">a</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">	</span><span class="NAME">setAudioChannels</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">		</span><span class="NAME">this._audiochannels</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ch</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">			</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_def</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1651</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attr</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1652</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attr</span><span class="PUNC">!=</span><span class="STRN">"_def"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_def</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">this._audiochannels</span><span class="PUNC">[</span><span class="NAME">ch</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">attr</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1653</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">	</span><span class="NAME">setAudioTeam</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._audioteam</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">	</span><span class="NAME">setLowerAudioTeam</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._loweraudioteam</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">	</span><span class="COMM">// ---  DYNAMIC SCRIPT INCLUSION</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">	</span><span class="NAME">addScript</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">call</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">		</span><span class="NAME">gbox._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"script"</span><span class="PUNC">,</span><span class="NAME">call</span><span class="PUNC">:</span><span class="NAME">call</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">	</span><span class="COMM">// ---  BUNDLES</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">	</span><span class="COMM">// ---</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">	</span><span class="NAME">addBundle</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">call</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="WHIT">		</span><span class="NAME">gbox._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"bundle"</span><span class="PUNC">,</span><span class="NAME">call</span><span class="PUNC">:</span><span class="NAME">call</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">	</span><span class="NAME">readBundleData</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pack</span><span class="PUNC">,</span><span class="NAME">call</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">		</span><span class="COMM">// Local resources first</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.setObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.setObject.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">pack.setObject</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">object</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">pack.setObject</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">property</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">pack.setObject</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.addFont</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.addFont.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.addFont</span><span class="PUNC">(</span><span class="NAME">pack.addFont</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.addTiles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.addTiles.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.addTiles</span><span class="PUNC">(</span><span class="NAME">pack.addTiles</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">		</span><span class="COMM">// Remote resources for last</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.addImage</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.addImage.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.addImage</span><span class="PUNC">(</span><span class="NAME">pack.addImage</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pack.addImage</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.addAudio</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.addAudio.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.addAudio</span><span class="PUNC">(</span><span class="NAME">pack.addAudio</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pack.addAudio</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">pack.addAudio</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.addBundle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.addBundle.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.addBundle</span><span class="PUNC">(</span><span class="NAME">pack.addBundle</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.addScript</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">pack.addScript.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox.addScript</span><span class="PUNC">(</span><span class="NAME">pack.addScript</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">		</span><span class="COMM">// Trigger the onLoad events in resource and loader</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pack.onLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"exec-onl"</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">:</span><span class="NAME">pack.onLoad</span><span class="PUNC">,</span><span class="NAME">call</span><span class="PUNC">:</span><span class="NAME">call</span><span class="PUNC">,</span><span class="NAME">pack</span><span class="PUNC">:</span><span class="NAME">pack</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">call.onLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"exec-onl"</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">:</span><span class="NAME">call.onLoad</span><span class="PUNC">,</span><span class="NAME">call</span><span class="PUNC">:</span><span class="NAME">call</span><span class="PUNC">,</span><span class="NAME">pack</span><span class="PUNC">:</span><span class="NAME">pack</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">	</span><span class="COMM">// ---  DATA LOADER</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">	</span><span class="COMM">// --- </span><span class="WHIT">
<span class='line'>1698</span> 
<span class='line'>1699</span> </span><span class="WHIT">	</span><span class="NAME">_xmlhttp</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">	</span><span class="NAME">_loaderqueue</span><span class="PUNC">:</span><span class="NAME">cyclelist.create</span><span class="PUNC">(</span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">	</span><span class="NAME">_loadercache</span><span class="PUNC">:</span><span class="NAME">cachelist.create</span><span class="PUNC">(</span><span class="NUMB">30</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">	</span><span class="COMM">// Callback for loaded image</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">	</span><span class="NAME">_loaderimageloaded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">		</span><span class="NAME">this.setAttribute</span><span class="PUNC">(</span><span class="STRN">'wasloaded'</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">		</span><span class="NAME">this.hheight</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">this.height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">		</span><span class="NAME">this.hwidth</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">this.width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">		</span><span class="NAME">gbox._loaderloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1709</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1710</span> </span><span class="WHIT">	</span><span class="COMM">// Callback for loaded bundle</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">	</span><span class="NAME">_loaderhmlhttploading</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.readyState</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.status</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">||</span><span class="NAME">this.status</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.responseText</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">call.skipCacheSave</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">					</span><span class="NAME">gbox._loadercache.add</span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">call.file</span><span class="PUNC">,</span><span class="NAME">this.responseText</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pack</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">this.responseText</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">				</span><span class="NAME">gbox.readBundleData</span><span class="PUNC">(</span><span class="NAME">pack</span><span class="PUNC">,</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="WHIT">				</span><span class="COMM">// Keep loading the other resources.</span><span class="WHIT">
<span class='line'>1719</span> </span><span class="WHIT">				</span><span class="NAME">gbox._loaderloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">	</span><span class="COMM">// Loader code</span><span class="WHIT">
<span class='line'>1725</span> </span><span class="WHIT">	</span><span class="NAME">_addtoloader</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// type:xx, data:yy</span><span class="WHIT">
<span class='line'>1726</span> </span><span class="WHIT">		</span><span class="NAME">gbox._loaderqueue.push</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._loaderqueue.isProcessing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">			</span><span class="NAME">gbox._loadnext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">	</span><span class="NAME">_loaderloaded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">		</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._loadnext</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">	</span><span class="NAME">_loaderscript</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">call.onLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._addtoloader</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"exec-onl"</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">:</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">call.onLoad</span><span class="PUNC">,</span><span class="NAME">call</span><span class="PUNC">:</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">call</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">		</span><span class="NAME">gbox._loadnext</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">	</span><span class="NAME">_loadnext</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">current</span><span class="PUNC">=</span><span class="NAME">gbox._loaderqueue.pop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.isProcessing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.getCurrent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"image"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">					</span><span class="NAME">gbox._images</span><span class="PUNC">[</span><span class="NAME">current.id</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Image</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">					</span><span class="NAME">gbox._images</span><span class="PUNC">[</span><span class="NAME">current.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addEventListener</span><span class="PUNC">(</span><span class="STRN">'load'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._loaderimageloaded</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">					</span><span class="NAME">gbox._images</span><span class="PUNC">[</span><span class="NAME">current.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">src</span><span class="PUNC">=</span><span class="NAME">gbox._breakcacheurl</span><span class="PUNC">(</span><span class="NAME">current.filename</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">					</span><span class="NAME">gbox._images</span><span class="PUNC">[</span><span class="NAME">current.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">'src_org'</span><span class="PUNC">,</span><span class="NAME">current.filename</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">					</span><span class="NAME">gbox._images</span><span class="PUNC">[</span><span class="NAME">current.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">'id'</span><span class="PUNC">,</span><span class="NAME">current.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">					</span><span class="NAME">gbox._images</span><span class="PUNC">[</span><span class="NAME">current.id</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">'wasloaded'</span><span class="PUNC">,</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"bundle"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">current.call.skipCacheLoad</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">=</span><span class="NAME">gbox._loadercache.read</span><span class="PUNC">(</span><span class="NAME">current.call.file</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1755</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pack</span><span class="PUNC">=</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="STRN">"("</span><span class="PUNC">+</span><span class="NAME">data</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">							</span><span class="NAME">gbox.readBundleData</span><span class="PUNC">(</span><span class="NAME">pack</span><span class="PUNC">,</span><span class="NAME">current.call</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">							</span><span class="COMM">// Keep loading the other resources.</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">							</span><span class="NAME">gbox._loaderloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">							</span><span class="NAME">done</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">done</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">						</span><span class="NAME">gbox._xmlhttp</span><span class="PUNC">=</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">XMLHttpRequest</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">						</span><span class="NAME">gbox._xmlhttp.open</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">current.call.data</span><span class="PUNC">?</span><span class="STRN">"POST"</span><span class="PUNC">:</span><span class="STRN">"GET"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gbox._breakcacheurl</span><span class="PUNC">(</span><span class="NAME">current.call.file</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">						</span><span class="NAME">gbox._xmlhttp.onreadystatechange</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gbox._loaderhmlhttploading</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">current.call.data</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">							</span><span class="NAME">gbox._xmlhttp.setRequestHeader</span><span class="PUNC">(</span><span class="STRN">"Content-type"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"application/x-www-form-urlencoded"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">							</span><span class="NAME">gbox._xmlhttp.send</span><span class="PUNC">(</span><span class="NAME">current.call.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">gbox._xmlhttp.send</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"audio"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">					</span><span class="NAME">gbox._createnextaudio</span><span class="PUNC">(</span><span class="NAME">current.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"exec-onl"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">					</span><span class="NAME">current.func</span><span class="PUNC">(</span><span class="NAME">current.call</span><span class="PUNC">,</span><span class="NAME">current.pack</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1779</span> </span><span class="WHIT">					</span><span class="NAME">gbox._loaderloaded</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1780</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"script"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">script</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'script'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">					</span><span class="NAME">script.type</span><span class="PUNC">=</span><span class="STRN">"text/javascript"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">					</span><span class="NAME">script.onload</span><span class="PUNC">=</span><span class="NAME">gbox._loaderscript</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">					</span><span class="NAME">script.src</span><span class="PUNC">=</span><span class="NAME">current.call.file</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">					</span><span class="NAME">document.getElementsByTagName</span><span class="PUNC">(</span><span class="STRN">'body'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">appendChild</span><span class="PUNC">(</span><span class="NAME">script</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">	</span><span class="NAME">_waitforloaded</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aul</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.isBusy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">gbox._minimalexpired</span><span class="PUNC">!=</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tox</span><span class="PUNC">=</span><span class="NAME">gbox._screen.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">			</span><span class="NAME">tox.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">			</span><span class="NAME">gbox.blitFade</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">alpha</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox._minimalexpired</span><span class="PUNC">&&</span><span class="NAME">gbox._splashscreeniscompleted</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">				</span><span class="NAME">gbox._minimalexpired</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">				</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._minimaltimeexpired</span><span class="PUNC">,</span><span class="NAME">gbox._splash.minimalTime</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.loading</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">gbox._splash.loading</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">gbox._loaderqueue.getDone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox._loaderqueue.getTotal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.background</span><span class="PUNC">&&</span><span class="NAME">gbox.imageIsLoaded</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blit</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">dh</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.minilogo</span><span class="PUNC">&&</span><span class="NAME">gbox.imageIsLoaded</span><span class="PUNC">(</span><span class="STRN">"logo"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dw</span><span class="PUNC">=</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1809</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dh</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"logo"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">*</span><span class="NAME">dw</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"logo"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blit</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="NAME">gbox._splash.minilogo</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"logo"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="NAME">gbox.getImage</span><span class="PUNC">(</span><span class="STRN">"logo"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">,</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">dw</span><span class="PUNC">-</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">dh</span><span class="PUNC">-</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">dw</span><span class="PUNC">:</span><span class="NAME">dw</span><span class="PUNC">,</span><span class="NAME">dh</span><span class="PUNC">:</span><span class="NAME">dh</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._splash.footnotes</span><span class="PUNC">&&</span><span class="NAME">gbox.imageIsLoaded</span><span class="PUNC">(</span><span class="STRN">"_dbf"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"_footnotes"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fd</span><span class="PUNC">=</span><span class="NAME">gbox.getFont</span><span class="PUNC">(</span><span class="STRN">"_dbf"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="WHIT">					</span><span class="NAME">gbox.createCanvas</span><span class="PUNC">(</span><span class="STRN">"_footnotes"</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">w</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">:</span><span class="PUNC">(</span><span class="NAME">gbox._splash.footnotes.length</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">gbox._splash.footnotesSpacing</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">gbox._splash.footnotes.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">						</span><span class="NAME">gbox.blitText</span><span class="PUNC">(</span><span class="NAME">gbox.getCanvasContext</span><span class="PUNC">(</span><span class="STRN">"_footnotes"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">										</span><span class="NAME">font</span><span class="PUNC">:</span><span class="STRN">"_dbf"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1819</span> </span><span class="WHIT">										</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1820</span> </span><span class="WHIT">										</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">i</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">fd.tileh</span><span class="PUNC">+</span><span class="NAME">gbox._splash.footnotesSpacing</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">										</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">gbox._splash.footnotes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">				</span><span class="NAME">gbox.blitAll</span><span class="PUNC">(</span><span class="NAME">tox</span><span class="PUNC">,</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"_footnotes"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">dx</span><span class="PUNC">:</span><span class="NUMB">5</span><span class="PUNC">,</span><span class="NAME">dy</span><span class="PUNC">:</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">gbox.getCanvas</span><span class="PUNC">(</span><span class="STRN">"_footnotes"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">height</span><span class="PUNC">-</span><span class="NUMB">5</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gbox._loaderqueue.isBusy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bw</span><span class="PUNC">=</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">gbox._loaderqueue.getDone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">gbox._loaderqueue.getTotal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">				</span><span class="NAME">tox.globalAlpha</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">				</span><span class="NAME">tox.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gbox._splash.gaugeBorderColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">				</span><span class="NAME">tox.fillRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">gbox._splash.gaugeHeight</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox._splash.gaugeHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">				</span><span class="NAME">tox.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gbox._splash.gaugeBackColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">				</span><span class="NAME">tox.fillRect</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">gbox._splash.gaugeHeight</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox.getScreenW</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">4</span><span class="PUNC">,</span><span class="NAME">gbox._splash.gaugeHeight</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">				</span><span class="NAME">tox.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gbox._splash.gaugeColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">				</span><span class="NAME">tox.fillRect</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">gbox.getScreenH</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">gbox._splash.gaugeHeight</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">bw</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">bw</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">gbox._splash.gaugeHeight</span><span class="PUNC">-</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">			</span><span class="NAME">tox.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">			</span><span class="NAME">gbox.setStatBar</span><span class="PUNC">(</span><span class="STRN">"Loading... ("</span><span class="PUNC">+</span><span class="NAME">gbox._loaderqueue.getDone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">gbox._loaderqueue.getTotal</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">			</span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="NAME">gbox._waitforloaded</span><span class="PUNC">,</span><span class="NUMB">50</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">			</span><span class="NAME">gbox.deleteImage</span><span class="PUNC">(</span><span class="STRN">"_splash"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">			</span><span class="NAME">gbox.setStatBar</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">			</span><span class="NAME">gbox._cb</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">	</span><span class="NAME">clearCache</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">this._loadercache.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1846</span> 
<span class='line'>1847</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> 
<span class='line'>1849</span> </span></pre></body></html>